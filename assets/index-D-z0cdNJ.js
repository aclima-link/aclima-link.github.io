var sn=Object.defineProperty;var nn=(s,t,e)=>t in s?sn(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var f=(s,t,e)=>nn(s,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const m={currentView:Symbol("currentView"),cursorTagStart:Symbol("cursorTagStart"),computedKeys:Symbol("computedKeys"),destroy:Symbol("destroy"),getChildren:Symbol("getChildren"),holder:Symbol("holder"),id:Symbol("id"),identifier:Symbol("identifier"),index:Symbol("index"),init:Symbol("init"),inputEvents:Symbol("inputEvents"),intervals:Symbol("intervals"),launched:Symbol("launched"),level:Symbol("level"),methodKeys:Symbol("methodKeys"),originalState:Symbol("originalState"),propKeys:Symbol("propKeys"),raw:Symbol("raw"),ready:Symbol("ready"),renderer:Symbol("renderer"),routes:Symbol("routes"),routerHooks:Symbol("routerHooks"),settings:Symbol("settings"),state:Symbol("state"),stateKeys:Symbol("stateKeys"),textnode:Symbol("textnode"),timeouts:Symbol("timeouts"),type:Symbol("type"),watchers:Symbol("watchers"),watchKeys:Symbol("watchKeys"),wrapper:Symbol("wrapper"),children:Symbol.for("children"),components:Symbol.for("components"),config:Symbol.for("config"),isSlot:Symbol.for("isSlot"),props:Symbol.for("props"),slots:Symbol.for("slots"),componentType:Symbol.for("componentType"),isComponent:Symbol.for("isComponent"),effects:Symbol.for("effects"),removeGlobalEffects:Symbol.for("removeGlobalEffects")},ae={[m.settings]:{},get(s,t=null){return s in this[m.settings]?this[m.settings][s]:t},set(s,t){typeof s=="object"?Object.keys(s).forEach(e=>{this.set(e,s[e])}):this[m.settings][s]=t}},sr=()=>{},Yr=()=>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),ai=s=>{const t=ae.get("debugLevel"),e={};return Object.defineProperty(e,"info",{get(){return(t>=1||Array.isArray(t)&&t.indexOf("info")>-1)&&console.info.bind(window.console,`%c ⚡️ ${s} %c ${Yr()}`,"background-color: #0284c7; color: white; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||sr}}),Object.defineProperty(e,"warn",{get(){return(t>=1||Array.isArray(t)&&t.indexOf("warn")>-1)&&console.warn.bind(window.console,`%c ⚡️ ${s} %c ${Yr()}`,"background-color: #fbbf24; color: white; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||sr}}),Object.defineProperty(e,"error",{get(){return(t>=1||Array.isArray(t)&&t.indexOf("error")>-1)&&console.error.bind(window.console,`%c ⚡️ ${s} %c ${Yr()}`,"background-color: #dc2626; color: white; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||sr}}),Object.defineProperty(e,"debug",{get(){return(t>=2||Array.isArray(t)&&t.indexOf("debug")>-1)&&console.debug.bind(window.console,`%c ⚡️ ${s} %c (${new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})`,"background-color: #e2e8f0; color: #334155; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||sr}}),e};let G;const on=()=>{G=ai("Blits")},ir={aliceblue:"0xf0f8ffff",antiquewhite:"0xfaebd7ff",aqua:"0xffffff00",aquamarine:"0x7fffd4ff",azure:"0xf0ffffff",beige:"0xf5f5dcff",bisque:"0xffe4c4ff",black:"0x000000ff",blanchedalmond:"0xffebcdff",blue:"0x0000ffff",blueviolet:"0x8a2be2ff",brown:"0xa52a2aff",burlywood:"0xdeb887ff",cadetblue:"0x5f9ea0ff",chartreuse:"0x7fff00ff",chocolate:"0xd2691eff",coral:"0xff7f50ff",cornflowerblue:"0x6495edff",cornsilk:"0xfff8dcff",crimson:"0xdc143cff",cyan:"0x00ffffff",darkblue:"0x00008bff",darkcyan:"0x008b8bff",darkgoldenrod:"0xb8860bff",darkgray:"0xa9a9a9ff",darkgreen:"0x006400ff",darkgrey:"0xa9a9a9ff",darkkhaki:"0xbdb76bff",darkmagenta:"0x8b008bff",darkolivegreen:"0x556b2fff",darkorange:"0xff8c00ff",darkorchid:"0x9932ccff",darkred:"0x8b0000ff",darksalmon:"0xe9967aff",darkseagreen:"0x8fbc8fff",darkslateblue:"0x483d8bff",darkslategray:"0x2f4f4fff",darkslategrey:"0x2f4f4fff",darkturquoise:"0x00ced1ff",darkviolet:"0x9400d3ff",deeppink:"0xff1493ff",deepskyblue:"0x00bfffff",dimgray:"0x696969ff",dimgrey:"0x696969ff",dodgerblue:"0x1e90ffff",firebrick:"0xb22222ff",floralwhite:"0xfffaf0ff",forestgreen:"0x228b22ff",fuchsia:"0xff00ffff",gainsboro:"0xdcdcdcff",ghostwhite:"0xf8f8ffff",gold:"0xffd700ff",goldenrod:"0xdaa520ff",gray:"0x808080ff",green:"0x008000ff",greenyellow:"0xadff2fff",grey:"0x808080ff",honeydew:"0xf0fff0ff",hotpink:"0xff69b4ff",indianred:"0xcd5c5cff",indigo:"0x4b0082ff",ivory:"0xfffff0ff",khaki:"0xf0e68cff",lavender:"0xe6e6faff",lavenderblush:"0xfff0f5ff",lawngreen:"0x7cfc00ff",lemonchiffon:"0xfffacdff",lightblue:"0xadd8e6ff",lightcoral:"0xf08080ff",lightcyan:"0xe0ffffff",lightgoldenrodyellow:"0xfafad2ff",lightgray:"0xd3d3d3ff",lightgreen:"0x90ee90ff",lightgrey:"0xd3d3d3ff",lightpink:"0xffb6c1ff",lightsalmon:"0xffa07aff",lightseagreen:"0x20b2aaff",lightskyblue:"0x87cefaff",lightslategray:"0x778899ff",lightslategrey:"0x778899ff",lightsteelblue:"0xb0c4deff",lightyellow:"0xffffe0ff",lime:"0x00ff00ff",limegreen:"0x32cd32ff",linen:"0xfaf0e6ff",magenta:"0xff00ffff",maroon:"0x800000ff",mediumaquamarine:"0x66cdaaff",mediumblue:"0x0000cdff",mediumorchid:"0xba55d3ff",mediumpurple:"0x9370dbff",mediumseagreen:"0x3cb371ff",mediumslateblue:"0x7b68eeff",mediumspringgreen:"0x00fa9aff",mediumturquoise:"0x48d1ccff",mediumvioletred:"0xc71585ff",midnightblue:"0x191970ff",mintcream:"0xf5fffaff",mistyrose:"0xffe4e1ff",moccasin:"0xffe4b5ff",navajowhite:"0xffdeadff",navy:"0x000080ff",oldlace:"0xfdf5e6ff",olive:"0x808000ff",olivedrab:"0x6b8e23ff",orange:"0xffa500ff",orangered:"0xff4500ff",orchid:"0xda70d6ff",palegoldenrod:"0xeee8aaff",palegreen:"0x98fb98ff",paleturquoise:"0xafeeeeff",palevioletred:"0xdb7093ff",papayawhip:"0xffefd5ff",peachpuff:"0xffdab9ff",peru:"0xcd853fff",pink:"0xffc0cbff",plum:"0xdda0ddff",powderblue:"0xb0e0e6ff",purple:"0x800080ff",rebeccapurple:"0x663399ff",red:"0xff0000ff",rosybrown:"0xbc8f8fff",royalblue:"0x4169e1ff",saddlebrown:"0x8b4513ff",salmon:"0xfa8072ff",sandybrown:"0xf4a460ff",seagreen:"0x2e8b57ff",seashell:"0xfff5eeff",sienna:"0xa0522dff",silver:"0xc0c0c0ff",skyblue:"0x87ceebff",slateblue:"0x6a5acdff",slategray:"0x708090ff",slategrey:"0x708090ff",snow:"0xfffafaff",springgreen:"0x00ff7fff",steelblue:"0x4682b4ff",tan:"0xd2b48cff",teal:"0x008080ff",thistle:"0xd8bfd8ff",tomato:"0xff6347ff",transparent:"0x00000000",turquoise:"0x40e0d0ff",violet:"0xee82eeff",wheat:"0xf5deb3ff",white:"0xffffffff",whitesmoke:"0xf5f5f5ff",yellow:"0xffff00ff",yellowgreen:"0x9acd32ff"},an=/^#?([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i,ln=/^(rgba?)\((\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\s*),(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\s*),(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\s*)(,(\s*(-?\d+(?:\.\d+)?)\s*))?\)$/,fn=/^(hsla?)\((\s*(360|3[0-5][0-9]|[12]?[0-9]{1,2})\s*),(\s*(100|[1-9]?[0-9])\s*)%,(\s*(100|[1-9]?[0-9])\s*)%(,(\s*(1|0(?:\.\d+)?)\s*))?\)$/,Hr={},nr=s=>{if(Hr[s]!==void 0)return Hr[s];const t=parseInt(s).toString(16).padStart(2,"0");return Hr[s]=t,t},pt={normalize:(s="",t="0xffffffff")=>{if(s=s.toString(),s.startsWith("0x")&&s.length===10)return s;if(ir[s]!==void 0)return ir[s];if(an.test(s)){s=s.replace("#","").toLowerCase(),s.length===3&&(s=s.split("").map(i=>i+i).join(""));const r="0x"+s.padEnd(8,"f");return ir[s]=r,r}const e=ln.exec(s);if(e){const r=nr(e[3]),i=nr(e[5]),n=nr(e[7]);let o="ff";if(e[10]&&e[1]==="rgba"){const a=Math.min(Math.max(Math.round(parseFloat(e[10])*255),0),255);o=nr(a)}const l="0x"+r+i+n+o;return ir[s]=l,l}return fn.test(s)?(console.warn("HSL(A) color format is not supported yet"),"0xffffffff"):t}},cn=(s="",t,e,r=null)=>{let i=0,n=0,o=[],l=null,a=0;const c=/^<\/?([a-zA-Z0-9_\-.]+)\s*/,u=/^\s*(\/?>)\s*/,d=/^([A-Za-z0-9:.\-_@$]+)=\s*(["'])/,h=/^<>\s*/,p=/^\s*(<\/>)\s*/,g=()=>{s=T(s);try{return x(S),W(o)}catch(w){throw(w.name=="TemplateParseError"||w.name=="TemplateStructureError")&&(w.message=`${w.message}
${w.context}`),w}},x=w=>{i>=s.length||w()},T=w=>w.replace(/<!--.*?-->/gms,"").replace(/\r?\n\s*\r\n/gm," ").replace(/\r?\n\s*(\S)/gm," $1").replace(/\r?\n/g,"").trim(),y=w=>{const E=s.slice(i).match(w);return E&&(n=i,i+=E[0].length),E},S=()=>{y(h)?(o.push({[Symbol.for("componentType")]:null,[m.type]:"opening",[m.level]:a,[m.cursorTagStart]:n}),a++,x(S)):x(v)},v=()=>{y(p)?(a--,o.push({[Symbol.for("componentType")]:null,[m.type]:"closing",[m.level]:a}),x(S)):x(C)},C=()=>{const w=y(c);if(w)l={[Symbol.for("componentType")]:w[1],[m.level]:a,[m.cursorTagStart]:n},w[0].startsWith("</")?(a--,l[m.type]="closing",l[m.level]=a):(l[m.type]="opening",a++),x($);else throw I("InvalidTag")},$=()=>{const w=y(u);if(w){if(w[1]==="/>"){if(l[m.type]==="closing")throw I("InvalidClosingTag");l[m.type]="self-closing",a--}if(l[m.type]==="opening"){const E=s.slice(i,s.indexOf("<",i));E&&(l.content=E,i+=E.length)}o.push(l),x(S)}else x(A)},A=()=>{const w=y(d);if(w){if(l[m.type]==="closing")throw I("AttributesInClosingTag");const E=w[2],N=new RegExp(`^(.*?)${E}\\s*`),X=y(N);if(X){const z=M(w[1],X[1]);l[z.name]=z.value,x($)}else throw I("MissingOrInvalidAttributeValue")}else throw I("InvalidAttribute")},M=(w,E)=>{if(w.includes(".")){const[N,X]=w.split(".");return{name:N,value:`{${X}: ${E}}`}}return["color",":color",":effects","effects"].includes(w)?L(w,E):{name:w,value:E}},L=(w,E)=>{let N=E,X=pt.normalize(N,null);if(X===null){const z=/'([^']+)'/g;let V,D=0,j="";for(;(V=z.exec(E))!==null;){const ee=V[1],re=V.index,K=V[0].length;j+=E.slice(D,re),X=pt.normalize(ee,null),X===null?j+=E.slice(re,re+K):j+=`'${X}'`,D=re+K}j+=E.slice(D),N=j}else N=X;return{name:w,value:N}},W=w=>{let E=[],N=!1,X={children:[]},z=X;for(let V=0;V<w.length;V++){let D=w[V];if(D[m.level]===0&&D[m.type]!=="closing"){if(N)throw P("MultipleTopLevelTags",D);if(D[":for"]!==void 0)throw P("ForAttributeOnRootElement",D);N=!0}if(D[m.type]==="opening")E.push({[m.level]:D[m.level],[m.type]:D[m.type],[m.cursorTagStart]:D[m.cursorTagStart],[Symbol.for("componentType")]:D[Symbol.for("componentType")],parent:z});else if(D[m.type]==="closing"){const ee=E.length===0;let re=!1,K=!1;if(ee||(re=E[E.length-1][m.level]!==D[m.level],K=E[E.length-1][Symbol.for("componentType")]!==D[Symbol.for("componentType")]),ee||re||K)throw P("MismatchedClosingTag",D);z=E.pop().parent}const j={...D};delete j[m.type],delete j[m.level],delete j[m.cursorTagStart],D[m.type]==="opening"?(V+1<w.length&&w[V+1][m.type]!=="closing"&&(j.children=[]),z.children.push(j),z=j):D[m.type]==="self-closing"&&z.children.push(j)}if(E.length>0)throw P("UnclosedTags",E);return X},k=10,B=50,I=w=>{const E=_();w=`${w} in ${E}`;const N=new Error(w);N.name="TemplateParseError";const X=Math.max(0,n-k),z=Math.min(s.length,i+B),V=s.slice(X,z),D=i-X;return N.context=O(D,V),N},P=(w,E)=>{const N=_();w=`${w} in ${N}`;const X=new Error(w);X.name="TemplateStructureError",Array.isArray(E)?X.context=E.map(V=>z(V)).join(`
`):X.context=z(E);function z(V){const D=Math.max(0,V[m.cursorTagStart]-k),j=s.slice(D,D+B);return O(k,j)}return X},O=(w,E)=>{const N=" ".repeat(w)+"^";return`
${E}
${N}
`},_=()=>r||"Blits.Application";return g()};let U,Mr;function hn(s={children:[]},t=!1){const e={renderCode:["const elms = []","let componentType","const rootComponent = component","let propData","let slotComponent","let inSlot = false","let slotChildCounter = 0"],effectsCode:[],context:{props:[],components:this.components}};return U=-1,Mr=t,Mr===!0&&e.renderCode.push(`
      function propInComponent(prop, kind="dynamic") {
        const property = prop.includes('.') ? prop.split('.')[0] : prop
        if (kind === 'reactive' || prop.includes('.') === false) {
          if (property in component === false) {
            Log.warn('Property ' +  property + ' was accessed during render but is not defined on instance')
          }
        } else {
          const nestedKeys = prop.split('.')
          let base = component
          for(let i =0; i<nestedKeys.length;i++){
            if (base[nestedKeys[i]] === undefined) {
              Log.warn('Property ' +  nestedKeys.slice(0,i+1).join('.') + ' was accessed during render but is not defined on instance')
            }
            base = base[nestedKeys[i]]
          }
        }
      }
    `),fi.call(e,s),e.renderCode.push("return elms"),{render:new Function("parent","component","context","components","effect","getRaw","Log",e.renderCode.join(`
`)),effects:e.effectsCode.map(r=>new Function("component","elms","context","components","rootComponent","effect",r)),context:e.context}}const un=function(s){const t=/\$\$?\w+(\.\w+)?/g,e=s.match(t);if(e!==null){const r=/\$shader/;return e.filter(i=>!r.test(i))}else return!1},Ls=function(s,t,e="dynamic"){const r=un(s);if(r!==!1)for(let i=0;i<r.length;i++){let n=r[i];e==="reactive"&&n.includes(".")&&(n=n.split(".")[0]),t.push(`propInComponent('${n.replace("$","")}', '${e}')`)}},Ir=function(s,t=!1,e={key:!1,component:"component.",forceEffect:!1,forloop:!1}){const r=e.forceEffect?this.effectsCode:this.renderCode;t&&r.push(`parent = ${t}`),"key"in s&&(e.key=ne(s.key,e.component));const i=e.key?`elms[${U}][${e.key}]`:`elms[${U}]`;e.key&&r.push(`
      if(elms[${U}] === undefined) {
        elms[${U}] = {}
      }
    `),r.push(`const elementConfig${U} = {}`),e.forloop&&r.push(`if(${i} === undefined) {`),r.push(`
    ${i} = this.element({parent: parent || 'root'}, inSlot === true ? slotComponent : component)
  `),e.forloop&&r.push("}");const n=s.children;delete s.children,s[Symbol.for("componentType")]==="Slot"&&r.push(`elementConfig${U}[Symbol.for('isSlot')] = true`),Object.keys(s).forEach(o=>{if(o==="slot"&&r.push(`
        elementConfig${U}['parent'] = slotComponent[Symbol.for('slots')] !== undefined && Array.isArray(slotComponent[Symbol.for('slots')]) === true && slotComponent[Symbol.for('slots')].filter(slot => slot.ref === '${s.slot}').shift() || parent
      `),o==="key")return;const l=s[o];if(ci(o)){if(e.holder&&o===":color")return;e.holder?this.effectsCode.push(`
        if(typeof skip${U} === 'undefined' ||
          skip${U}.indexOf('${o.substring(1)}') === -1)
          ${i}.set('${o.substring(1)}', ${ne(s[o],e.component)})
        `):this.effectsCode.push(`
            ${i}.set('${o.substring(1)}', ${ne(s[o],e.component)})
          `),Mr===!0&&e.component!=="scope."&&l.includes("$")&&Ls(l,r,"reactive"),r.push(`elementConfig${U}['${o.substring(1)}'] = ${ne(l,e.component)}`)}else Mr===!0&&e.component!=="scope."&&l.includes("$")&&Ls(l,r),r.push(`elementConfig${U}['${o}'] = ${Cs(l,o,e.component)}`)}),e.holder===!0&&r.push(`
    const skip${U} = []
    if(typeof cmp${U} !== 'undefined') {
      for(let key in cmp${U}[Symbol.for('config')].props) {
        delete elementConfig${U}[cmp${U}[Symbol.for('config')].props[key]]
        skip${U}.push(cmp${U}[Symbol.for('config')].props[key])
      }
    }
    `),e.forloop&&r.push(`if(${i}.nodeId === undefined) {`),r.push(`${i}.populate(elementConfig${U})`),r.push(`
    if(inSlot === true) {
      slotChildCounter -= 1
    }
  `),e.forloop&&r.push("}"),n&&fi.call(this,{children:n},`${i}`,e)},li=function(s,t=!1,e={key:!1,component:"component.",forceEffect:!1,holder:!1,forloop:!1}){const r=e.forceEffect?this.effectsCode:this.renderCode;r.push(`
    const cmp${U} =
      (context.components && context.components['${s[Symbol.for("componentType")]}']) || components['${s[Symbol.for("componentType")]}']
  `),"key"in s&&(e.key=ne(s.key,e.component));const i=s.children;delete s.children,Ir.call(this,s,t,{...e,holder:!0}),t=e.key?`elms[${U}][${e.key}]`:`elms[${U}]`,U++;const n=e.key?`elms[${U}][${e.key}]`:`elms[${U}]`;e.key&&r.push(`
      if(elms[${U}] === undefined) {
        elms[${U}] = {}
      }
    `),t&&r.push(`parent = ${t}`),r.push(`const props${U} = {}`),e.forloop&&r.push(`if(${n} === undefined) {`),Object.keys(s).forEach(o=>{ci(o)?(this.effectsCode.push(`
        ${n}[Symbol.for('props')]['${o.substring(1)}'] = ${ne(s[o],e.component)}`),r.push(`
        propData = ${ne(s[o],e.component)}
        if (Array.isArray(propData) === true) {
          propData = getRaw(propData).slice(0)
        }
        props${U}['${o.substring(1)}'] = propData`)):r.push(`props${U}['${o}'] = ${Cs(s[o],o,e.component)}`)}),r.push(`
    componentType = props${U}['is'] || '${s[Symbol.for("componentType")]}'

    let component${U}
    if(typeof componentType === 'string') {
      component${U} = context.components && context.components[componentType] || components[componentType]
      if(!component${U}) {
        throw new Error('Component "${s[Symbol.for("componentType")]}" not found')
      }
    } else if(typeof componentType === 'function' && componentType[Symbol.for('isComponent')] === true) {
      component${U} = componentType
    }

    ${n} = component${U}.call(null, {props: props${U}}, ${t}, component)

    if (${n}[Symbol.for('slots')][0]) {
      parent = ${n}[Symbol.for('slots')][0]
      slotComponent = ${n}
      inSlot = true
    } else {
      parent = ${n}[Symbol.for('children')][0]
    }
  `),e.forloop&&r.push("}"),i&&(e.forloop||r.push(`
        if(inSlot === true) {
          slotChildCounter = ${i.length}  + 1
        }
      `),U++,Ir.call(this,{children:i},!1,{...e})),e.forloop||r.push(`
      if (inSlot === true && slotChildCounter === 0) {
        inSlot = false
      }
    `)},dn=function(s,t){const e=s[":for"];delete s[":for"];const r=s.range||s[":range"]||"{}";delete s.range,delete s[":range"];const i=s.key,n=ne(i,"scope."),o=!(s.$shallow&&s.$shallow.toLowerCase()==="false");delete s.$shallow,delete s.key;const a=/(.+)\s+in\s+(.+)/gi.exec(e),[c,u]=a[1].replace("(","").replace(")","").split(/\s*,\s*/),d=new RegExp(`(scope\\.(?!${c}\\.|${u}|key)(\\w+))`,"gi"),h={renderCode:[],effectsCode:[],context:{props:[],components:this.components}};if(t&&h.renderCode.push(`parent = ${t}`),u!==void 0){const M=new RegExp(`\\$${u}(?!['\\w])`).exec(i);Array.isArray(M)&&h.renderCode.push(`console.warn(" Using '${u}' in the key, like key=${i},  is not recommended")`)}const p=U;h.renderCode.push(`
    const created${p} = []

    let from${p}
    let to${p}

    const forloop${p} = (collection = [], elms, created) => {
      const rawCollection = getRaw(collection)
      const keys = new Set()
      let l = rawCollection.length

      const range = ${ne(r)} || {}
      from${p} = range['from'] || 0
      to${p} = 'to' in range ? range['to'] : rawCollection.length

      while(l--) {
        const ${c} = rawCollection[l]
  `),u!==void 0&&h.renderCode.push(`
        const ${u} = l
    `),h.renderCode.push(`
        if(l < to${p} && l >= from${p}) {
          keys.add('' +  ${ne(i,"")||"l"})
        }
      }
  `);const g=h.renderCode.length;h.renderCode.push(`
      created.length = 0
      const length = rawCollection.length
      const effects = []
      for(let __index = 0; __index < length; __index++) {
        if(__index < from${p} || __index >= to${p}) continue
        const scope = Object.create(component)
        parent = ${t}
        scope['${c}'] = rawCollection[__index]
  `),u!==""&&h.renderCode.push(`
        scope['${u}'] = __index
    `),h.renderCode.push(`
        scope['key'] = '' + ${n||"__index"}
  `),"ref"in s&&s.ref.indexOf("$")===-1&&(h.renderCode.push(`
        scope['__ref'] = '${s.ref}' + __index
    `),s.ref="$__ref"),h.renderCode.push(`
        created.push(scope.key)
  `),s[Symbol.for("componentType")]==="Element"||s[Symbol.for("componentType")]==="Slot"||s[Symbol.for("componentType")]==="Text"?(s[Symbol.for("componentType")]==="Text"&&(s.__textnode="true"),Ir.call(h,s,t,{key:"scope.key",component:"scope.",forceEffect:!1,forloop:!0})):li.call(h,s,!1,{key:"scope.key",component:"scope.",forceEffect:!1,forloop:!0});const x=h.effectsCode.filter(A=>[...A.matchAll(d)].length===0),T=h.effectsCode.filter(A=>[...A.matchAll(d)].length!==0);o===!1&&h.renderCode.push(`
      scope['${c}'] = null
      scope['${c}'] = collection[__index]
  `),x.forEach((A,M)=>{const L=A.indexOf(`scope.${M}`)>-1?`'${ne(a[2],"")}'`:null;A.indexOf("Symbol.for('props')")===-1?h.renderCode.push(`
        let eff${M} = () => {
          ${A}
        }
        effect(eff${M}, ${L})
        effects.push(eff${M})
      `):h.renderCode.push(`
        ${A}
      `)}),h.renderCode.push(`
    }
    return effects
  }`);const y=[];y.push(`
      let i = created.length

      while (i--) {
        if (keys.has(created[i]) === false) {
          const key = created[i]
  `);const S=U;for(let A=p;A<=S;A++)y.push(`
          elms[${A}][key] && elms[${A}][key].destroy()
          delete elms[${A}][key]
      `);y.push(`
      }
    }
  `),h.renderCode.splice(g,0,...y);let v=`${ne(a[2],"")}`;v&&v.includes(".")&&(v=v.match(/[^.]+$/)[0]);const C=/\$([^,} ]+)/g,$=[...r.matchAll(C)].map(A=>`'${A[1]}'`);h.renderCode.push(`
    let forEffects${p}
    effect(() => {
      component[Symbol.for('removeGlobalEffects')](forEffects${p})
      forEffects${p} = null
      forEffects${p} = forloop${p}(${Cs(a[2],":for")}, elms, created${p})
    }, ['${v}', ${$.join(",")}] )
  `),T.forEach(A=>{const M=[...A.matchAll(d)];let L=M.length;const W=[];for(;L--;){const k=M[L],B=`component.${k[2]}`;W.indexOf(B)===-1&&W.push(B),k[2]!==c&&(A=A.substring(0,k.index)+B+A.substring(k.index+k[1].length))}h.renderCode.push(`
      effect(() => {
        void ${W.join(", ")}
        for(let __index = 0; __index < ${ne(a[2])}.length; __index++) {
          if(__index < from${p} || __index >= to${p}) continue
          const scope = {}
          scope['${u}'] = __index
          scope['${c}'] = ${ne(a[2])}[__index]
          scope['key'] = ${n||"__index"}
    `),h.renderCode.push(`
          ${A}
        }
      })
    `)}),this.renderCode.push(h.renderCode.join(`
`))},fi=function(s,t=!1,e={}){s.children&&s.children.forEach(r=>{U++,Object.keys(r).indexOf(":for")>-1?dn.call(this,r,t):r[Symbol.for("componentType")]==="Element"||r[Symbol.for("componentType")]==="Slot"||r[Symbol.for("componentType")]==="Text"||r[Symbol.for("componentType")]==="Layout"?(r[Symbol.for("componentType")]==="Text"&&(r.__textnode="true"),r[Symbol.for("componentType")]==="Layout"&&(r.__layout="true"),Ir.call(this,r,t,e)):li.call(this,r,t,e)})},ne=(s,t="component.")=>{if(s===void 0)return s;const e=/('.*?')+/gi,r=/\$(\$(?=\$)|\$?)/g,i=s.matchAll(e),n=[];let o=0;for(const l of i)n.push(l[0]),s=s.replace(l[0],`[@@REPLACEMENT${o}@@]`),o++;return s=s.replace(r,(l,a)=>{if(a==="")return t;if(a==="$")return t+"$"}),n.forEach((l,a)=>{s=s.replace(`[@@REPLACEMENT${a}@@]`,l)}),s},Cs=(s="",t=!1,e="component.")=>{const r=/\$\w+/gi;let i;if(t==="content")if(s.startsWith("$"))i=`${e}${s.replace("$","")}`;else{const n=s.replace(/\\\\/g,"__DOUBLE_BACKSLASH__").replace(/(^|[^\\])'/g,"$1\\'").replace(/__DOUBLE_BACKSLASH__/g,"\\\\");i=`'${pn(n,e)}'`}else if(t!=="color"&&/[^0-9%\s.eE]/.test(s)===!1&&!isNaN(parseFloat(s))){if(i=parseFloat(s),s.endsWith("%")){const o={w:"width",width:"width",x:"width",h:"height",height:"height",y:"height"}[t];o&&(i=`parent.node.${o} * (${i} / 100)`)}}else if(s.toLowerCase()==="true")i=!0;else if(s.toLowerCase()==="false")i=!1;else if(t.startsWith("@")&&s){const n=e.slice(0,-1);i=`${n}['${s.replace("$","")}'] && ${n}['${s.replace("$","")}'].bind(${n})`}else if(s.startsWith("$"))i=`${e}${s.replace("$","")}`;else if(r.exec(s)){const n=/\w+\s*:\s*(?:[^\s,}]+|".*?"|'.*?')/g,o=s.match(n);if(i={},o)for(let l=0;l<o.length;l++){const a=o[l].split(/\s*:\s*/);a&&mn(a[0],a[1],e,i)}return gn(i)}else i=`"${s}"`;return i},ci=s=>s.startsWith(":"),pn=(s,t)=>{const e=/\{\{\s*(\$\S+)\s*\}\}/g,r=[...s.matchAll(e)];if(r.length)for(let[i,n]of r)s=s.replace(i,`${n.replace("$",`'+${t}`)}+'`);return s},mn=(s,t,e,r)=>{t.startsWith("$")?r[s]=`${e}${t.replace("$","")}`:r[s]=t},gn=s=>{const t=[];return Object.keys(s).forEach(e=>{t.push(`${e}: ${s[e]}`)}),` { ${t.join(", ")} }`},Ps={};let xn=0;const yn=s=>`BlitsComponent::${s}_${Ps[s]=(Ps[s]||0)+1}`,Tn=()=>++xn,$e={},is=(s,t,e,r=[])=>{$e[t]&&$e[t][s]&&$e[t][s].apply(e,r)},bn=(s,t,e)=>{const r=m[s];$e[t]&&$e[t][r]&&$e[t][r].apply(e)},Sn=(s={},t)=>{$e[t]={},[...Object.keys(s),...Object.getOwnPropertySymbols(s)].forEach(r=>{typeof s[r]=="function"&&($e[t][r]=s[r])})};let mt=null,lt=null,Nr=!1;const wn=()=>{Nr=!0},vn=()=>{Nr=!1},Lr=new WeakMap,Tr=new Map,Bs=s=>{if(Tr.size!==0)for(const[t,e]of Tr){if(s.indexOf(t)===-1)continue;const r=Lr.get(e);if(r!==void 0)for(const i of r.values())i.delete(t),Tr.delete(t)}},br=(s,t,e=!1)=>{if(mt!==null){if(Nr)return;if(Array.isArray(lt)===!0){if(lt.includes(t)===!1)return}else if(lt!==null&&t!==lt)return;let r=Lr.get(s);r===void 0&&(r=new Map,Lr.set(s,r));let i=r.get(t);i===void 0&&(i=new Set,r.set(t,i)),i.add(mt),e===!0&&Tr.set(mt,s)}},gt=(s,t,e=!1)=>{if(Nr===!0)return;const r=Lr.get(s);if(r===void 0)return;const i=r.get(t);if(i!==void 0)for(let n of i)n(e)},or=(s,t=null)=>{mt=s,lt=t,mt(),mt=null,lt=null},ns=(s,t)=>{if(s===t)return!0;if(s.length!==t.length)return!1;let e=s.length;for(;e--;){const r=s[e],i=t[e];if(Array.isArray(r)&&Array.isArray(i)){if(ns(r,i)===!1)return!1}else if(typeof r=="object"&&r!==null&&typeof i=="object"&&i!==null){if(ns(Object.entries(r),Object.entries(i))===!1)return!1}else if(r!==i)return!1}return!0},Sr=["push","pop","shift","unshift","splice","sort"],ks=new WeakMap,Ve=s=>{const t=s&&s[m.raw];return t?Ve(t):s},os=(s,t=null,e,r)=>{if(typeof s=="object"&&Array.isArray(s)===!1&&Object.getPrototypeOf(s)!==Object.prototype)return s;const i=ks.get(s);if(i!==void 0)return i;const n={get(l,a,c){return a===m.raw?s:Array.isArray(l)===!0?typeof l[a]=="object"&&l[a]!==null?(Array.isArray(l[a])===!0&&br(l,a,r),os(Ve(l[a]),l,a)):Sr.indexOf(a)!==-1?function(...u){wn();const d=l[a].apply(this,u);return vn(),gt(t,e),d}:a==="length"?s.length:Reflect.get(l,a,c):typeof l[a]=="object"&&l[a]!==null?(Array.isArray(l[a])===!0&&br(l,a,r),os(Ve(l[a]),l,a)):(br(l,a,r),Reflect.get(l,a,c))},set(l,a,c,u){const d=Ve(l[a]),h=Ve(c);let p=!0,g=!1;return Array.isArray(h)===!0&&Array.isArray(d)===!0?g=ns(d,h):d===h&&(g=!0),g===!1&&(typeof c=="object"&&(Array.isArray(c)===!0?c=Ve(c).slice(0):c!==null&&l[a]!==null&&l[a]!==void 0&&Array.isArray(l)===!1&&Object.getPrototypeOf(c)===Object.prototype&&(c=Object.assign(u[a],c))),p=Reflect.set(l,a,c,u)),p===!0&&g===!1&&(Array.isArray(l)===!0&&a in l&&gt(t,e,!0),gt(l,a,!0)),p}},o=new Proxy(s,n);return ks.set(s,o),o},hi=(s,t)=>(Object.keys(s).forEach(e=>{let r=s[e];if(s[e]!==null&&typeof s[e]=="object"){if(Object.getPrototypeOf(s[e])===Object.prototype)return hi(s[e]);if(Array.isArray(s[e])===!0)for(let i=0;i<Sr.length-1;i++)s[e][Sr[i]]=function(n){Array.prototype[Sr[i]].call(this,n),gt(s,e)}}Object.defineProperty(s,e,{enumerable:!0,configurable:!0,get(){return br(s,e,t),r},set(i){r!==i&&(r=i,gt(s,e))}})}),s),Cn=typeof Proxy<"u",as=(s,t="Proxy",e=!1)=>(Cn===!1&&(t="defineProperty"),t==="defineProperty"?hi(s,e):os(s,void 0,void 0,e)),Rn=["init","ready","focus","unfocus","destroy","attach","detach","enter","exit"],_n={previous:null,current:null,get state(){return this.current},set state(s){Rn.indexOf(s)>-1&&(s!==this.current||s==="focus")&&(G.debug(`Setting lifecycle state from ${this.current} to ${s} for ${this.component.componentId}`),this.previous=this.current,this.current=s,bn(s,this.component[m.identifier],this.component),is(s,this.component[m.identifier],this.component))}},En="modulepreload",An=function(s){return"/"+s},Fs={},Mn=function(t,e,r){let i=Promise.resolve();if(e&&e.length>0){let o=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),a=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=o(e.map(c=>{if(c=An(c),c in Fs)return;Fs[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":En,u||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((p,g)=>{h.addEventListener("load",p),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&n(l.reason);return t().catch(n)})},In={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function Ln(s,t=!1,e){const r={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1},i=s.getContext(t?"webgl2":"webgl",r)||s.getContext("experimental-webgl",r);if(!i)throw new Error("Unable to create WebGL context");return e?new Proxy(i,{get(n,o){const l=n[o];return typeof l=="function"?(e.increment(String(o)),l.bind(n)):l}}):i}function R(s,t){if(Tt()!==!0&&!s)throw new Error(t||"Assertion failed")}function Os(s,t,e){const r=Math.trunc(s>>>24),i=Math.trunc(s>>>16&255),n=Math.trunc(s>>>8&255),o=Math.trunc(s&255),l=Math.trunc(t>>>24),a=Math.trunc(t>>>16&255),c=Math.trunc(t>>>8&255),u=Math.trunc(t&255),d=Math.round(l*e+r*(1-e)),h=Math.round(a*e+i*(1-e)),p=Math.round(c*e+n*(1-e)),g=Math.round(u*e+o*(1-e));return(d<<24|h<<16|p<<8|g)>>>0}function Pn(s,t){const e=s>>>24,r=s>>>16&255,i=s>>>8&255,n=Math.trunc((s&255)*t);return(e<<24|r<<16|i<<8|n)>>>0}let ui=!0;function Bn(s){ui=s==="webgl"}function ar(s,t,e=!1){const r=(s&255)/255*t,i=ui?r:1,n=Math.trunc((s>>>24)*i),o=Math.trunc((s>>>16&255)*i),l=Math.trunc((s>>>8&255)*i),a=Math.trunc(r*255);return e?(a<<24|l<<16|o<<8|n)>>>0:(n<<24|o<<16|l<<8|a)>>>0}function Pr(s,t){return Object.prototype.hasOwnProperty.call(s,t)}function Tt(){return In&&!0}let kn=1;function Fn(){return kn++}class xe{constructor(){f(this,"eventListeners",{})}on(t,e){let r=this.eventListeners[t];r||(r=[]),r.push(e),this.eventListeners[t]=r}off(t,e){const r=this.eventListeners[t];if(!r)return;if(!e){delete this.eventListeners[t];return}const i=r.indexOf(e);i>=0&&r.splice(i,1)}once(t,e){const r=(i,n)=>{this.off(t,r),e(i,n)};this.on(t,r)}emit(t,e){const r=this.eventListeners[t];r&&[...r].forEach(i=>{i(this,e)})}removeAllListeners(){this.eventListeners={}}}var H;(function(s){s[s.generic=0]="generic",s[s.color=1]="color",s[s.image=2]="image",s[s.noise=3]="noise",s[s.renderToTexture=4]="renderToTexture",s[s.subTexture=5]="subTexture"})(H||(H={}));class Ot extends xe{constructor(e){super();f(this,"txManager");f(this,"_dimensions",null);f(this,"_error",null);f(this,"state","initial");f(this,"renderableOwners",new Set);f(this,"renderable",!1);f(this,"type",H.generic);f(this,"preventCleanup",!1);f(this,"ctxTexture");f(this,"textureData",null);this.txManager=e}get dimensions(){return this._dimensions}get error(){return this._error}setRenderableOwner(e,r){var n,o;const i=this.renderableOwners.size;if(r===!0){this.renderableOwners.has(e)===!1&&this.renderableOwners.add(e);const l=this.renderableOwners.size;l>i&&l===1&&(this.renderable=!0,(n=this.onChangeIsRenderable)==null||n.call(this,!0),this.load())}else{this.renderableOwners.delete(e);const l=this.renderableOwners.size;l<i&&l===0&&(this.renderable=!1,(o=this.onChangeIsRenderable)==null||o.call(this,!1),this.txManager.orphanTexture(this))}}load(){this.txManager.loadTexture(this)}loadCtxTexture(){return this.ctxTexture===void 0&&(this.ctxTexture=this.txManager.renderer.createCtxTexture(this)),this.ctxTexture}free(){var e;(e=this.ctxTexture)==null||e.free()}freeTextureData(){this.textureData=null}setState(e,r){if(this.state===e)return;let i=null;e==="loaded"?(r!==void 0&&"width"in r&&"height"in r&&r.width!==void 0&&r.height!==void 0&&(this._dimensions=r),i=this._dimensions):e==="failed"&&(this._error=r,i=this._error),this.state=e,this.emit(e,i)}async getTextureData(){return this.textureData===null&&(this.textureData=await this.getTextureSource()),this.textureData}static makeCacheKey(e){return!1}static resolveDefaults(e){return{}}}const On=/^(data|ftps?|https?):/,Ut=s=>{const t=s>>>24,e=s>>>16&255,r=s>>>8&255,i=s&255;return[t/255,e/255,r/255,i/255]},Us=s=>{const t=s>>>24,e=s>>>16&255,r=s>>>8&255,i=s&255;return[t,e,r,i]};function $s(s){return(s&255)/255}function Kr(s){const t=Math.floor(s[0]*255),e=Math.floor(s[1]*255),r=Math.floor(s[2]*255),i=Math.floor(s[3]*255);return`rgba(${t},${e},${r},${i.toFixed(4)})`}function ft(s,t,e,r,i){return i?(i.x1=s,i.y1=t,i.x2=e,i.y2=r,i):{x1:s,y1:t,x2:e,y2:r}}function jr(s,t){return s.x1<t.x2&&s.x2>t.x1&&s.y1<t.y2&&s.y2>t.y1}function Un(s,t){return t?(t.x=s.x1,t.y=s.y1,t.width=s.x2-s.x1,t.height=s.y2-s.y1,t):{x:s.x1,y:s.y1,width:s.x2-s.x1,height:s.y2-s.y1}}function di(s,t,e){const r=Math.max(s.x,t.x),i=Math.max(s.y,t.y),n=Math.min(s.x+s.width,t.x+t.width)-r,o=Math.min(s.y+s.height,t.y+t.height)-i;return n>0&&o>0?e?(e.x=r,e.y=i,e.width=n,e.height=o,e):{x:r,y:i,width:n,height:o}:e?(e.x=0,e.y=0,e.width=0,e.height=0,e):{x:0,y:0,width:0,height:0}}function pi(s,t){return t?(t.x=s.x,t.y=s.y,t.width=s.width,t.height=s.height,t):{x:s.x,y:s.y,width:s.width,height:s.height}}function $n(s,t){return s===t?!0:s===null||t===null?!1:s.x===t.x&&s.y===t.y&&s.width===t.width&&s.height===t.height}function qr(s,t){return s.x1<=t.x2&&s.y1<=t.y2&&s.x2>=t.x1&&s.y2>=t.y1}function Dn(s,t){return s.x1<t.x1&&s.x2>t.x2&&s.y1<t.y1&&s.y2>t.y2}function Nn(s){return s.x1<s.x2&&s.y1<s.y2}function ls(s,t){return ft(s.x1-t[3],s.y1-t[0],s.x2+t[1],s.y2+t[2])}function zn(s){if(self.location.protocol==="file:"&&!On.test(s)){const e=self.location.pathname.split("/");e.pop();const r=e.join("/"),i=self.location.protocol+"//"+r;return s.charAt(0)==="."&&(s=s.slice(1)),s.charAt(0)==="/"&&(s=s.slice(1)),i+"/"+s}return new URL(s,self.location.href).href}function Qr(s){return s.startsWith("data:")===!0}function Wn(s){var a,c;s=s.replace(/^data:/,"");const t=((a=s.match(/image\/[^;]+/))==null?void 0:a[0])||"",e=s.replace(/^[^,]+,/,""),r=1024,i=atob(e),n=i.length,o=Math.ceil(n/r),l=new Array(o);for(let u=0;u<o;++u){const d=u*r,h=Math.min(d+r,n),p=new Array(h-d);for(let g=d,x=0;g<h;++x,++g)p[x]=(c=i[g])==null?void 0:c.charCodeAt(0);l[u]=new Uint8Array(p)}return new Blob(l,{type:t})}class Q{constructor(){f(this,"ta");f(this,"tb");f(this,"tx");f(this,"tc");f(this,"td");f(this,"ty");f(this,"_floatArr",null);f(this,"mutation");this.ta=0,this.tb=0,this.tx=0,this.tc=0,this.td=0,this.ty=0,this.mutation=!0}static get temp(){return Xn}static multiply(t,e,r){const i=t.ta*e.ta+t.tb*e.tc,n=t.ta*e.tb+t.tb*e.td,o=t.ta*e.tx+t.tb*e.ty+t.tx,l=t.tc*e.ta+t.td*e.tc,a=t.tc*e.tb+t.td*e.td,c=t.tc*e.tx+t.td*e.ty+t.ty;return r||(r=new Q),r.ta=i,r.tb=n,r.tx=o,r.tc=l,r.td=a,r.ty=c,r.mutation=!0,r}static identity(t){return t||(t=new Q),t.ta=1,t.tb=0,t.tx=0,t.tc=0,t.td=1,t.ty=0,t.mutation=!0,t}static translate(t,e,r){return r||(r=new Q),r.ta=1,r.tb=0,r.tx=t,r.tc=0,r.td=1,r.ty=e,r.mutation=!0,r}static scale(t,e,r){return r||(r=new Q),r.ta=t,r.tb=0,r.tx=0,r.tc=0,r.td=e,r.ty=0,r.mutation=!0,r}static rotate(t,e){const r=Math.cos(t),i=Math.sin(t);return e||(e=new Q),e.ta=r,e.tb=-i,e.tx=0,e.tc=i,e.td=r,e.ty=0,e.mutation=!0,e}static copy(t,e){return e||(e=new Q),e.ta=t.ta,e.tc=t.tc,e.tb=t.tb,e.td=t.td,e.tx=t.tx,e.ty=t.ty,e.mutation=!0,e}translate(t,e){return this.tx=this.ta*t+this.tb*e+this.tx,this.ty=this.tc*t+this.td*e+this.ty,this.mutation=!0,this}scale(t,e){return this.ta=this.ta*t,this.tb=this.tb*e,this.tc=this.tc*t,this.td=this.td*e,this.mutation=!0,this}rotate(t){if(t===0||!(t%Math.PI*2))return this;const e=Math.cos(t),r=Math.sin(t),i=this.ta*e+this.tb*r,n=this.tb*e-this.ta*r,o=this.tc*e+this.td*r,l=this.td*e-this.tc*r;return this.ta=i,this.tb=n,this.tc=o,this.td=l,this.mutation=!0,this}multiply(t){return Q.multiply(this,t,this)}getFloatArr(){return this._floatArr||(this._floatArr=new Float32Array(9)),this.mutation&&(this._floatArr[0]=this.ta,this._floatArr[1]=this.tc,this._floatArr[2]=0,this._floatArr[3]=this.tb,this._floatArr[4]=this.td,this._floatArr[5]=0,this._floatArr[6]=this.tx,this._floatArr[7]=this.ty,this._floatArr[8]=1,this.mutation=!1),this._floatArr}}const Xn=new Q,lr=0,fr=2,cr=4,hr=6,ur=1,dr=3,pr=5,mr=7;class ct{constructor(t){f(this,"data");this.data=new Float32Array(8),t&&(this.data[lr]=t[lr],this.data[fr]=t[fr],this.data[cr]=t[cr],this.data[hr]=t[hr],this.data[ur]=t[ur],this.data[dr]=t[dr],this.data[pr]=t[pr],this.data[mr]=t[mr])}static translate(t,e,r,i,n,o,l,a,c){return c||(c=new ct),c.data[lr]=t,c.data[fr]=r,c.data[cr]=n,c.data[hr]=l,c.data[ur]=e,c.data[dr]=i,c.data[pr]=o,c.data[mr]=a,c}get x1(){return this.data[lr]}get x2(){return this.data[fr]}get x3(){return this.data[cr]}get x4(){return this.data[hr]}get y1(){return this.data[ur]}get y2(){return this.data[dr]}get y3(){return this.data[pr]}get y4(){return this.data[mr]}}const mi=(s,t,e,r)=>{const i=3*s,n=3*(e-s)-i,o=1-i-n,l=3*t,a=3*(r-t)-l,c=1-l-a;return function(u){if(u>=1)return 1;if(u<=0)return 0;let d=.5,h,p,g;for(let y=0;y<20;y++){if(h=d*(d*(d*o+n)+i),g=u-h,g>-1e-8&&g<1e-8)return d*(d*(d*c+a)+l);if(p=d*(d*(3*o)+2*n)+i,p>1e-10&&p<1e-10)break;d+=g/p}let x=0,T=1;for(let y=0;y<20;y++){if(d=.5*(x+T),h=d*(d*(d*o+n)+i),g=u-h,g>-1e-8&&g<1e-8)return d*(d*(d*c+a)+l);g<0?T=d:x=d}}},wr={},Vn={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-sine":[.12,0,.39,0],"ease-out-sine":[.12,0,.39,0],"ease-in-out-sine":[.37,0,.63,1],"ease-in-cubic":[.32,0,.67,0],"ease-out-cubic":[.33,1,.68,1],"ease-in-out-cubic":[.65,0,.35,1],"ease-in-circ":[.55,0,1,.45],"ease-out-circ":[0,.55,.45,1],"ease-in-out-circ":[.85,0,.15,1],"ease-in-back":[.36,0,.66,-.56],"ease-out-back":[.34,1.56,.64,1],"ease-in-out-back":[.68,-.6,.32,1.6]},vr=s=>s,Gn=s=>{const t=/-?\d*\.?\d+/g,e=s.match(t);if(e){const[r,i,n,o]=e,l=parseFloat(r||"0.42"),a=parseFloat(i||"0"),c=parseFloat(n||"1"),u=parseFloat(o||"1"),d=mi(l,a,c,u);return wr[s]=d,d}return console.warn("Unknown cubic-bezier timing: "+s),vr},Yn=s=>{if(s==="linear")return vr;if(wr[s]!==void 0)return wr[s]||vr;if(s==="step-start")return()=>1;if(s==="step-end")return e=>e===1?1:0;const t=Vn[s];if(t!==void 0){const[e,r,i,n]=t,o=mi(e,r,i,n);return wr[s]=o,o}return s.startsWith("cubic-bezier")?Gn(s):(console.warn("Unknown timing function: "+s),vr)};function Ds(s){return(s/1024/1024).toFixed(2)}class Hn extends xe{constructor(e,r,i){super();f(this,"node");f(this,"props");f(this,"settings");f(this,"progress",0);f(this,"delayFor",0);f(this,"delay",0);f(this,"timingFunction");f(this,"propValuesMap",{});f(this,"dynPropValuesMap");this.node=e,this.props=r;for(const l in r)if(l!=="shaderProps")this.propValuesMap.props===void 0&&(this.propValuesMap.props={}),this.propValuesMap.props[l]={start:e[l]||0,target:r[l]};else if(e.shader.type!=="DynamicShader"){this.propValuesMap.shaderProps={};for(const a in r.shaderProps)this.propValuesMap.shaderProps[a]={start:e.shader.props[a],target:r.shaderProps[a]}}else{const a=Object.keys(r.shaderProps),c=a.length;this.dynPropValuesMap={};for(let u=0;u<c;u++){const d=a[u],h=r.shaderProps[d];this.dynPropValuesMap[d]={};const p=Object.entries(h),g=p.length;for(let x=0;x<g;x++){const[T,y]=p[x];this.dynPropValuesMap[d][T]={start:e.shader.props[d][T],target:y}}}}const n=i.easing||"linear",o=i.delay??0;this.settings={duration:i.duration??0,delay:o,easing:n,loop:i.loop??!1,repeat:i.repeat??0,repeatDelay:i.repeatDelay??0,stopMethod:i.stopMethod??!1},this.timingFunction=Yn(n),this.delayFor=o,this.delay=o}reset(){this.progress=0,this.delayFor=this.settings.delay||0,this.update(0)}restoreValues(e,r){const i=Object.entries(r),n=i.length;for(let o=0;o<n;o++){const[l,a]=i[o];e[l]=a.start}}restore(){if(this.reset(),this.propValuesMap.props!==void 0&&this.restoreValues(this.node,this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.restoreValues(this.node.shader.props,this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const e=Object.keys(this.dynPropValuesMap),r=e.length;if(r>0)for(let i=0;i<r;i++){const n=e[i];this.restoreValues(this.node.shader.props[n],this.dynPropValuesMap[n])}}}reverseValues(e){const r=Object.entries(e),i=r.length;for(let n=0;n<i;n++){const[o,l]=r[n];e[o]={start:l.target,target:l.start}}}reverse(){if(this.progress=0,this.propValuesMap.props!==void 0&&this.reverseValues(this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.reverseValues(this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const e=Object.keys(this.dynPropValuesMap),r=e.length;if(r>0)for(let i=0;i<r;i++){const n=e[i];this.reverseValues(this.dynPropValuesMap[n])}}this.settings.loop||(this.settings.stopMethod=!1)}applyEasing(e,r,i){return(this.timingFunction(e)||e)*(i-r)+r}updateValue(e,r,i,n){if(this.progress===1)return r;if(this.progress===0)return i;const o=r;if(e.indexOf("color")!==-1){if(i===o)return i;if(n){const l=this.timingFunction(this.progress)||this.progress;return Os(i,o,l)}return Os(i,o,this.progress)}return n?this.applyEasing(this.progress,i,o):i+(o-i)*this.progress}updateValues(e,r,i){const n=Object.entries(r),o=n.length;for(let l=0;l<o;l++){const[a,c]=n[l];e[a]=this.updateValue(a,c.target,c.start,i)}}update(e){const{duration:r,loop:i,easing:n,stopMethod:o}=this.settings,{delayFor:l}=this;if(r===0&&l===0){this.emit("finished",{});return}if(this.delayFor>0){if(this.delayFor-=e,this.delayFor>=0)return;e=-this.delayFor,this.delayFor=0}if(r===0){this.emit("finished",{});return}if(this.progress===0&&this.emit("animating",{}),this.progress+=e/r,this.progress>1&&(this.progress=i?0:1,this.delayFor=this.delay,o)){this.emit("finished",{});return}if(this.propValuesMap.props!==void 0&&this.updateValues(this.node,this.propValuesMap.props,n),this.propValuesMap.shaderProps!==void 0&&this.updateValues(this.node.shader.props,this.propValuesMap.shaderProps,n),this.dynPropValuesMap!==void 0){const a=Object.keys(this.dynPropValuesMap),c=a.length;if(c>0)for(let u=0;u<c;u++){const d=a[u];this.updateValues(this.node.shader.props[d],this.dynPropValuesMap[d],n)}}this.progress<1&&this.emit("tick",{progress:this.progress}),this.progress===1&&this.emit("finished",{})}}class Kn extends xe{constructor(e,r){super();f(this,"manager");f(this,"animation");f(this,"stoppedPromise");f(this,"stoppedResolve",null);f(this,"state");this.manager=e,this.animation=r,this.state="stopped",this.stoppedPromise=Promise.resolve(),this.onAnimating=this.onAnimating.bind(this),this.onFinished=this.onFinished.bind(this),this.onTick=this.onTick.bind(this)}start(){return this.state!=="running"&&this.state!=="scheduled"&&(this.makeStoppedPromise(),this.registerAnimation(),this.state="scheduled"),this}stop(){return this.unregisterAnimation(),this.stoppedResolve!==null&&(this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this)),this.animation.reset(),this.state="stopped",this}pause(){return this.unregisterAnimation(),this.state="paused",this}restore(){return this.stoppedResolve=null,this.animation.restore(),this}waitUntilStopped(){return this.stoppedPromise}registerAnimation(){this.animation.once("finished",this.onFinished),this.animation.on("animating",this.onAnimating),this.animation.on("tick",this.onTick),this.manager.registerAnimation(this.animation)}unregisterAnimation(){this.manager.unregisterAnimation(this.animation),this.animation.off("finished",this.onFinished),this.animation.off("animating",this.onAnimating),this.animation.off("tick",this.onTick)}makeStoppedPromise(){this.stoppedResolve===null&&(this.stoppedPromise=new Promise(e=>{this.stoppedResolve=e}))}onFinished(){R(this.stoppedResolve);const{loop:e,stopMethod:r}=this.animation.settings;if(r==="reverse"){this.animation.once("finished",this.onFinished),this.animation.reverse();return}e||(this.unregisterAnimation(),this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this),this.state="stopped")}onAnimating(){this.state="running",this.emit("animating",this)}onTick(e,r){this.emit("tick",r)}}var Z;(function(s){s[s.Init=0]="Init",s[s.OutOfBounds=2]="OutOfBounds",s[s.InBounds=4]="InBounds",s[s.InViewport=8]="InViewport"})(Z||(Z={}));const $t=new Map;$t.set(Z.Init,"init");$t.set(Z.OutOfBounds,"outOfBounds");$t.set(Z.InBounds,"inBounds");$t.set(Z.InViewport,"inViewport");var b;(function(s){s[s.Children=1]="Children",s[s.ScaleRotate=2]="ScaleRotate",s[s.Local=4]="Local",s[s.Global=8]="Global",s[s.Clipping=16]="Clipping",s[s.CalculatedZIndex=32]="CalculatedZIndex",s[s.ZIndexSortedChildren=64]="ZIndexSortedChildren",s[s.PremultipliedColors=128]="PremultipliedColors",s[s.WorldAlpha=256]="WorldAlpha",s[s.RenderState=512]="RenderState",s[s.IsRenderable=1024]="IsRenderable",s[s.RenderTexture=2048]="RenderTexture",s[s.ParentRenderTexture=4096]="ParentRenderTexture",s[s.RenderBounds=8192]="RenderBounds",s[s.None=0]="None",s[s.All=14335]="All"})(b||(b={}));class fs extends xe{constructor(e,r){super();f(this,"stage");f(this,"children",[]);f(this,"_id",Fn());f(this,"props");f(this,"updateType",b.All);f(this,"childUpdateType",b.None);f(this,"globalTransform");f(this,"scaleRotateTransform");f(this,"localTransform");f(this,"sceneGlobalTransform");f(this,"renderCoords");f(this,"sceneRenderCoords");f(this,"renderBound");f(this,"strictBound");f(this,"preloadBound");f(this,"clippingRect",{x:0,y:0,width:0,height:0,valid:!1});f(this,"isRenderable",!1);f(this,"renderState",Z.Init);f(this,"worldAlpha",1);f(this,"premultipliedColorTl",0);f(this,"premultipliedColorTr",0);f(this,"premultipliedColorBl",0);f(this,"premultipliedColorBr",0);f(this,"calcZIndex",0);f(this,"hasRTTupdates",!1);f(this,"parentHasRenderTexture",!1);f(this,"rttParent",null);f(this,"onTextureLoaded",(e,r)=>{var i,n;this.autosizeNode(r),this.setUpdateType(b.IsRenderable),this.stage.requestRender(),this.parentHasRenderTexture&&this.notifyParentRTTOfUpdate(),r.width>1&&r.height>1&&this.emit("loaded",{type:"texture",dimensions:r}),((n=(i=this.props.textureOptions)==null?void 0:i.resizeMode)==null?void 0:n.type)==="contain"&&this.setUpdateType(b.Local)});f(this,"onTextureFailed",(e,r)=>{this.setUpdateType(b.IsRenderable),this.parentHasRenderTexture&&this.notifyParentRTTOfUpdate(),this.emit("failed",{type:"texture",error:r})});f(this,"onTextureFreed",()=>{this.setUpdateType(b.IsRenderable),this.parentHasRenderTexture&&this.notifyParentRTTOfUpdate(),this.emit("freed",{type:"texture"})});this.stage=e,this.props={...r,parent:null,texture:null,src:null,rtt:!1},this.parent=r.parent,this.texture=r.texture,this.src=r.src,this.rtt=r.rtt,r.boundsMargin&&(this.boundsMargin=Array.isArray(r.boundsMargin)?r.boundsMargin:[r.boundsMargin,r.boundsMargin,r.boundsMargin,r.boundsMargin]),this.setUpdateType(b.ScaleRotate|b.Local|b.RenderBounds|b.RenderState),Tt()===!1&&r.preventCleanup===!0&&console.warn("CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead"),this.stage.defaultTexture&&this.stage.defaultTexture.state!=="loaded"&&this.stage.defaultTexture.once("loaded",()=>{this.setUpdateType(b.IsRenderable)})}loadTexture(){const{texture:e}=this.props;R(e),queueMicrotask(()=>{var r;if(this.textureOptions.preload===!0&&this.stage.txManager.loadTexture(e),e.preventCleanup=((r=this.props.textureOptions)==null?void 0:r.preventCleanup)??!1,e.on("loaded",this.onTextureLoaded),e.on("failed",this.onTextureFailed),e.on("freed",this.onTextureFreed),this.parentHasRenderTexture){this.notifyParentRTTOfUpdate();return}e.state==="loaded"?(R(e.dimensions),this.onTextureLoaded(e,e.dimensions)):e.state==="failed"?(R(e.error),this.onTextureFailed(e,e.error)):e.state==="freed"&&this.onTextureFreed(e)})}unloadTexture(){this.texture!==null&&(this.texture.off("loaded",this.onTextureLoaded),this.texture.off("failed",this.onTextureFailed),this.texture.off("freed",this.onTextureFreed),this.texture.setRenderableOwner(this,!1))}autosizeNode(e){this.autosize&&(this.width=e.width,this.height=e.height)}setUpdateType(e){this.updateType|=e;const r=this.props.parent;r&&(r.updateType&b.Children)===0&&r.setUpdateType(b.Children)}sortChildren(){this.children.sort((e,r)=>e.calcZIndex-r.calcZIndex)}updateScaleRotateTransform(){const{rotation:e,scaleX:r,scaleY:i}=this.props;if(e===0&&r===1&&i===1){this.scaleRotateTransform=void 0;return}this.scaleRotateTransform=Q.rotate(e,this.scaleRotateTransform).scale(r,i)}updateLocalTransform(){var c,u;const{x:e,y:r,width:i,height:n}=this.props,o=this.props.mountX*i,l=this.props.mountY*n;if(this.scaleRotateTransform){const d=this.props.pivotX*i,h=this.props.pivotY*n;this.localTransform=Q.translate(e-o+d,r-l+h,this.localTransform).multiply(this.scaleRotateTransform).translate(-d,-h)}else this.localTransform=Q.translate(e-o,r-l,this.localTransform);const a=this.props.texture;if(a&&a.dimensions&&((u=(c=this.props.textureOptions)==null?void 0:c.resizeMode)==null?void 0:u.type)==="contain"){let d=1,h=1,p=0,g=0;const{width:x,height:T}=a.dimensions,y=x/T,S=i/n;if(y>S){const v=i/x,C=T*v;g=(n-C)/2,h=C/n}else{const v=n/T,C=x*v;p=(i-C)/2,d=C/i}this.localTransform.translate(p,g).scale(d,h)}this.setUpdateType(b.Global)}update(e,r){this.updateType&b.ScaleRotate&&(this.updateScaleRotateTransform(),this.setUpdateType(b.Local)),this.updateType&b.Local&&(this.updateLocalTransform(),this.setUpdateType(b.Global));const i=this.props.parent;let n=null;if(this.updateType&b.RenderTexture&&this.rtt&&(this.hasRTTupdates=!0),this.updateType&b.Global&&(R(this.localTransform),this.parentHasRenderTexture===!0&&(i==null?void 0:i.rtt)===!0?(this.globalTransform=Q.identity(),this.sceneGlobalTransform=Q.copy((i==null?void 0:i.globalTransform)||Q.identity()).multiply(this.localTransform)):this.parentHasRenderTexture===!0&&(i==null?void 0:i.rtt)===!1?(this.sceneGlobalTransform=Q.copy((i==null?void 0:i.sceneGlobalTransform)||this.localTransform).multiply(this.localTransform),this.globalTransform=Q.copy((i==null?void 0:i.globalTransform)||this.localTransform,this.globalTransform)):this.globalTransform=Q.copy((i==null?void 0:i.globalTransform)||this.localTransform,this.globalTransform),i!==null&&this.globalTransform.multiply(this.localTransform),this.calculateRenderCoords(),this.updateBoundingRect(),this.setUpdateType(b.RenderState|b.Children),this.childUpdateType|=b.Global,this.clipping===!0&&(this.setUpdateType(b.Clipping|b.RenderBounds),this.childUpdateType|=b.RenderBounds)),this.updateType&b.RenderBounds&&(this.createRenderBounds(),this.setUpdateType(b.RenderState),this.setUpdateType(b.Children),this.childUpdateType|=b.RenderBounds),this.updateType&b.RenderState&&(n=this.checkRenderBounds(),this.setUpdateType(b.IsRenderable),n!==Z.OutOfBounds&&this.updateRenderState(n)),this.updateType&b.WorldAlpha&&(i?this.worldAlpha=i.worldAlpha*this.props.alpha:this.worldAlpha=this.props.alpha,this.setUpdateType(b.Children|b.PremultipliedColors|b.IsRenderable),this.childUpdateType|=b.WorldAlpha),this.updateType&b.IsRenderable&&this.updateIsRenderable(),this.updateType&b.Clipping&&(this.calculateClippingRect(r),this.setUpdateType(b.Children),this.childUpdateType|=b.Clipping,this.childUpdateType|=b.RenderBounds),this.updateType&b.PremultipliedColors&&(this.premultipliedColorTl=ar(this.props.colorTl,this.worldAlpha,!0),this.props.colorTl===this.props.colorTr&&this.props.colorBl===this.props.colorBr&&this.props.colorTl===this.props.colorBl?this.premultipliedColorTr=this.premultipliedColorBl=this.premultipliedColorBr=this.premultipliedColorTl:(this.premultipliedColorTr=ar(this.props.colorTr,this.worldAlpha,!0),this.premultipliedColorBl=ar(this.props.colorBl,this.worldAlpha,!0),this.premultipliedColorBr=ar(this.props.colorBr,this.worldAlpha,!0))),i!==null&&this.updateType&b.CalculatedZIndex&&(this.calculateZIndex(),i.setUpdateType(b.ZIndexSortedChildren)),this.props.strictBounds===!0&&this.renderState===Z.OutOfBounds){this.updateType&=~b.RenderBounds;return}if(this.updateType&b.Children&&this.children.length>0)for(let o=0,l=this.children.length;o<l;o++){const a=this.children[o];if(a.setUpdateType(this.childUpdateType),a.updateType===0)continue;let c=this.clippingRect;this.rtt===!0&&(c={x:0,y:0,width:0,height:0,valid:!1}),a.update(e,c)}this.parentHasRenderTexture&&this.updateType>0&&this.notifyParentRTTOfUpdate(),this.updateType&b.ZIndexSortedChildren&&this.sortChildren(),n===Z.OutOfBounds&&(this.updateRenderState(n),this.updateIsRenderable(),this.rtt===!0&&n===Z.OutOfBounds&&this.notifyChildrenRTTOfUpdate(n)),this.updateType=0,this.childUpdateType=0}findParentRTTNode(){let e=this.parent;for(;e&&!e.rtt;)e=e.parent;return e}getRTTParentRenderState(){const e=this.rttParent||this.findParentRTTNode();return e?e.renderState:null}notifyChildrenRTTOfUpdate(e){for(const r of this.children)r.updateRenderState(e),r.updateIsRenderable(),r.notifyChildrenRTTOfUpdate(e)}notifyParentRTTOfUpdate(){if(this.parent===null)return;const e=this.rttParent||this.findParentRTTNode();e&&(e.hasRTTupdates=!0,e.setUpdateType(b.RenderTexture),e.parentHasRenderTexture===!0&&e.notifyParentRTTOfUpdate())}checkRenderBounds(){return R(this.renderBound),R(this.strictBound),R(this.preloadBound),qr(this.renderBound,this.strictBound)?Z.InViewport:qr(this.renderBound,this.preloadBound)?Z.InBounds:Dn(this.renderBound,this.strictBound)?Z.InViewport:this.parent!==null&&(this.props.width===0||this.props.height===0)?this.parent.renderState:Z.OutOfBounds}updateBoundingRect(){const e=this.sceneGlobalTransform||this.globalTransform,r=this.sceneRenderCoords||this.renderCoords;R(e),R(r);const{tb:i,tc:n}=e,{x1:o,y1:l,x3:a,y3:c}=r;if(i===0||n===0)this.renderBound=ft(o,l,a,c,this.renderBound);else{const{x2:u,x4:d,y2:h,y4:p}=r;this.renderBound=ft(Math.min(o,u,a,d),Math.min(l,h,c,p),Math.max(o,u,a,d),Math.max(l,h,c,p),this.renderBound)}}createRenderBounds(){if(R(this.stage),this.parent!==null&&this.parent.strictBound!==void 0){const u=this.parent.strictBound;this.strictBound=ft(u.x1,u.y1,u.x2,u.y2),this.preloadBound=ls(this.strictBound,this.boundsMargin)}else this.strictBound=this.stage.strictBound,this.preloadBound=this.stage.preloadBound;if(this.props.clipping===!1||this.renderBound===void 0||qr(this.renderBound,this.strictBound)===!1)return;const{x:e,y:r,width:i,height:n}=this.props,{tx:o,ty:l}=this.sceneGlobalTransform||this.globalTransform||{},a=o??e,c=l??r;this.strictBound=ft(a,c,a+i,c+n,this.strictBound),this.preloadBound=ls(this.strictBound,this.boundsMargin)}updateRenderState(e){if(e===this.renderState)return;const r=this.renderState;this.renderState=e;const i=$t.get(e);R(i),this.emit(i,{previous:r,current:e})}updateIsRenderable(){let e=!1,r=!1;if(this.checkBasicRenderability()===!1){this.updateTextureOwnership(!1),this.setRenderable(!1);return}this.texture!==null?(r=!0,e=this.texture.state==="loaded"):(this.hasShader()||this.hasColorProperties()===!0)&&this.hasDimensions()===!0&&this.stage.defaultTexture&&this.stage.defaultTexture.state==="loaded"&&(e=!0),this.updateTextureOwnership(r),this.setRenderable(e)}checkBasicRenderability(){return!(this.worldAlpha===0||this.isOutOfBounds()===!0)}setRenderable(e){this.isRenderable=e}updateTextureOwnership(e){var r;(r=this.texture)==null||r.setRenderableOwner(this,e)}isOutOfBounds(){return this.renderState<=Z.OutOfBounds}hasDimensions(){return this.props.width!==0&&this.props.height!==0}hasColorProperties(){return this.props.color!==0||this.props.colorTop!==0||this.props.colorBottom!==0||this.props.colorLeft!==0||this.props.colorRight!==0||this.props.colorTl!==0||this.props.colorTr!==0||this.props.colorBl!==0||this.props.colorBr!==0}hasShader(){return this.props.shader!==null}calculateRenderCoords(){const{width:e,height:r}=this,{tx:i,ty:n,ta:o,tb:l,tc:a,td:c}=this.globalTransform;if(l===0&&a===0){const T=i,y=i+e*o,S=n,v=n+r*c;this.renderCoords=ct.translate(T,S,y,S,y,v,T,v,this.renderCoords)}else this.renderCoords=ct.translate(i,n,i+e*o,n+e*a,i+e*o+r*l,n+e*a+r*c,i+r*l,n+r*c,this.renderCoords);if(this.sceneGlobalTransform===void 0)return;const{tx:u,ty:d,ta:h,tb:p,tc:g,td:x}=this.sceneGlobalTransform;if(p===0&&g===0){const T=u,y=u+e*h,S=d,v=d+r*x;this.sceneRenderCoords=ct.translate(T,S,y,S,y,v,T,v,this.sceneRenderCoords)}else this.sceneRenderCoords=ct.translate(u,d,u+e*h,d+e*g,u+e*h+r*p,d+e*g+r*x,u+r*p,d+r*x,this.sceneRenderCoords)}calculateClippingRect(e){R(this.globalTransform);const{clippingRect:r,props:i,globalTransform:n}=this,{clipping:o}=i,l=n.tb!==0||n.tc!==0;o===!0&&l===!1?(r.x=n.tx,r.y=n.ty,r.width=this.width*n.ta,r.height=this.height*n.td,r.valid=!0):r.valid=!1,e.valid===!0&&r.valid===!0?di(e,r,r):e.valid===!0&&(pi(e,r),r.valid=!0)}calculateZIndex(){var o,l;const e=this.props,r=e.zIndex||0,i=((o=e.parent)==null?void 0:o.zIndex)||0;let n=r;(l=e.parent)!=null&&l.zIndexLocked&&(n=r<i?r:i),this.calcZIndex=n}destroy(){var e;for(this.unloadTexture(),this.clippingRect.valid=!1,this.isRenderable=!1,this.renderCoords=void 0,this.renderBound=void 0,this.strictBound=void 0,this.preloadBound=void 0,this.globalTransform=void 0,this.scaleRotateTransform=void 0,this.localTransform=void 0,this.props.texture=null,this.props.shader=this.stage.defShaderCtr;this.children.length>0;)(e=this.children[0])==null||e.destroy();this.parent=null,this.rtt&&this.stage.renderer.removeRTTNode(this),this.removeAllListeners()}renderQuads(e){this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode)||(R(this.globalTransform),R(this.renderCoords),e.addQuad({width:this.props.width,height:this.props.height,colorTl:this.premultipliedColorTl,colorTr:this.premultipliedColorTr,colorBl:this.premultipliedColorBl,colorBr:this.premultipliedColorBr,texture:this.texture||this.stage.defaultTexture,textureOptions:this.textureOptions,zIndex:this.zIndex,shader:this.shader.shader,shaderProps:this.shader.getResolvedProps(),alpha:this.worldAlpha,clippingRect:this.clippingRect,tx:this.globalTransform.tx,ty:this.globalTransform.ty,ta:this.globalTransform.ta,tb:this.globalTransform.tb,tc:this.globalTransform.tc,td:this.globalTransform.td,renderCoords:this.renderCoords,rtt:this.rtt,parentHasRenderTexture:this.parentHasRenderTexture,framebufferDimensions:this.framebufferDimensions}))}get id(){return this._id}get data(){return this.props.data}set data(e){this.props.data=e}get x(){return this.props.x}set x(e){this.props.x!==e&&(this.props.x=e,this.setUpdateType(b.Local))}get absX(){var e,r,i;return this.props.x+-this.props.width*this.props.mountX+(((e=this.props.parent)==null?void 0:e.absX)||((i=(r=this.props.parent)==null?void 0:r.globalTransform)==null?void 0:i.tx)||0)}get absY(){var e;return this.props.y+-this.props.height*this.props.mountY+(((e=this.props.parent)==null?void 0:e.absY)??0)}get y(){return this.props.y}set y(e){this.props.y!==e&&(this.props.y=e,this.setUpdateType(b.Local))}get width(){return this.props.width}set width(e){this.props.width!==e&&(this.props.width=e,this.setUpdateType(b.Local),this.props.rtt&&(this.texture=this.stage.txManager.createTexture("RenderTexture",{width:this.width,height:this.height}),this.setUpdateType(b.RenderTexture)))}get height(){return this.props.height}set height(e){this.props.height!==e&&(this.props.height=e,this.setUpdateType(b.Local),this.props.rtt&&(this.texture=this.stage.txManager.createTexture("RenderTexture",{width:this.width,height:this.height}),this.setUpdateType(b.RenderTexture)))}get scale(){return this.scaleX}set scale(e){this.scaleX=e,this.scaleY=e}get scaleX(){return this.props.scaleX}set scaleX(e){this.props.scaleX!==e&&(this.props.scaleX=e,this.setUpdateType(b.ScaleRotate))}get scaleY(){return this.props.scaleY}set scaleY(e){this.props.scaleY!==e&&(this.props.scaleY=e,this.setUpdateType(b.ScaleRotate))}get mount(){return this.props.mount}set mount(e){(this.props.mountX!==e||this.props.mountY!==e)&&(this.props.mountX=e,this.props.mountY=e,this.props.mount=e,this.setUpdateType(b.Local))}get mountX(){return this.props.mountX}set mountX(e){this.props.mountX!==e&&(this.props.mountX=e,this.setUpdateType(b.Local))}get mountY(){return this.props.mountY}set mountY(e){this.props.mountY!==e&&(this.props.mountY=e,this.setUpdateType(b.Local))}get pivot(){return this.props.pivot}set pivot(e){(this.props.pivotX!==e||this.props.pivotY!==e)&&(this.props.pivotX=e,this.props.pivotY=e,this.props.pivot=e,this.setUpdateType(b.Local))}get pivotX(){return this.props.pivotX}set pivotX(e){this.props.pivotX!==e&&(this.props.pivotX=e,this.setUpdateType(b.Local))}get pivotY(){return this.props.pivotY}set pivotY(e){this.props.pivotY!==e&&(this.props.pivotY=e,this.setUpdateType(b.Local))}get rotation(){return this.props.rotation}set rotation(e){this.props.rotation!==e&&(this.props.rotation=e,this.setUpdateType(b.ScaleRotate))}get alpha(){return this.props.alpha}set alpha(e){this.props.alpha=e,this.setUpdateType(b.PremultipliedColors|b.WorldAlpha|b.Children|b.IsRenderable),this.childUpdateType|=b.WorldAlpha}get autosize(){return this.props.autosize}set autosize(e){this.props.autosize=e}get boundsMargin(){var e;return this.props.boundsMargin??((e=this.parent)==null?void 0:e.boundsMargin)??this.stage.boundsMargin}set boundsMargin(e){if(e!==this.props.boundsMargin){if(e===null)this.props.boundsMargin=e;else{const r=Array.isArray(e)?e:[e,e,e,e];this.props.boundsMargin=r}this.setUpdateType(b.RenderBounds)}}get clipping(){return this.props.clipping}set clipping(e){this.props.clipping=e,this.setUpdateType(b.Clipping|b.RenderBounds|b.Children),this.childUpdateType|=b.Global|b.Clipping}get color(){return this.props.color}set color(e){this.colorTop=e,this.colorBottom=e,this.colorLeft=e,this.colorRight=e,this.props.color=e,this.setUpdateType(b.PremultipliedColors)}get colorTop(){return this.props.colorTop}set colorTop(e){(this.props.colorTl!==e||this.props.colorTr!==e)&&(this.colorTl=e,this.colorTr=e),this.props.colorTop=e,this.setUpdateType(b.PremultipliedColors)}get colorBottom(){return this.props.colorBottom}set colorBottom(e){(this.props.colorBl!==e||this.props.colorBr!==e)&&(this.colorBl=e,this.colorBr=e),this.props.colorBottom=e,this.setUpdateType(b.PremultipliedColors)}get colorLeft(){return this.props.colorLeft}set colorLeft(e){(this.props.colorTl!==e||this.props.colorBl!==e)&&(this.colorTl=e,this.colorBl=e),this.props.colorLeft=e,this.setUpdateType(b.PremultipliedColors)}get colorRight(){return this.props.colorRight}set colorRight(e){(this.props.colorTr!==e||this.props.colorBr!==e)&&(this.colorTr=e,this.colorBr=e),this.props.colorRight=e,this.setUpdateType(b.PremultipliedColors)}get colorTl(){return this.props.colorTl}set colorTl(e){this.props.colorTl=e,this.setUpdateType(b.PremultipliedColors)}get colorTr(){return this.props.colorTr}set colorTr(e){this.props.colorTr=e,this.setUpdateType(b.PremultipliedColors)}get colorBl(){return this.props.colorBl}set colorBl(e){this.props.colorBl=e,this.setUpdateType(b.PremultipliedColors)}get colorBr(){return this.props.colorBr}set colorBr(e){this.props.colorBr=e,this.setUpdateType(b.PremultipliedColors)}get zIndexLocked(){return this.props.zIndexLocked||0}set zIndexLocked(e){this.props.zIndexLocked=e,this.setUpdateType(b.CalculatedZIndex|b.Children);for(let r=0,i=this.children.length;r<i;r++)this.children[r].setUpdateType(b.CalculatedZIndex)}get zIndex(){return this.props.zIndex}set zIndex(e){this.props.zIndex=e,this.setUpdateType(b.CalculatedZIndex|b.Children);for(let r=0,i=this.children.length;r<i;r++)this.children[r].setUpdateType(b.CalculatedZIndex)}get parent(){return this.props.parent}set parent(e){const r=this.props.parent;if(r!==e){if(this.props.parent=e,r){const i=r.children.indexOf(this);R(i!==-1,"CoreNode.parent: Node not found in old parent's children!"),r.children.splice(i,1),r.setUpdateType(b.Children|b.ZIndexSortedChildren)}e&&(e.children.push(this),this.setUpdateType(b.All),e.setUpdateType(b.Children|b.ZIndexSortedChildren),(e.rtt||e.parentHasRenderTexture)&&this.applyRTTInheritance(e)),this.updateScaleRotateTransform(),this.setUpdateType(b.RenderBounds|b.Children)}}get preventCleanup(){return this.props.textureOptions.preventCleanup||!1}set preventCleanup(e){Tt()===!1&&console.warn("CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead"),this.props.textureOptions.preventCleanup=e}get rtt(){return this.props.rtt}set rtt(e){this.props.rtt!==e&&(this.props.rtt=e,e===!0?(this.initRenderTexture(),this.markChildrenWithRTT()):this.cleanupRenderTexture(),this.setUpdateType(b.RenderTexture),this.parentHasRenderTexture===!0&&this.notifyParentRTTOfUpdate())}initRenderTexture(){this.texture=this.stage.txManager.createTexture("RenderTexture",{width:this.width,height:this.height}),this.stage.renderer.renderToTexture(this)}cleanupRenderTexture(){this.unloadTexture(),this.clearRTTInheritance(),this.hasRTTupdates=!1,this.texture=null}markChildrenWithRTT(e=null){const r=e||this;for(const i of r.children)i.setUpdateType(b.All),i.parentHasRenderTexture=!0,i.markChildrenWithRTT()}applyRTTInheritance(e){e.rtt&&e.setUpdateType(b.RenderTexture),this.markChildrenWithRTT(e)}clearRTTInheritance(){if(!this.rtt)for(const e of this.children)e.parentHasRenderTexture=!1,e.rttParent=null,e.setUpdateType(b.All),e.clearRTTInheritance()}get shader(){return this.props.shader}set shader(e){this.props.shader!==e&&(this.props.shader=e,this.setUpdateType(b.IsRenderable))}get src(){return this.props.src}set src(e){if(this.props.src!==e){if(this.props.src=e,!e){this.texture=null;return}this.texture=this.stage.txManager.createTexture("ImageTexture",{src:e,width:this.props.width,height:this.props.height,type:this.props.imageType,sx:this.props.srcX,sy:this.props.srcY,sw:this.props.srcWidth,sh:this.props.srcHeight})}}set imageType(e){this.props.imageType!==e&&(this.props.imageType=e)}get imageType(){return this.props.imageType||null}get srcHeight(){return this.props.srcHeight}set srcHeight(e){this.props.srcHeight=e}get srcWidth(){return this.props.srcWidth}set srcWidth(e){this.props.srcWidth=e}get srcX(){return this.props.srcX}set srcX(e){this.props.srcX=e}get srcY(){return this.props.srcY}set srcY(e){this.props.srcY=e}get framebufferDimensions(){return this.parentHasRenderTexture&&!this.rtt&&this.parent?this.parent.framebufferDimensions:{width:this.width,height:this.height}}get parentRenderTexture(){let e=this.parent;for(;e;){if(e.rtt)return e;e=e.parent}return null}get texture(){return this.props.texture}set texture(e){if(this.props.texture===e)return;const r=this.props.texture;r&&(r.setRenderableOwner(this,!1),this.unloadTexture()),this.props.texture=e,e!==null&&(e.setRenderableOwner(this,this.isRenderable),this.loadTexture()),this.setUpdateType(b.IsRenderable)}set textureOptions(e){this.props.textureOptions=e}get textureOptions(){return this.props.textureOptions}get strictBounds(){return this.props.strictBounds}set strictBounds(e){e!==this.props.strictBounds&&(this.props.strictBounds=e,this.setUpdateType(b.RenderBounds|b.Children),this.childUpdateType|=b.RenderBounds|b.Children)}animate(e,r){const i=new Hn(this,e,r);return new Kn(this.stage.animationManager,i)}flush(){}}const jn=s=>{let t=!1;const e=()=>{if(s.updateFrameTime(),s.updateAnimations(),!s.hasSceneUpdates()){s.calculateFps(),setTimeout(e,16.666666666666668),t||(s.eventBus.emit("idle"),t=!0),s.txMemManager.checkCleanup()===!0&&s.txMemManager.cleanup(!1),s.flushFrameEvents();return}t=!1,s.drawFrame(),s.flushFrameEvents(),requestAnimationFrame(e)};requestAnimationFrame(e)},Ye=()=>performance?performance.now():Date.now();class qn{constructor(){f(this,"activeAnimations",new Set)}registerAnimation(t){this.activeAnimations.add(t)}unregisterAnimation(t){this.activeAnimations.delete(t)}update(t){this.activeAnimations.forEach(e=>{e.update(t)})}}function Qn(){function s(e){return e.indexOf("image/png")!==-1}function t(e,r,i,n,o,l,a){return new Promise(function(c,u){var d=new XMLHttpRequest;d.open("GET",e,!0),d.responseType="blob",d.onload=function(){if(d.status!==200&&d.status!==0)return u(new Error("Failed to load image: "+d.statusText));var h=d.response;r!==void 0||s(h.type),createImageBitmap(h).then(function(p){c({data:p,premultiplyAlpha:r})}).catch(function(p){u(p)})},d.onerror=function(){u(new Error("Network error occurred while trying to fetch the image."))},d.send()})}self.onmessage=e=>{var r=e.data.src,i=e.data.id,n=e.data.premultiplyAlpha;e.data.sx,e.data.sy,e.data.sw,e.data.sh,t(r,n).then(function(o){self.postMessage({id:i,src:r,data:o},[o.data])}).catch(function(o){self.postMessage({id:i,src:r,error:o.message})})}}class Zn{constructor(t,e){f(this,"imageWorkersEnabled",!0);f(this,"messageManager",{});f(this,"workers",[]);f(this,"workerIndex",0);f(this,"nextId",0);this.workers=this.createWorkers(t,e),this.workers.forEach(r=>{r.onmessage=this.handleMessage.bind(this)})}handleMessage(t){const{id:e,data:r,error:i}=t.data,n=this.messageManager[e];if(n){const[o,l]=n;delete this.messageManager[e],i?l(new Error(i)):o(r)}}createWorkers(t=1,e){let r=`(${Qn.toString()})()`;e.options===!0&&(r=r.replace("var supportsOptionsCreateImageBitmap = false;","var supportsOptionsCreateImageBitmap = true;")),e.full===!0&&(r=r.replace("var supportsOptionsCreateImageBitmap = false;","var supportsOptionsCreateImageBitmap = true;"),r=r.replace("var supportsFullCreateImageBitmap = false;","var supportsFullCreateImageBitmap = true;")),r=r.replace('"use strict";',"");const i=new Blob([r],{type:"application/javascript"}),n=(self.URL?URL:webkitURL).createObjectURL(i),o=[];for(let l=0;l<t;l++)o.push(new Worker(n));return o}getNextWorker(){const t=this.workers[this.workerIndex];return this.workerIndex=(this.workerIndex+1)%this.workers.length,t}getImage(t,e,r,i,n,o){return new Promise((l,a)=>{try{if(this.workers){const c=this.nextId++;this.messageManager[c]=[l,a];const u=this.getNextWorker();u&&u.postMessage({id:c,src:t,premultiplyAlpha:e,sx:r,sy:i,sw:n,sh:o})}}catch(c){a(c)}})}}const Mt=class Mt extends Ot{constructor(e,r){super(e);f(this,"type",H.color);f(this,"props");this.props=Mt.resolveDefaults(r||{})}get color(){return this.props.color}set color(e){this.props.color=e}async getTextureSource(){const e=new Uint8Array(4);return this.color===4294967295?(e[0]=255,e[1]=255,e[2]=255,e[3]=255):(e[0]=this.color>>16&255,e[1]=this.color>>8&255,e[2]=this.color&255,e[3]=this.color>>>24&255),this.setState("fetched",{width:1,height:1}),{data:e,premultiplyAlpha:!0}}static makeCacheKey(e){return`ColorTexture,${Mt.resolveDefaults(e).color}`}static resolveDefaults(e){return{color:e.color||4294967295}}};f(Mt,"z$__type__Props");let Br=Mt;function Jn(s){return/\.(ktx|pvr)$/.test(s)}const Ns=async s=>{const e=await(await fetch(s)).arrayBuffer();return s.indexOf(".ktx")!==-1?eo(e):to(e)},eo=async s=>{const t=new DataView(s),e=t.getUint32(12)===16909060,r=[],i={glInternalFormat:t.getUint32(28,e),pixelWidth:t.getUint32(36,e),pixelHeight:t.getUint32(40,e),numberOfMipmapLevels:t.getUint32(56,e),bytesOfKeyValueData:t.getUint32(60,e)};let n=64;n+=i.bytesOfKeyValueData;for(let o=0;o<i.numberOfMipmapLevels;o++){const l=t.getUint32(n);n+=4,r.push(t.buffer.slice(n,l)),n+=l}return{data:{glInternalFormat:i.glInternalFormat,mipmaps:r,width:i.pixelWidth||0,height:i.pixelHeight||0,type:"ktx"},premultiplyAlpha:!1}},to=async s=>{const l=s,a=new Int32Array(l,0,13),c=a[12]+52,u=new Uint8Array(l,c),d=[],h={pixelWidth:a[7],pixelHeight:a[6],numberOfMipmapLevels:a[11]||0};let p=0,g=h.pixelWidth||0,x=h.pixelHeight||0;for(let T=0;T<h.numberOfMipmapLevels;T++){const y=(g+3>>2)*(x+3>>2)*8,S=new Uint8Array(l,u.byteOffset+p,y);d.push(S),p+=y,g=g>>1,x=x>>1}return{data:{glInternalFormat:36196,mipmaps:d,width:h.pixelWidth||0,height:h.pixelHeight||0,type:"pvr"},premultiplyAlpha:!1}};function ro(s){return/\.(svg)(\?.*)?$/.test(s)}const zs=(s,t,e,r,i,n,o)=>new Promise((l,a)=>{const c=document.createElement("canvas"),u=c.getContext("2d");R(u),u.imageSmoothingEnabled=!0;const d=new Image;d.onload=()=>{const h=r??0,p=i??0,g=t||d.width,x=e||d.height;c.width=g,c.height=x,u.drawImage(d,0,0,g,x),l({data:u.getImageData(h,p,n??g,o??x),premultiplyAlpha:!1})},d.onerror=h=>{a(h)},d.src=s});function gi(s,t=""){return new Promise((e,r)=>{const i=new XMLHttpRequest;i.responseType=t,i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status===0||i.status===200?e(i.response):r(i.statusText))},i.open("GET",s,!0),i.send(null)})}const It=class It extends Ot{constructor(e,r){super(e);f(this,"props");f(this,"type",H.image);this.props=It.resolveDefaults(r)}hasAlphaChannel(e){return e.indexOf("image/png")!==-1}async loadImageFallback(e,r){const i=new Image;return typeof e=="string"&&Qr(e)===!1&&(i.crossOrigin="anonymous"),new Promise(n=>{i.onload=()=>{n({data:i,premultiplyAlpha:r})},i.onerror=()=>{console.warn("Image loading failed, returning fallback object."),n({data:i,premultiplyAlpha:r})},e instanceof Blob?i.src=URL.createObjectURL(e):i.src=e})}async createImageBitmap(e,r,i,n,o,l){const a=r??e.type.includes("image/png"),c=this.txManager.imageBitmapSupported;return c.full===!0&&o!==null&&l!==null?{data:await createImageBitmap(e,i||0,n||0,o,l,{premultiplyAlpha:a?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:a}:c.basic===!0?{data:await createImageBitmap(e),premultiplyAlpha:a}:{data:await createImageBitmap(e,{premultiplyAlpha:a?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:a}}async loadImage(e){const{premultiplyAlpha:r,sx:i,sy:n,sw:o,sh:l}=this.props;if(this.txManager.hasCreateImageBitmap===!0){if(Qr(e)===!1&&this.txManager.hasWorker===!0&&this.txManager.imageWorkerManager!==null)return this.txManager.imageWorkerManager.getImage(e,r,i,n,o,l);let a;return Qr(e)===!0?a=Wn(e):a=await gi(e,"blob").then(c=>c),this.createImageBitmap(a,r,i,n,o,l)}return this.loadImageFallback(e,r??!0)}async getTextureSource(){var n,o;let e;try{e=await this.determineImageTypeAndLoadImage()}catch(l){return this.setState("failed",l),{data:null}}if(e.data===null)return this.setState("failed",Error("ImageTexture: No image data")),{data:null};let r,i;return e.data instanceof Uint8Array?(r=this.props.width??0,i=this.props.height??0):(r=((n=e.data)==null?void 0:n.width)??(this.props.width||0),i=((o=e.data)==null?void 0:o.height)??(this.props.height||0)),this.setState("fetched",{width:r,height:i}),{data:e.data,premultiplyAlpha:this.props.premultiplyAlpha??!0}}determineImageTypeAndLoadImage(){const{src:e,premultiplyAlpha:r,type:i}=this.props;if(e===null)return{data:null};if(typeof e!="string"){if(e instanceof Blob)if(this.txManager.hasCreateImageBitmap===!0){const{sx:o,sy:l,sw:a,sh:c}=this.props;return this.createImageBitmap(e,r,o,l,a,c)}else return this.loadImageFallback(e,r??!0);return e instanceof ImageData?{data:e,premultiplyAlpha:r}:{data:e(),premultiplyAlpha:r}}const n=zn(e);return i==="regular"?this.loadImage(n):i==="svg"?zs(n,this.props.width,this.props.height,this.props.sx,this.props.sy,this.props.sw,this.props.sh):ro(e)===!0?zs(n,this.props.width,this.props.height,this.props.sx,this.props.sy,this.props.sw,this.props.sh):i==="compressed"||Jn(e)===!0?Ns(n):this.loadImage(n)}static makeCacheKey(e){const r=It.resolveDefaults(e),i=r.key||r.src;if(typeof i!="string")return!1;let n="";return r.sh!==null&&r.sw!==null&&(n+=",",n+=r.sx??"",n+=r.sy??"",n+=r.sw||"",n+=r.sh||""),`ImageTexture,${i},${r.premultiplyAlpha??"true"}${n}`}static resolveDefaults(e){return{src:e.src??"",premultiplyAlpha:e.premultiplyAlpha??!0,key:e.key??null,type:e.type??null,width:e.width??null,height:e.height??null,sx:e.sx??null,sy:e.sy??null,sw:e.sw??null,sh:e.sh??null}}};f(It,"z$__type__Props");let Bt=It;const Lt=class Lt extends Ot{constructor(e,r){super(e);f(this,"props");f(this,"type",H.noise);this.props=Lt.resolveDefaults(r)}async getTextureSource(){const{width:e,height:r}=this.props,i=e*r*4,n=new Uint8ClampedArray(i);for(let o=0;o<i;o+=4){const l=Math.floor(Math.random()*256);n[o]=l,n[o+1]=l,n[o+2]=l,n[o+3]=255}return this.setState("fetched"),{data:new ImageData(n,e,r)}}static makeCacheKey(e){if(e.cacheId===void 0)return!1;const r=Lt.resolveDefaults(e);return`NoiseTexture,${r.width},${r.height},${r.cacheId}`}static resolveDefaults(e){return{width:e.width??128,height:e.height??128,cacheId:e.cacheId??0}}};f(Lt,"z$__type__Props");let cs=Lt;const $r=class $r extends Ot{constructor(e,r){super(e);f(this,"props");f(this,"parentTexture");f(this,"type",H.subTexture);f(this,"onParentTxLoaded",()=>{this.forwardParentTxState("loaded",{width:this.props.width,height:this.props.height})});f(this,"onParentTxFailed",(e,r)=>{this.forwardParentTxState("failed",r)});f(this,"onParentTxFetched",()=>{this.forwardParentTxState("fetched",{width:this.props.width,height:this.props.height})});f(this,"onParentTxFetching",()=>{this.forwardParentTxState("fetching")});f(this,"onParentTxLoading",()=>{this.forwardParentTxState("loading")});f(this,"onParentTxFreed",()=>{this.forwardParentTxState("freed")});this.props=$r.resolveDefaults(r||{}),R(this.props.texture,"SubTexture requires a parent texture"),R(this.props.texture instanceof Bt,"SubTexture requires an ImageTexture parent"),this.parentTexture=e.resolveParentTexture(this.props.texture),this.renderableOwners.size>0&&this.parentTexture.setRenderableOwner(this,!0),queueMicrotask(()=>{const i=this.parentTexture;i.state==="loaded"?this.onParentTxLoaded(i,i.dimensions):i.state==="fetching"?this.onParentTxFetching():i.state==="fetched"?this.onParentTxFetched():i.state==="loading"?this.onParentTxLoading():i.state==="failed"?this.onParentTxFailed(i,i.error):i.state==="freed"&&this.onParentTxFreed(),i.on("fetched",this.onParentTxFetched),i.on("loading",this.onParentTxLoading),i.on("fetching",this.onParentTxFetching),i.on("loaded",this.onParentTxLoaded),i.on("failed",this.onParentTxFailed),i.on("freed",this.onParentTxFreed)})}forwardParentTxState(e,r){this.setState(e,r)}onChangeIsRenderable(e){this.parentTexture.setRenderableOwner(this,e)}async getTextureSource(){return new Promise((e,r)=>{this.setState("fetched"),e({data:this.props})})}static makeCacheKey(e){return!1}static resolveDefaults(e){return{texture:e.texture,x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}};f($r,"z$__type__Props");let kt=$r;const Dr=class Dr extends Ot{constructor(e,r){super(e);f(this,"props");f(this,"type",H.renderToTexture);this.props=Dr.resolveDefaults(r||{})}get width(){return this.props.width}set width(e){this.props.width=e}get height(){return this.props.height}set height(e){this.props.height=e}async getTextureSource(){return this.setState("fetched"),{data:null,premultiplyAlpha:null}}static resolveDefaults(e){return{width:e.width||256,height:e.height||256}}};f(Dr,"z$__type__Props");let kr=Dr;async function so(){var i,n,o;const s=new Uint8Array([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,1,0,0,0,1,1,3,0,0,0,37,219,86,202,0,0,0,3,80,76,84,69,0,0,0,167,122,61,218,0,0,0,1,116,82,78,83,0,64,230,216,102,0,0,0,10,73,68,65,84,8,215,99,96,0,0,0,2,0,1,226,33,188,51,0,0,0,0,73,69,78,68,174,66,96,130]),t={basic:!1,options:!1,full:!1},e=new Blob([s],{type:"image/png"}),r=await createImageBitmap(e);(i=r.close)==null||i.call(r),t.basic=!0;try{const l={premultiplyAlpha:"none"},a=await createImageBitmap(e,l);(n=a.close)==null||n.call(a),t.options=!0}catch{}try{const l=await createImageBitmap(e,0,0,1,1,{premultiplyAlpha:"none"});(o=l.close)==null||o.call(l),t.full=!0}catch{}return t}class io extends xe{constructor(e,r){super();f(this,"keyCache",new Map);f(this,"inverseKeyCache",new WeakMap);f(this,"txConstructors",{});f(this,"downloadTextureSourceQueue",[]);f(this,"priorityQueue",[]);f(this,"uploadTextureQueue",[]);f(this,"initialized",!1);f(this,"stage");f(this,"numImageWorkers");f(this,"imageWorkerManager",null);f(this,"hasCreateImageBitmap",!!self.createImageBitmap);f(this,"imageBitmapSupported",{basic:!1,options:!1,full:!1});f(this,"hasWorker",!!self.Worker);f(this,"renderer");f(this,"frameTime",0);const{numImageWorkers:i,createImageBitmapSupport:n}=r;this.stage=e,this.numImageWorkers=i,n==="auto"?so().then(o=>{this.initialize(o)}).catch(o=>{console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower."),this.initialized=!0,this.emit("initialized")}):this.initialize({basic:n==="basic",options:n==="options",full:n==="full"}),this.registerTextureType("ImageTexture",Bt),this.registerTextureType("ColorTexture",Br),this.registerTextureType("NoiseTexture",cs),this.registerTextureType("SubTexture",kt),this.registerTextureType("RenderTexture",kr)}registerTextureType(e,r){this.txConstructors[e]=r}initialize(e){this.hasCreateImageBitmap=e.basic||e.options||e.full,this.imageBitmapSupported=e,this.hasCreateImageBitmap||console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower."),this.hasCreateImageBitmap&&this.hasWorker&&this.numImageWorkers>0?this.imageWorkerManager=new Zn(this.numImageWorkers,e):console.warn("[Lightning] Imageworker is 0 or not supported on this browser. Image loading will be slower."),this.initialized=!0,this.emit("initialized")}enqueueDownloadTextureSource(e){this.downloadTextureSourceQueue.includes(e)||this.downloadTextureSourceQueue.push(e)}enqueueUploadTexture(e){this.uploadTextureQueue.includes(e)===!1&&this.uploadTextureQueue.push(e)}createTexture(e,r){let i;const n=this.txConstructors[e];if(!n)throw new Error(`Texture type "${e}" is not registered`);const o=n.makeCacheKey(r);return o&&this.keyCache.has(o)?i=this.keyCache.get(o):(i=new n(this,r),o&&this.initTextureToCache(i,o)),i}orphanTexture(e){this.removeTextureFromQueue(e),e.type!==H.subTexture&&this.stage.txMemManager.addToOrphanedTextures(e)}loadTexture(e,r){if(this.stage.txMemManager.removeFromOrphanedTextures(e),e.type!==H.subTexture){if(e.ctxTexture!==void 0&&e.ctxTexture.state==="loaded"){e.setState("loaded");return}if(!(this.downloadTextureSourceQueue.includes(e)===!0||this.uploadTextureQueue.includes(e)===!0)){if(e.ctxTexture!==void 0&&e.ctxTexture.state==="loading"){if(e.textureData!==null){this.enqueueUploadTexture(e);return}e.free()}if(this.initialized===!1){this.priorityQueue.push(e);return}if(e.state==="failed"&&(e.free(),e.freeTextureData()),(e.type===H.color||e.type===H.renderToTexture)&&e.state!=="initial"){e.setState("fetched"),this.enqueueUploadTexture(e);return}e.setState("loading"),r===!0&&e.getTextureData().then(()=>{this.uploadTexture(e)}).catch(i=>{console.error(i)}),this.enqueueDownloadTextureSource(e)}}}uploadTexture(e){if(this.stage.txMemManager.doNotExceedCriticalThreshold===!0&&this.stage.txMemManager.criticalCleanupRequested===!0){this.enqueueUploadTexture(e);return}const r=e.loadCtxTexture();if(r!==null&&r.state==="loaded"){e.setState("loaded");return}r.load()}isProcessingTexture(e){return this.downloadTextureSourceQueue.includes(e)===!0||this.uploadTextureQueue.includes(e)===!0}processSome(e){if(this.initialized===!1)return;const r=Ye();for(;this.priorityQueue.length>0&&Ye()-r<e;){const i=this.priorityQueue.pop();i.getTextureData().then(()=>{this.uploadTexture(i)})}for(;this.uploadTextureQueue.length>0&&Ye()-r<e;)this.uploadTexture(this.uploadTextureQueue.pop());for(;this.downloadTextureSourceQueue.length>0&&Ye()-r<e;){const i=this.downloadTextureSourceQueue.shift();i.getTextureData().then(()=>{i.state==="fetched"&&this.enqueueUploadTexture(i)})}}hasUpdates(){return this.downloadTextureSourceQueue.length>0||this.uploadTextureQueue.length>0}initTextureToCache(e,r){const{keyCache:i,inverseKeyCache:n}=this;i.set(r,e),n.set(e,r)}getTextureFromCache(e){return this.keyCache.get(e)}removeTextureFromCache(e){const{inverseKeyCache:r,keyCache:i}=this,n=r.get(e);n&&i.delete(n)}removeTextureFromQueue(e){const r=this.downloadTextureSourceQueue.indexOf(e);r!==-1&&this.downloadTextureSourceQueue.splice(r,1);const i=this.uploadTextureQueue.indexOf(e);i!==-1&&this.uploadTextureQueue.splice(i,1)}resolveParentTexture(e){if(!(e!=null&&e.props))return e;const r=Bt.makeCacheKey(e.props);return(r?this.getTextureFromCache(r):void 0)??e}}const no={normal:400,bold:700,bolder:900,lighter:100},Ws=s=>typeof s=="number"?s:no[s]||400;function oo(s,t,e,r,i){let n=Ws(e);for(const o of s){const l=o[t];if(!l)continue;if(l.size===1)return console.warn(`TrFontManager: Only one font face found for family: '${t}' - will be used for all weights and styles`),l.values().next().value;const a=new Map;for(const u of l){const d=Ws(u.descriptors.weight);if(d===n&&u.descriptors.style===r&&u.descriptors.stretch===i)return u;a.set(d,u)}const c=`TrFontManager: No exact match: '${t} Weight: ${n} Style: ${r} Stretch: ${i}'`;if(console.error(c),n===400&&a.has(500))return a.get(500);if(n===500&&a.has(400))return a.get(400);if(n<400){for(;n>0;){if(a.has(n))return a.get(n);n-=100}n=600}for(;n<1e3;){if(a.has(n))return a.get(n);n+=100}for(n=500;n>0;){if(a.has(n))return a.get(n);n-=100}}}class ao{constructor(t){f(this,"textRenderers");f(this,"fontCache",new Map);this.textRenderers=t}addFontFace(t){for(const e in this.textRenderers){const r=this.textRenderers[e];r&&r.isFontFaceSupported(t)&&r.addFontFace(t)}}resolveFontFace(t,e,r){const{fontFamily:i,fontWeight:n,fontStyle:o,fontStretch:l}=e,a=`${r}_${i}_${o}_${n}_${l}`;if(this.fontCache.has(a)===!0)return this.fontCache.get(a);const c=oo(t,i,n,o,l);return c!==void 0&&this.fontCache.set(a,c),c}}class xi{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function Xs(s,t,e){const r=s.createShader(t);if(!r){const n=s.getError();throw new Error(`Unable to create the shader: ${t===s.VERTEX_SHADER?"VERTEX_SHADER":"FRAGMENT_SHADER"}.${n?` WebGlContext Error: ${n}`:""}`)}if(s.shaderSource(r,e),s.compileShader(r),!!s.getShaderParameter(r,s.COMPILE_STATUS))return r;console.error(s.getShaderInfoLog(r)),s.deleteShader(r)}function lo(s,t,e){const r=s.createProgram();if(!r)throw new Error("Unable to create program");if(s.attachShader(r,t),s.attachShader(r,e),s.linkProgram(r),!!s.getProgramParameter(r,s.LINK_STATUS))return r;console.warn(s.getProgramInfoLog(r)),s.deleteProgram(r)}class Ke extends xi{constructor(e){super();f(this,"boundBufferCollection",null);f(this,"buffersBound",!1);f(this,"program");f(this,"vao");f(this,"renderer");f(this,"glw");f(this,"attributeBuffers");f(this,"attributeLocations");f(this,"attributeNames");f(this,"uniformLocations");f(this,"uniformTypes");f(this,"supportsIndexedTextures");const r=this.renderer=e.renderer,i=this.glw=this.renderer.glw;this.supportsIndexedTextures=e.supportsIndexedTextures||!1;const n=i.isWebGl2(),o=n&&e.webgl2Extensions||!n&&e.webgl1Extensions||[],l=n?"2.0":"1.0";o.forEach(x=>{if(!i.getExtension(x))throw new Error(`Shader "${this.constructor.name}" requires extension "${x}" for WebGL ${l} but wasn't found`)});const a=e.shaderSources||this.constructor.shaderSources;if(a)n&&(a!=null&&a.webGl2)&&(a.fragment=a.webGl2.fragment,a.vertex=a.webGl2.vertex,delete a.webGl2);else throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);const c=r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,u=a.vertex instanceof Function?a.vertex(c):a.vertex,d=a.fragment instanceof Function?a.fragment(c):a.fragment,h=Xs(i,i.VERTEX_SHADER,u),p=Xs(i,i.FRAGMENT_SHADER,d);if(!h||!p)throw new Error(`Unable to create the following shader(s): ${[!h&&"VERTEX_SHADER",!p&&"FRAGMENT_SHADER"].filter(Boolean).join(" and ")}`);const g=lo(i,h,p);if(!g)throw new Error("Unable to create program");this.program=g,this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...e.attributes].forEach(x=>{const T=i.getAttribLocation(this.program,x);if(T<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${x}"!`);const y=i.createBuffer();if(!y)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${x}"`);this.attributeLocations[x]=T,this.attributeBuffers[x]=y,this.attributeNames.push(x)}),this.uniformLocations={},this.uniformTypes={},e.uniforms.forEach(x=>{const T=i.getUniformLocation(this.program,x.name);if(this.uniformTypes[x.name]=x.uniform,!T){console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${x.name}"`);return}this.uniformLocations[x.name]=T})}bindBufferAttribute(e,r,i){const{glw:n}=this;n.enableVertexAttribArray(e),n.vertexAttribPointer(r,e,i.size,i.type,i.normalized,i.stride,i.offset)}disableAttribute(e){this.glw.disableVertexAttribArray(e)}disableAttributes(){for(const e in this.attributeLocations)this.disableAttribute(this.attributeLocations[e]);this.boundBufferCollection=null}canBatchShaderProps(e,r){return!1}bindRenderOp(e,r){this.bindBufferCollection(e.buffers),e.textures.length>0&&this.bindTextures(e.textures);const{glw:i,parentHasRenderTexture:n,renderToTexture:o}=e;if(!(o&&n)){if(n){const{width:l,height:a}=e.framebufferDimensions||{};i.uniform1f(this.getUniformLocation("u_pixelRatio"),1),i.uniform2f(this.getUniformLocation("u_resolution"),l??0,a??0)}else i.uniform1f(this.getUniformLocation("u_pixelRatio"),e.options.pixelRatio),i.uniform2f(this.getUniformLocation("u_resolution"),i.canvas.width,i.canvas.height);if(r){if(Pr(r,"$dimensions")){let l=r.$dimensions;l||(l=e.dimensions),i.uniform2f(this.getUniformLocation("u_dimensions"),l.width,l.height)}if(Pr(r,"$alpha")){let l=r.$alpha;l||(l=e.alpha),i.uniform1f(this.getUniformLocation("u_alpha"),l)}this.bindProps(r)}}}getUniformLocation(e){return this.uniformLocations[e]||null}bindBufferCollection(e){if(this.boundBufferCollection!==e){for(const r in this.attributeLocations){const i=e.getBuffer(r),n=e.getAttributeInfo(r);R(i,`Buffer for "${r}" not found`),R(n),this.bindBufferAttribute(this.attributeLocations[r],i,n)}this.boundBufferCollection=e}}bindProps(e){}bindTextures(e){}attach(){this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}f(Ke,"shaderSources");class yi extends Ke{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"}]})}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}}f(yi,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;


      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio;
        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);

        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);
        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
          vec4 color = texture2D(u_texture, v_textureCoordinate);
          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);
      }
    `});class Ti extends Ke{constructor(e){super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color","a_textureIndex"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_textures[0]",uniform:"uniform1iv"}]});f(this,"supportsIndexedTextures",!0)}bindTextures(e){const{renderer:r,glw:i}=this;if(e.length>r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS)throw new Error(`DefaultShaderBatched: Cannot bind more than ${r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS} textures`);e.forEach((o,l)=>{i.activeTexture(l),i.bindTexture(o.ctxTexture)});const n=Array.from(Array(e.length).keys());this.glw.uniform1iv(this.getUniformLocation("u_textures[0]"),n)}}f(Ti,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_textureCoordinate;
      attribute vec2 a_position;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      void main(){
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;
        v_textureIndex = a_textureIndex;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:e=>`
      #define txUnits ${e}
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_image;
      uniform sampler2D u_textures[txUnits];

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      vec4 sampleFromTexture(sampler2D textures[${e}], int idx, vec2 uv) {
        ${Array.from(Array(e).keys()).map(r=>`
          ${r!==0?"else ":""}if (idx == ${r}) {
            return texture2D(textures[${r}], uv);
          }
        `).join("")}
        return texture2D(textures[0], uv);
      }

      void main(){
        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);
      }
    `});class J{constructor(t){f(this,"priority",1);f(this,"name","");f(this,"ref");f(this,"target");f(this,"passParameters","");f(this,"declaredUniforms","");f(this,"uniformInfo",{});const{ref:e,target:r,props:i={}}=t;this.ref=e,this.target=r;const n={},o=[];let l="";const a=this.constructor.uniforms||{};for(const c in a){const u=a[c],d=u.type,h=`${e}_${c}`;let p="";u.size&&(p=`[${u.size(i)}]`),o.push(h),l+=`uniform ${d} ${h}${p};`,n[c]={name:h,uniform:a[c].method}}this.passParameters=o.join(","),this.declaredUniforms=l,this.uniformInfo=n}static getEffectKey(t){return""}static getMethodParameters(t,e){const r=[];for(const i in t){const n=t[i];let o="";n.size&&(o=`[${n.size(e)}]`),r.push(`${n.type} ${i}${o}`)}return r.join(",")}static resolveDefaults(t){return{}}static makeEffectKey(t){return!1}}f(J,"uniforms",{}),f(J,"methods"),f(J,"onShaderMask"),f(J,"onColorize"),f(J,"onEffectMask");const Zr=new Map,fo=(s,t)=>{const e=JSON.stringify(s);if(Zr.has(e))return Zr.get(e);s=s??[];const r=[],i=s.length;let n=0;for(;n<i;n++){const{name:o,type:l,props:a}=s[n],c={name:o,type:l,props:{}},u=t[l],d=u.resolveDefaults(a),h=u.uniforms,p=Object.keys(h),g=p.length;let x=0;for(;x<g;x++){const T=p[x],y=h[T],S={value:d[T],programValue:void 0,method:y.method,updateOnBind:y.updateOnBind||!1,hasValidator:y.validator!==void 0,hasProgramValueUpdater:y.updateProgramValue!==void 0},v=S.hasValidator&&y.validator(d[T],d)||d[T];d[T]!==v&&(S.validatedValue=v),S.hasProgramValueUpdater&&y.updateProgramValue(S),S.programValue===void 0&&(S.programValue=S.value),c.props[T]=S}r.push(c)}return Zr.set(e,r),r},me=class me extends Ke{constructor(e,r,i){const n=me.createShader(r,i);super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_alpha",uniform:"uniform1f"},...n.uniforms],shaderSources:{vertex:n.vertex,fragment:n.fragment}});f(this,"effects",[]);this.effects=n.effects}bindTextures(e){const{glw:r}=this;r.activeTexture(0),r.bindTexture(e[0].ctxTexture)}bindUniformMethods(e){const r=this.glw,i=e.effects,n=i.length;for(let o=0;o<n;o++){const l=this.effects[o].uniformInfo,a=i[o],c=Object.keys(a.props),u=c.length;for(let d=0;d<u;d++){const h=c[d],p=a.props[h].method,g=this.getUniformLocation(l[h].name);if(p==="uniform2fv"||p==="uniform2iv"||p==="uniform3iv"||p==="uniform4fv"||p==="uniform4iv"||p==="uniformMatrix2fv"||p==="uniformMatrix3fv"||p==="uniformMatrix4fv"||p==="uniform1f"||p==="uniform1fv"||p==="uniform1i"||p==="uniform1iv"){a.props[h].setUniformValue=function(){r[p](g,this.programValue)};continue}if(p==="uniform2f"||p==="uniform2i"){a.props[h].setUniformValue=function(){r[p](g,this.programValue[0],this.programValue[1])};continue}if(p==="uniform3f"||p==="uniform3i"){a.props[h].setUniformValue=function(){r[p](g,this.programValue[0],this.programValue[1],this.programValue[2])};continue}if(p==="uniform4f"||p==="uniform4i"){a.props[h].setUniformValue=function(){r[p](g,this.programValue[0],this.programValue[1],this.programValue[2],this.programValue[3])};continue}}}}bindProps(e){var o;const r=e.effects,i=r.length;let n=0;for(;n<i;n++){const l=r[n],a=Object.keys(l.props),c=a.length;let u=0;for(;u<c;u++){const d=a[u],h=l.props[d];if(h.updateOnBind===!0){const p=(o=this.renderer.shManager.getRegisteredEffects()[l.type])==null?void 0:o.uniforms[d];p==null||p.updateProgramValue(l.props[d],e)}h.setUniformValue()}}}canBatchShaderProps(e,r){if(e.$alpha!==r.$alpha||e.$dimensions.width!==r.$dimensions.width||e.$dimensions.height!==r.$dimensions.height||e.effects.length!==r.effects.length)return!1;const i=e.effects.length;let n=0;for(;n<i;n++){const o=e.effects[n],l=r.effects[n];if(o.type!==l.type)return!1;for(const a in o.props)if(l.props&&!l.props[a]||o.props[a].value!==l.props[a].value)return!1}return!0}static createShader(e,r){const i={},n={};let o="";const l=[],a=[],c=e.effects.map(g=>{const x=r[g.type],T=x.getEffectKey(g.props||{});i[T]=i[T]?++i[T]:1;const y=i[T];y===1&&a.push({key:T,type:g.type,props:g.props});const S=new x({ref:`${T}${y===1?"":y}`,target:T,props:g.props});return o+=S.declaredUniforms,l.push(...Object.values(S.uniformInfo)),S});let u="";a==null||a.forEach(g=>{const x=r[g.type],T=x.resolveDefaults(g.props??{}),y=[];for(const M in x.methods){let L=M;const W=x.methods[M];n[M]&&n[M]!==W&&(L=me.resolveMethodDuplicate(M,W,n)),n[L]=W.replace("function",L),y.push({m:M,cm:L})}let S=x.onShaderMask instanceof Function?x.onShaderMask(T):x.onShaderMask,v=x.onColorize instanceof Function?x.onColorize(T):x.onColorize,C=x.onEffectMask instanceof Function?x.onEffectMask(T):x.onEffectMask;y.forEach(M=>{const{m:L,cm:W}=M,k=new RegExp(`\\$${L}`,"g");S&&(S=S.replace(k,W)),v&&(v=v.replace(k,W)),C&&(C=C.replace(k,W))});const $=x.getMethodParameters(x.uniforms,T),A=$.length>0?`, ${$}`:"";S&&(u+=`
        float fx_${g.key}_onShaderMask(float shaderMask ${A}) {
          ${S}
        }
        `),v&&(u+=`
          vec4 fx_${g.key}_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor${A}) {
            ${v}
          }
        `),C&&(u+=`
          vec4 fx_${g.key}_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor${A}) {
            ${C}
          }
        `)});let d="";for(const g in n)d+=n[g];let h="mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))",p=`

    `;for(let g=0;g<c.length;g++){const x=c[g],T=x.passParameters.length>0?`, ${x.passParameters}`:"",y=r[x.name];y.onShaderMask&&(p+=`
        shaderMask = fx_${x.target}_onShaderMask(shaderMask ${T});
        `),y.onColorize&&(p+=`
        maskColor = fx_${x.target}_onColorize(shaderMask, maskColor, shaderColor${T});
        `),y.onEffectMask&&(h=`fx_${x.target}_onEffectMask(shaderMask, maskColor, shaderColor${T})`);const S=c[g+1];(S===void 0||r[S.name].onEffectMask)&&(p+=`
          shaderColor = ${h};
        `)}return{effects:c,uniforms:l,fragment:me.fragment(o,d,u,p),vertex:me.vertex()}}static resolveMethodDuplicate(e,r,i,n=0){const o=e+(n>0?n:"");return i[o]&&i[o]!==r?this.resolveMethodDuplicate(e,r,i,++n):o}static resolveDefaults(e,r){return R(r),{effects:fo(e.effects??[],r),$dimensions:{width:0,height:0},$alpha:0}}static makeCacheKey(e,r){var n;let i="";return(n=e.effects)==null||n.forEach(o=>{const a=r[o.type].getEffectKey(o.props||{});i+=`,${a}`}),`DynamicShader${i}`}};f(me,"z$__type__Props"),f(me,"vertex",()=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    attribute vec2 a_textureCoordinate;
    attribute vec2 a_position;
    attribute vec4 a_color;
    attribute float a_textureIndex;

    uniform vec2 u_resolution;
    uniform float u_pixelRatio;

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;
    varying float v_textureIndex;

    void main(){
      vec2 normalized = a_position * u_pixelRatio / u_resolution;
      vec2 zero_two = normalized * 2.0;
      vec2 clip_space = zero_two - 1.0;

      // pass to fragment
      v_color = a_color;
      v_textureCoordinate = a_textureCoordinate;
      v_textureIndex = a_textureIndex;

      // flip y
      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
    }
  `),f(me,"fragment",(e,r,i,n)=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    #define PI 3.14159265359

    uniform vec2 u_resolution;
    uniform vec2 u_dimensions;
    uniform float u_alpha;
    uniform float u_radius;
    uniform sampler2D u_texture;
    uniform float u_pixelRatio;

    ${e}

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;

    ${r}

    ${i}

    void main() {
      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;
      vec2 d = abs(p) - (u_dimensions) * 0.5;
      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));

      vec4 shaderColor = vec4(0.0);
      float shaderMask = lng_DefaultMask;

      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;

      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));

      ${n}

      gl_FragColor = shaderColor * u_alpha;
    }
  `);let ht=me;class hs extends Ke{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_radius",uniform:"uniform1f"}]})}static resolveDefaults(t){return{radius:t.radius||10,$dimensions:{width:0,height:0}}}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}bindProps(t){const e=Math.min(t.$dimensions.width,t.$dimensions.height)/(2*t.radius);this.glw.uniform1f(this.getUniformLocation("u_radius"),t.radius*Math.min(e,1))}canBatchShaderProps(t,e){return t.radius===e.radius&&t.$dimensions.width===e.$dimensions.width&&t.$dimensions.height===e.$dimensions.height}}f(hs,"z$__type__Props"),f(hs,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform vec2 u_dimensions;
      uniform float u_radius;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      float boxDist(vec2 p, vec2 size, float radius){
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }

      float fillMask(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }

      void main() {
        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;
        vec2 halfDimensions = u_dimensions * 0.5;

        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);
        gl_FragColor = mix(vec4(0.0), color, fillMask(d));
      }
    `});const co=new Float32Array([1,0,0,0,1,0,0,0,1]),Pt=class Pt extends Ke{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_transform",uniform:"uniformMatrix3fv"},{name:"u_scrollY",uniform:"uniform1f"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_color",uniform:"uniform4fv"},{name:"u_size",uniform:"uniform1f"},{name:"u_distanceRange",uniform:"uniform1f"},{name:"u_debug",uniform:"uniform1i"}]})}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}bindProps(t){const e=Pt.resolveDefaults(t);for(const r in e)if(r==="transform")this.glw.uniformMatrix3fv(this.getUniformLocation("u_transform"),e[r]);else if(r==="scrollY")this.glw.uniform1f(this.getUniformLocation("u_scrollY"),e[r]);else if(r==="color"){const i=Ut(e.color);this.glw.uniform4fv(this.getUniformLocation("u_color"),i)}else r==="size"?this.glw.uniform1f(this.getUniformLocation("u_size"),e[r]):r==="distanceRange"?this.glw.uniform1f(this.getUniformLocation("u_distanceRange"),e[r]):r==="debug"&&this.glw.uniform1i(this.getUniformLocation("u_debug"),e[r]?1:0)}static resolveDefaults(t={}){return{transform:t.transform??co,scrollY:t.scrollY??0,color:t.color??4294967295,size:t.size??16,distanceRange:t.distanceRange??1,debug:t.debug??!1}}};f(Pt,"z$__type__Props"),f(Pt,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      // an attribute is an input (in) to a vertex shader.
      // It will receive data from a buffer
      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;

      uniform vec2 u_resolution;
      uniform mat3 u_transform;
      uniform float u_scrollY;
      uniform float u_pixelRatio;
      uniform float u_size;

      varying vec2 v_texcoord;

      void main() {
        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);
        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;

        // Calculate screen space with pixel ratio
        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);

        gl_Position = vec4(screenSpace, 0.0, 1.0);
        v_texcoord = a_textureCoordinate;

      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      uniform vec4 u_color;
      uniform sampler2D u_texture;
      uniform float u_distanceRange;
      uniform float u_pixelRatio;
      uniform int u_debug;

      varying vec2 v_texcoord;

      float median(float r, float g, float b) {
          return max(min(r, g), min(max(r, g), b));
      }

      void main() {
          vec3 sample = texture2D(u_texture, v_texcoord).rgb;
          if (u_debug == 1) {
            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);
            return;
          }
          float scaledDistRange = u_distanceRange * u_pixelRatio;
          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);
          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;

          // Build the final color.
          // IMPORTANT: We must premultiply the color by the alpha value before returning it.
          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);
      }
    `});let us=Pt;const bt=s=>{s.programValue===void 0&&(s.programValue=new Float32Array(4));const t=s.value,e=s.programValue;e[0]=(t>>>24)/255,e[1]=(t>>>16&255)/255,e[2]=(t>>>8&255)/255,e[3]=(t&255)/255},ho=s=>{const t=s.validatedValue||s.value;if(s.programValue instanceof Float32Array){const e=s.programValue;e[0]=t[0],e[1]=t[1]}else s.programValue=new Float32Array(t)},uo=s=>{const t=s.validatedValue||s.value;if(s.programValue instanceof Float32Array){const e=s.programValue;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]}else s.programValue=new Float32Array(t)},bi=s=>{const t=s.validatedValue||s.value;if(s.programValue instanceof Float32Array){const e=t.length,r=s.programValue;for(let i=0;i<e;i++)r[i]=t[i]}else s.programValue=new Float32Array(t)},Rs=s=>{const t=Array.isArray(s);if(t){if(t&&s.length===4)return s;if(t&&s.length===2)return[s[0],s[1],s[0],s[1]];if(t&&s.length===3)return[s[0],s[1],s[2],s[0]]}else return[s,s,s,s];return[s[0],s[0],s[0],s[0]]},Si=(s,t)=>{s.programValue===void 0&&(s.programValue=new Float32Array(4));const e=s.programValue,r=s.validatedValue||s.value;if(t===void 0&&s.$dimensions===void 0){e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3];return}let i=s.$dimensions;if(t!==void 0){const{$dimensions:h}=t;if(i!==void 0&&(i.width===h.width||i.height===h.height))return;i===void 0&&(i={width:h==null?void 0:h.width,height:h==null?void 0:h.height},s.$dimensions=i)}const{width:n,height:o}=i,[l,a,c,u]=r,d=Math.min(Math.min(Math.min(n/Math.max(n,l+a),n/Math.max(n,c+u)),Math.min(o/Math.max(o,l+c),o/Math.max(o,a+u))),1);e[0]=l*d,e[1]=a*d,e[2]=c*d,e[3]=u*d};class Je extends J{constructor(){super(...arguments);f(this,"name","radius")}static getEffectKey(){return"radius"}static resolveDefaults(e){return{radius:e.radius??10}}}f(Je,"z$__type__Props"),f(Je,"uniforms",{radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:Rs,updateProgramValue:Si}}),f(Je,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),f(Je,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);
  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);
  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);
  `),f(Je,"onEffectMask",`
  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));
  `);class vt extends J{constructor(){super(...arguments);f(this,"name","border")}static getEffectKey(){return"border"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}f(vt,"z$__type__Props"),f(vt,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:bt,method:"uniform4fv",type:"vec4"}}),f(vt,"onEffectMask",`
  float intR = shaderMask + 1.0;
  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);
  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);
  `),f(vt,"onColorize",`
    return color;
  `);const Fe=class Fe extends J{constructor(){super(...arguments);f(this,"name","linearGradient")}static getEffectKey(e){return e.colors.value?`linearGradient${e.colors.value.length}`:`linearGradient${e.colors.length}`}static resolveDefaults(e){const r=e.colors??[4278190080,4294967295];let i=e.stops||[];if(i.length===0||i.length!==r.length){const n=r.length;let o=0;const l=i;for(;o<n;o++)i[o]?(l[o]=i[o],i[o-1]===void 0&&l[o-2]!==void 0&&(l[o-1]=l[o-2]+(i[o]-l[o-2])/2)):l[o]=o*(1/(r.length-1));i=l}return{colors:r,stops:i,angle:e.angle??0}}};f(Fe,"z$__type__Props"),f(Fe,"uniforms",{angle:{value:0,method:"uniform1f",type:"float"},colors:{value:4294967295,validator:e=>e.reduce((r,i)=>r.concat(Ut(i)),[]),updateProgramValue:bi,size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),f(Fe,"methods",{fromLinear:`
      vec4 function(vec4 linearRGB) {
        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);
        vec4 lower = linearRGB * vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,toLinear:`
      vec4 function(vec4 sRGB) {
        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));
        vec4 lower = sRGB/vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,calcPoint:`
      vec2 function(float d, float angle) {
        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);
      }
    `}),f(Fe,"ColorLoop",e=>{let r="";for(let i=2;i<e;i++)r+=`colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i-1}]) / (stops[${i}] - stops[${i-1}]), 0.0, 1.0));`;return r}),f(Fe,"onColorize",e=>{const r=e.colors.length||1;return`
      float a = angle - (PI / 180.0 * 90.0);
      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));
      vec2 f = $calcPoint(lineDist * 0.5, a);
      vec2 t = $calcPoint(lineDist * 0.5, a + PI);
      vec2 gradVec = t - f;
      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));
      ${Fe.ColorLoop(r)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let ds=Fe;class ps extends J{constructor(){super(...arguments);f(this,"name","grayscale")}static getEffectKey(){return"grayscale"}static resolveDefaults(e){return{amount:e.amount??1}}}f(ps,"uniforms",{amount:{value:1,method:"uniform1f",type:"float"}}),f(ps,"onColorize",`
    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;
    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);
  `);class et extends J{constructor(){super(...arguments);f(this,"name","borderRight")}static getEffectKey(){return"borderRight"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}f(et,"z$__type__Props"),f(et,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:bt,method:"uniform4fv",type:"vec4"}}),f(et,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),f(et,"onEffectMask",`
  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),f(et,"onColorize",`
    return color;
  `);class tt extends J{constructor(){super(...arguments);f(this,"name","borderTop")}static getEffectKey(){return"borderTop"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}f(tt,"z$__type__Props"),f(tt,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:bt,method:"uniform4fv",type:"vec4"}}),f(tt,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),f(tt,"onEffectMask",`
  vec2 pos = vec2(0.0, width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),f(tt,"onColorize",`
    return color;
  `);class rt extends J{constructor(){super(...arguments);f(this,"name","borderBottom")}static getEffectKey(){return"borderBottom"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}f(rt,"z$__type__Props"),f(rt,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:bt,method:"uniform4fv",type:"vec4"}}),f(rt,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),f(rt,"onEffectMask",`
  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),f(rt,"onColorize",`
    return color;
  `);class st extends J{constructor(){super(...arguments);f(this,"name","borderLeft")}static getEffectKey(){return"borderLeft"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}f(st,"z$__type__Props"),f(st,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:bt,method:"uniform4fv",type:"vec4"}}),f(st,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),f(st,"onEffectMask",`
  vec2 pos = vec2(width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),f(st,"onColorize",`
    return color;
  `);class Ct extends J{constructor(){super(...arguments);f(this,"name","glitch")}static getEffectKey(e){return"glitch"}static resolveDefaults(e){return{amplitude:e.amplitude??.2,narrowness:e.narrowness??4,blockiness:e.blockiness??2,minimizer:e.minimizer??8,time:e.time??Date.now()}}}f(Ct,"z$__type__Props"),f(Ct,"uniforms",{amplitude:{value:0,method:"uniform1f",type:"float"},narrowness:{value:0,method:"uniform1f",type:"float"},blockiness:{value:0,method:"uniform1f",type:"float"},minimizer:{value:0,method:"uniform1f",type:"float"},time:{value:0,method:"uniform1f",updateOnBind:!0,updateProgramValue:e=>{const r=e.value=(Date.now()-e.value)%1e3;e.programValue=r},type:"float"}}),f(Ct,"methods",{rand:`
      float function(vec2 p, float time) {
        float t = floor(time * 20.) / 10.;
        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);
      }
    `,noise:`
      float function(vec2 uv, float blockiness, float time) {
        vec2 lv = fract(uv);
        vec2 id = floor(uv);

        float n1 = rand(id, time);
        float n2 = rand(id+vec2(1,0), time);
        float n3 = rand(id+vec2(0,1), time);
        float n4 = rand(id+vec2(1,1), time);
        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);
        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);
      }
    `,fbm:`
      float function(vec2 uv, int count, float blockiness, float complexity, float time) {
        float val = 0.0;
        float amp = 0.5;
        const int MAX_ITERATIONS = 10;

        for(int i = 0; i < MAX_ITERATIONS; i++) {
          if(i >= count) {break;}
          val += amp * noise(uv, blockiness, time);
          amp *= 0.5;
          uv *= complexity;
        }
        return val;
      }
    `}),f(Ct,"onColorize",`
    vec2 uv = v_textureCoordinate.xy;
    float aspect = u_dimensions.x / u_dimensions.y;
    vec2 a = vec2(uv.x * aspect , uv.y);
    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));

    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);
    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);
    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);
    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);

    vec3 f = vec3(colR, colG, colB);
    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);
  `);class Cr extends J{constructor(){super(...arguments);f(this,"name","fadeOut")}static getEffectKey(){return"fadeOut"}static resolveDefaults(e){return{fade:e.fade??10}}}f(Cr,"z$__type__Props"),f(Cr,"uniforms",{fade:{value:0,method:"uniform4fv",type:"vec4",validator:Rs,updateProgramValue:uo}}),f(Cr,"onColorize",`
  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;
  vec2 pos1;
  vec2 pos2;
  vec2 d;
  float c;
  vec4 result = maskColor;


  if(fade[0] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x, point.y + fade[0]);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[1] > 0.0) {
    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);
    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[2] > 0.0) {
    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);
    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[3] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x + fade[3], point.y);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  return result;
  `);const Ge=class Ge extends J{constructor(){super(...arguments);f(this,"name","radialGradient")}static getEffectKey(e){return e.colors.value?`radialGradient${e.colors.value.length}`:`radialGradient${e.colors.length}`}static resolveDefaults(e){const r=e.colors??[4278190080,4294967295];let i=e.stops||[];if(i.length===0||i.length!==r.length){const n=r.length;let o=0;const l=i;for(;o<n;o++)i[o]?(l[o]=i[o],i[o-1]===void 0&&l[o-2]!==void 0&&(l[o-1]=l[o-2]+(i[o]-l[o-2])/2)):l[o]=o*(1/(r.length-1));i=l}return{colors:r,stops:i,width:e.width??0,height:e.height??e.width??0,pivot:e.pivot??[.5,.5]}}};f(Ge,"z$__type__Props"),f(Ge,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},pivot:{value:[.5,.5],updateProgramValue:ho,method:"uniform2fv",type:"vec2"},colors:{value:4294967295,validator:e=>e.reduce((r,i)=>r.concat(Ut(i)),[]),updateProgramValue:bi,size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),f(Ge,"ColorLoop",e=>{let r="";for(let i=2;i<e;i++)r+=`colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i-1}]) / (stops[${i}] - stops[${i-1}]), 0.0, 1.0));`;return r}),f(Ge,"onColorize",e=>{const r=e.colors.length||1;return`
      vec2 point = v_textureCoordinate.xy * u_dimensions;
      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);

      float dist = length((point - projection) / vec2(width, height));

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = mix(colors[0], colors[1], stopCalc);
      ${Ge.ColorLoop(r)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let ms=Ge;class it extends J{constructor(){super(...arguments);f(this,"name","radialProgress")}static getEffectKey(){return"radialProgress"}static resolveDefaults(e){return{width:e.width??10,progress:e.progress??.5,offset:e.offset??0,range:e.range??Math.PI*2,rounded:e.rounded??!1,radius:e.radius??1,color:e.color??4294967295}}}f(it,"z$__type__Props"),f(it,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},progress:{value:.5,method:"uniform1f",type:"float"},offset:{value:0,method:"uniform1f",type:"float"},range:{value:0,method:"uniform1f",type:"float"},rounded:{value:0,method:"uniform1f",type:"float",validator:e=>e?1:0},radius:{value:1,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:bt,method:"uniform4fv",type:"vec4"}}),f(it,"methods",{rotateUV:`
    vec2 function(vec2 uv, float d) {
      float s = sin(d);
      float c = cos(d);
      mat2 rotMatrix = mat2(c, -s, s, c);
      return uv * rotMatrix;
    }
    `,drawDot:`
    float function(vec2 uv, vec2 p, float r) {
      uv += p;
      float circle = length(uv) - r;
      return clamp(-circle, 0.0, 1.0);
    }
    `}),f(it,"onEffectMask",`
    float outerRadius = radius * u_dimensions.y * 0.5;

    float endAngle = range * progress - 0.0005;

    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;

    uv = $rotateUV(uv, -(offset));
    float linewidth = width * u_pixelRatio;
    float circle = length(uv) - (outerRadius - linewidth) ;
    circle = abs(circle) - linewidth;
    circle = clamp(-circle, 0.0, 1.0);

    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);
    float p = endAngle / (PI * 2.);

    circle *= step(fract(angle), fract(p));

    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));
    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));

    return mix(shaderColor, maskColor, circle);
  `),f(it,"onColorize",`
    return color;
  `);class nt extends J{constructor(){super(...arguments);f(this,"name","holePunch")}static getEffectKey(){return"holePunch"}static resolveDefaults(e){return{x:e.x||0,y:e.y||0,width:e.width||50,height:e.height||50,radius:e.radius??0}}}f(nt,"z$__type__Props"),f(nt,"uniforms",{x:{value:0,method:"uniform1f",type:"float"},y:{value:0,method:"uniform1f",type:"float"},width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:Rs,updateProgramValue:Si}}),f(nt,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),f(nt,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  vec2 size = vec2(width, height) * 0.5;
  vec2 basePos = v_textureCoordinate.xy * u_dimensions.xy - vec2(x, y);
  vec2 pos = basePos - size;
  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);
  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);
  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);
  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);
  return $boxDist(pos, size, r);
  `),f(nt,"onEffectMask",`
  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));
  `);const po="RoundedRectangle";class zr extends xi{constructor(e){super();f(this,"shType");this.shType=e}bindRenderOp(){}bindProps(){}attach(){}detach(){}}class mo{constructor(t,e,r,i){f(this,"type");f(this,"shader");f(this,"resolvedProps");f(this,"props");this.type=t,this.shader=e,this.resolvedProps=r;const n=Object.keys(r),o=n.length,l={};for(let a=0;a<o;a++){const c=n[a];Object.defineProperty(l,c,{get:()=>this.resolvedProps[c],set:u=>{this.resolvedProps[c]=u,i.requestRender()}})}this.props=l}getResolvedProps(){return this.resolvedProps}}class go{constructor(t,e,r){f(this,"shader");f(this,"resolvedProps");f(this,"props");f(this,"type");this.shader=t,this.type="DynamicShader",this.resolvedProps=e;const i=r.getRegisteredEffects(),n={},o=e.effects,l=o.length;for(let a=0;a<l;a++){const{name:c,props:u,type:d}=o[a];if(c===void 0)continue;const h={},p=Object.keys(u),g=p.length;for(let x=0;x<g;x++){const T=p[x];Object.defineProperty(h,T,{get:()=>this.resolvedProps.effects[a].props[T].value,set:y=>{var v,C;const S=this.resolvedProps.effects[a].props[T];S.value=y,S.hasValidator&&(y=S.validatedValue=(v=i[d].uniforms[T])==null?void 0:v.validator(y,u)),S.hasProgramValueUpdater?(C=i[d].uniforms[T])==null||C.updateProgramValue(S):S.programValue=y,r.renderer.stage.requestRender()}})}Object.defineProperty(n,c,{get:()=>h})}this.props=n}getResolvedProps(){return this.resolvedProps}}class xo{constructor(){f(this,"shCache",new Map);f(this,"shConstructors",{});f(this,"attachedShader",null);f(this,"effectConstructors",{});f(this,"renderer");this.registerShaderType("DefaultShader",yi),this.registerShaderType("DefaultShaderBatched",Ti),this.registerShaderType("RoundedRectangle",hs),this.registerShaderType("DynamicShader",ht),this.registerShaderType("SdfShader",us),this.registerEffectType("border",vt),this.registerEffectType("borderBottom",rt),this.registerEffectType("borderLeft",st),this.registerEffectType("borderRight",et),this.registerEffectType("borderTop",tt),this.registerEffectType("fadeOut",Cr),this.registerEffectType("linearGradient",ds),this.registerEffectType("radialGradient",ms),this.registerEffectType("grayscale",ps),this.registerEffectType("glitch",Ct),this.registerEffectType("radius",Je),this.registerEffectType("radialProgress",it),this.registerEffectType("holePunch",nt)}registerShaderType(t,e){this.shConstructors[t]=e}registerEffectType(t,e){this.effectConstructors[t]=e}getRegisteredEffects(){return this.effectConstructors}getRegisteredShaders(){return this.shConstructors}loadShader(t,e){if(!this.renderer)throw new Error("Renderer is not been defined");const r=this.shConstructors[t];if(!r)throw new Error(`Shader type "${t}" is not registered`);if(this.renderer.mode==="canvas"&&r.prototype instanceof Ke)return this._createShaderCtr(t,new zr(t),e);if(t==="DynamicShader")return this.loadDynamicShader(e);const i=r.resolveDefaults(e),n=r.makeCacheKey(i)||r.name;if(n&&this.shCache.has(n))return this._createShaderCtr(t,this.shCache.get(n),i);const o=new r(this.renderer,e);return n&&this.shCache.set(n,o),this._createShaderCtr(t,o,i)}loadDynamicShader(t){if(!this.renderer)throw new Error("Renderer is not been defined");const e=ht.resolveDefaults(t,this.effectConstructors),r=ht.makeCacheKey(e,this.effectConstructors);if(r&&this.shCache.has(r))return this._createDynShaderCtr(this.shCache.get(r),e);const i=new ht(this.renderer,t,this.effectConstructors);return r&&this.shCache.set(r,i),this._createDynShaderCtr(i,e)}_createShaderCtr(t,e,r){return new mo(t,e,r,this.renderer.stage)}_createDynShaderCtr(t,e){return t.bindUniformMethods(e),new go(t,e,this)}useShader(t){this.attachedShader!==t&&(this.attachedShader&&this.attachedShader.detach(),t.attach(),this.attachedShader=t)}}const yo={x:(s,t)=>{s.props.x=t},y:(s,t)=>{s.props.y=t},width:(s,t)=>{s.props.width=t},height:(s,t)=>{s.props.height=t},color:(s,t)=>{s.props.color=t},zIndex:(s,t)=>{s.props.zIndex=t},fontFamily:(s,t)=>{s.props.fontFamily=t},fontWeight:(s,t)=>{s.props.fontWeight=t},fontStyle:(s,t)=>{s.props.fontStyle=t},fontStretch:(s,t)=>{s.props.fontStretch=t},fontSize:(s,t)=>{s.props.fontSize=t},text:(s,t)=>{s.props.text=t},textAlign:(s,t)=>{s.props.textAlign=t},contain:(s,t)=>{s.props.contain=t},offsetY:(s,t)=>{s.props.offsetY=t},scrollable:(s,t)=>{s.props.scrollable=t},scrollY:(s,t)=>{s.props.scrollY=t},letterSpacing:(s,t)=>{s.props.letterSpacing=t},lineHeight:(s,t)=>{s.props.lineHeight=t},maxLines:(s,t)=>{s.props.maxLines=t},textBaseline:(s,t)=>{s.props.textBaseline=t},verticalAlign:(s,t)=>{s.props.verticalAlign=t},overflowSuffix:(s,t)=>{s.props.overflowSuffix=t},debug:(s,t)=>{s.props.debug=t}};class _s{constructor(t){f(this,"stage");f(this,"set");this.stage=t;const e={...yo,...this.getPropertySetters()},r={};Object.keys(e).forEach(i=>{Object.defineProperty(r,i,{value:(n,o)=>{n.props[i]!==o&&(e[i](n,o),this.stage.requestRender())},writable:!1,configurable:!1})}),this.set=r}setStatus(t,e,r){t.status!==e&&(t.status=e,t.emitter.emit(e,r))}setIsRenderable(t,e){t.isRenderable=e}destroyState(t){this.setStatus(t,"destroyed"),t.emitter.removeAllListeners()}scheduleUpdateState(t){t.updateScheduled||(t.updateScheduled=!0,queueMicrotask(()=>{t.status!=="destroyed"&&(t.updateScheduled=!1,this.updateState(t))}))}}class To{constructor(){f(this,"data",{})}reset(){this.data={}}increment(t){this.data[t]||(this.data[t]=0),this.data[t]++}getData(){return{...this.data}}}class bo{constructor(t,e){f(this,"stage");f(this,"memUsed",0);f(this,"loadedTextures",new Map);f(this,"orphanedTextures",[]);f(this,"criticalThreshold");f(this,"targetThreshold");f(this,"cleanupInterval");f(this,"debugLogging");f(this,"lastCleanupTime",0);f(this,"baselineMemoryAllocation");f(this,"criticalCleanupRequested",!1);f(this,"doNotExceedCriticalThreshold");f(this,"frameTime",0);this.stage=t;const{criticalThreshold:r,doNotExceedCriticalThreshold:i}=e;this.doNotExceedCriticalThreshold=i||!1,this.criticalThreshold=Math.round(r);const n=Math.max(0,Math.min(1,e.targetThresholdLevel));if(this.cleanupInterval=e.cleanupInterval,this.debugLogging=e.debugLogging,this.baselineMemoryAllocation=Math.round(e.baselineMemoryAllocation),this.targetThreshold=Math.max(Math.round(r*n),this.baselineMemoryAllocation),this.memUsed=Math.round(e.baselineMemoryAllocation),e.debugLogging){let o=0;setInterval(()=>{o!==this.memUsed&&(o=this.memUsed,console.log(`[TextureMemoryManager] Memory used: ${Ds(this.memUsed)} mb / ${Ds(this.criticalThreshold)} mb (${(this.memUsed/this.criticalThreshold*100).toFixed(1)}%)`))},1e3)}r===0&&(this.setTextureMemUse=()=>{})}addToOrphanedTextures(t){this.orphanedTextures.includes(t)&&this.removeFromOrphanedTextures(t),t.preventCleanup===!1&&this.orphanedTextures.push(t)}removeFromOrphanedTextures(t){const e=this.orphanedTextures.indexOf(t);e!==-1&&this.orphanedTextures.splice(e,1)}setTextureMemUse(t,e){if(this.loadedTextures.has(t)&&(this.memUsed-=this.loadedTextures.get(t)),e===0){this.loadedTextures.delete(t);return}else this.memUsed+=e,this.loadedTextures.set(t,e);this.memUsed>this.criticalThreshold&&(this.criticalCleanupRequested=!0)}checkCleanup(){return this.criticalCleanupRequested||this.memUsed>this.targetThreshold&&this.frameTime-this.lastCleanupTime>=this.cleanupInterval}checkCriticalCleanup(){return this.memUsed>this.criticalThreshold}cleanupQuick(t){const e=this.targetThreshold,r=this.stage.txManager,i=Ye();for(;this.memUsed>=e&&this.orphanedTextures.length>0&&(t||Ye()-i<10);){const n=this.orphanedTextures.shift();n!==void 0&&n.renderable!==!0&&(n.free(),r.removeTextureFromCache(n))}}cleanupDeep(t){const e=t?this.criticalThreshold:this.targetThreshold,r=this.stage.txManager,i=[],n=[...this.loadedTextures.keys()];for(let o=0;o<n.length;o++){const l=n[o];l!==void 0&&(l.type===H.image||l.type===H.noise||l.type===H.renderToTexture)&&(l.renderable===!0?i.push(l):i.unshift(l))}for(;this.memUsed>=e&&i.length>0;){const o=i.shift();if(o!==void 0&&o.preventCleanup!==!0){if(o.renderable===!0)break;o.free(),this.removeFromOrphanedTextures(o),r.removeTextureFromCache(o),r.removeTextureFromQueue(o)}}}cleanup(t=!1){const e=this.criticalCleanupRequested;this.lastCleanupTime=this.frameTime,e===!0&&this.stage.queueFrameEvent("criticalCleanup",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),this.debugLogging===!0&&console.log(`[TextureMemoryManager] Cleaning up textures. Critical: ${e}. Aggressive: ${t}`),this.cleanupQuick(e),t===!0&&this.memUsed>=this.criticalThreshold&&this.cleanupDeep(e),this.memUsed>=this.criticalThreshold?(this.stage.queueFrameEvent("criticalCleanupFailed",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),(this.debugLogging===!0||Tt()===!1)&&console.warn(`[TextureMemoryManager] Memory usage above critical threshold after cleanup: ${this.memUsed}`)):this.criticalCleanupRequested=!1}getMemoryInfo(){let t=0;const e=[...this.loadedTextures.keys()].reduce((r,i)=>(t+=i.renderable?1:0,r+(i.renderable?this.loadedTextures.get(i):0)),this.baselineMemoryAllocation);return{criticalThreshold:this.criticalThreshold,targetThreshold:this.targetThreshold,renderableMemUsed:e,memUsed:this.memUsed,renderableTexturesLoaded:t,loadedTextures:this.loadedTextures.size,baselineMemoryAllocation:this.baselineMemoryAllocation}}}class wi{constructor(t,e){f(this,"textureSource");f(this,"memManager");f(this,"state","freed");this.memManager=t,this.textureSource=e}setTextureMemUse(t){this.memManager.setTextureMemUse(this.textureSource,t)}get renderable(){return this.textureSource.renderable}}class vi{constructor(t){f(this,"options");f(this,"mode");f(this,"stage");f(this,"txManager");f(this,"txMemManager");f(this,"shManager");f(this,"rttNodes",[]);this.options=t,this.stage=t.stage,this.txManager=t.txManager,this.txMemManager=t.txMemManager,this.shManager=t.shManager}}class So extends fs{constructor(e,r,i){super(e,r);f(this,"textRenderer");f(this,"trState");f(this,"_textRendererOverride",null);f(this,"onTextLoaded",()=>{const{contain:e}=this,r=this.trState.props.width,i=this.trState.props.height,n=this.trState.textW||0,o=this.trState.textH||0;e==="both"?(this.props.width=r,this.props.height=i):e==="width"?(this.props.width=r,this.props.height=o):e==="none"&&(this.props.width=n,this.props.height=o),this.updateLocalTransform(),this.stage.requestRender(),this.emit("loaded",{type:"text",dimensions:{width:this.trState.textW||0,height:this.trState.textH||0}})});f(this,"onTextFailed",(e,r)=>{this.emit("failed",{type:"text",error:r})});this._textRendererOverride=r.textRendererOverride,this.textRenderer=i;const n=this.createState({x:this.absX,y:this.absY,width:r.width,height:r.height,textAlign:r.textAlign,color:r.color,zIndex:r.zIndex,contain:r.contain,scrollable:r.scrollable,scrollY:r.scrollY,offsetY:r.offsetY,letterSpacing:r.letterSpacing,debug:r.debug,fontFamily:r.fontFamily,fontSize:r.fontSize,fontStretch:r.fontStretch,fontStyle:r.fontStyle,fontWeight:r.fontWeight,text:r.text,lineHeight:r.lineHeight,maxLines:r.maxLines,textBaseline:r.textBaseline,verticalAlign:r.verticalAlign,overflowSuffix:r.overflowSuffix});this.trState=n}get width(){return this.props.width}set width(e){this.props.width=e,this.textRenderer.set.width(this.trState,e),this.contain==="none"&&this.setUpdateType(b.Local)}get height(){return this.props.height}set height(e){this.props.height=e,this.textRenderer.set.height(this.trState,e),this.contain!=="both"&&this.setUpdateType(b.Local)}get color(){return this.trState.props.color}set color(e){this.textRenderer.set.color(this.trState,e)}get text(){return this.trState.props.text}set text(e){this.textRenderer.set.text(this.trState,e)}get textRendererOverride(){return this._textRendererOverride}set textRendererOverride(e){this._textRendererOverride=e,this.textRenderer.destroyState(this.trState);const r=this.stage.resolveTextRenderer(this.trState.props,this._textRendererOverride);if(!r){console.warn("Text Renderer not found for font",this.trState.props.fontFamily);return}this.textRenderer=r,this.trState=this.createState(this.trState.props)}get fontSize(){return this.trState.props.fontSize}set fontSize(e){this.textRenderer.set.fontSize(this.trState,e)}get fontFamily(){return this.trState.props.fontFamily}set fontFamily(e){this.textRenderer.set.fontFamily(this.trState,e)}get fontStretch(){return this.trState.props.fontStretch}set fontStretch(e){this.textRenderer.set.fontStretch(this.trState,e)}get fontStyle(){return this.trState.props.fontStyle}set fontStyle(e){this.textRenderer.set.fontStyle(this.trState,e)}get fontWeight(){return this.trState.props.fontWeight}set fontWeight(e){this.textRenderer.set.fontWeight(this.trState,e)}get textAlign(){return this.trState.props.textAlign}set textAlign(e){this.textRenderer.set.textAlign(this.trState,e)}get contain(){return this.trState.props.contain}set contain(e){this.textRenderer.set.contain(this.trState,e)}get scrollable(){return this.trState.props.scrollable}set scrollable(e){this.textRenderer.set.scrollable(this.trState,e)}get scrollY(){return this.trState.props.scrollY}set scrollY(e){this.textRenderer.set.scrollY(this.trState,e)}get offsetY(){return this.trState.props.offsetY}set offsetY(e){this.textRenderer.set.offsetY(this.trState,e)}get letterSpacing(){return this.trState.props.letterSpacing}set letterSpacing(e){this.textRenderer.set.letterSpacing(this.trState,e)}get lineHeight(){return this.trState.props.lineHeight}set lineHeight(e){this.textRenderer.set.lineHeight(this.trState,e)}get maxLines(){return this.trState.props.maxLines}set maxLines(e){this.textRenderer.set.maxLines(this.trState,e)}get textBaseline(){return this.trState.props.textBaseline}set textBaseline(e){this.textRenderer.set.textBaseline(this.trState,e)}get verticalAlign(){return this.trState.props.verticalAlign}set verticalAlign(e){this.textRenderer.set.verticalAlign(this.trState,e)}get overflowSuffix(){return this.trState.props.overflowSuffix}set overflowSuffix(e){this.textRenderer.set.overflowSuffix(this.trState,e)}get debug(){return this.trState.props.debug}set debug(e){this.textRenderer.set.debug(this.trState,e)}update(e,r){super.update(e,r),R(this.globalTransform),this.textRenderer.set.x(this.trState,this.globalTransform.tx),this.textRenderer.set.y(this.trState,this.globalTransform.ty)}checkBasicRenderability(){return this.worldAlpha===0||this.isOutOfBounds()===!0?!1:!!(this.trState&&this.trState.props.text!=="")}setRenderable(e){super.setRenderable(e),this.textRenderer.setIsRenderable(this.trState,e)}renderQuads(e){var r;if(R(this.globalTransform),!this.textRenderer.renderQuads){super.renderQuads(e);return}this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode)||(this.parentHasRenderTexture&&((r=this.props.parent)!=null&&r.rtt)&&(this.globalTransform=Q.identity(),this.localTransform&&this.globalTransform.multiply(this.localTransform)),R(this.globalTransform),this.textRenderer.renderQuads(this.trState,this.globalTransform,this.clippingRect,this.worldAlpha,this.parentHasRenderTexture,this.framebufferDimensions))}destroy(){super.destroy(),this.textRenderer.destroyState(this.trState)}createState(e){const r=this.textRenderer.createState(e,this);return r.emitter.on("loaded",this.onTextLoaded),r.emitter.on("failed",this.onTextFailed),this.textRenderer.scheduleUpdateState(r),r}}function wo(s){const t={boolean:!0,string:!0,number:!0,undefined:!0},e=Object.keys(s);for(let r=0;r<e.length;r++){const i=e[r];if(!i)continue;const n=s[i],o=typeof n;o==="string"&&n.length>2048&&(console.warn(`Custom Data value for ${i} is too long, it will be truncated to 2048 characters`),s[i]=n.substring(0,2048)),t[o]||(console.warn(`Custom Data value for ${i} is not a boolean, string, or number, it will be ignored`),delete s[i])}return s}const vo=2e6;class Co{constructor(t){f(this,"options");f(this,"animationManager");f(this,"txManager");f(this,"txMemManager");f(this,"fontManager");f(this,"textRenderers");f(this,"shManager");f(this,"renderer");f(this,"root");f(this,"boundsMargin");f(this,"defShaderCtr");f(this,"strictBound");f(this,"preloadBound");f(this,"strictBounds");f(this,"defaultTexture",null);f(this,"eventBus");f(this,"deltaTime",0);f(this,"lastFrameTime",0);f(this,"currentFrameTime",0);f(this,"fpsNumFrames",0);f(this,"fpsElapsedTime",0);f(this,"numQuadsRendered",0);f(this,"renderRequested",!1);f(this,"frameEventQueue",[]);f(this,"fontResolveMap",{});f(this,"contextSpy",null);this.options=t;const{canvas:e,clearColor:r,appWidth:i,appHeight:n,boundsMargin:o,enableContextSpy:l,forceWebGL2:a,numImageWorkers:c,textureMemory:u,renderEngine:d,fontEngines:h,createImageBitmapSupport:p}=t;this.eventBus=t.eventBus,this.txManager=new io(this,{numImageWorkers:c,createImageBitmapSupport:p}),this.txManager.on("initialized",()=>{this.requestRender()}),this.txMemManager=new bo(this,u),this.shManager=new xo,this.animationManager=new qn,this.contextSpy=l?new To:null,this.strictBounds=t.strictBounds;let g=[0,0,0,0];o&&(g=Array.isArray(o)?o:[o,o,o,o]),this.boundsMargin=g,this.strictBound=ft(0,0,i,n),this.preloadBound=ls(this.strictBound,g);const x={stage:this,canvas:e,pixelRatio:t.devicePhysicalPixelRatio*t.deviceLogicalPixelRatio,clearColor:r??4278190080,bufferMemory:vo,txManager:this.txManager,txMemManager:this.txMemManager,shManager:this.shManager,contextSpy:this.contextSpy,forceWebGL2:a};this.renderer=new d(x);const T=this.renderer.mode||"webgl";this.createDefaultTexture(),this.defShaderCtr=this.renderer.getDefShaderCtr(),Bn(T),this.txManager.renderer=this.renderer,this.textRenderers={},h.forEach(S=>{const v=new S(this),C=v.type;if(C==="sdf"&&T==="canvas"){console.warn("SdfTextRenderer is not compatible with Canvas renderer. Skipping...");return}v instanceof _s&&(C==="canvas"?this.textRenderers.canvas=v:C==="sdf"&&(this.textRenderers.sdf=v))}),Object.keys(this.textRenderers).length===0&&console.warn("No text renderers available. Your text will not render."),this.fontManager=new ao(this.textRenderers);const y=new fs(this,{x:0,y:0,width:i,height:n,alpha:1,autosize:!1,boundsMargin:null,clipping:!1,color:0,colorTop:0,colorBottom:0,colorLeft:0,colorRight:0,colorTl:0,colorTr:0,colorBl:0,colorBr:0,zIndex:0,zIndexLocked:0,scaleX:1,scaleY:1,mountX:0,mountY:0,mount:0,pivot:.5,pivotX:.5,pivotY:.5,rotation:0,parent:null,texture:null,textureOptions:{},shader:this.defShaderCtr,rtt:!1,src:null,scale:1,preventCleanup:!1,strictBounds:this.strictBounds});this.root=y,jn(this)}setClearColor(t){this.renderer.updateClearColor(t),this.renderRequested=!0}updateFrameTime(){const t=Ye();this.lastFrameTime=this.currentFrameTime,this.currentFrameTime=t,this.deltaTime=this.lastFrameTime?t-this.lastFrameTime:100/6,this.txManager.frameTime=t,this.txMemManager.frameTime=t,this.eventBus.emit("frameTick",{time:this.currentFrameTime,delta:this.deltaTime})}createDefaultTexture(){console.log("Creating default texture"),this.defaultTexture=this.txManager.createTexture("ColorTexture",{color:4294967295}),R(this.defaultTexture instanceof Br),this.txManager.loadTexture(this.defaultTexture,!0),this.defaultTexture.setRenderableOwner(this,!0),this.defaultTexture.once("loaded",()=>{this.requestRender()})}updateAnimations(){const{animationManager:t}=this;this.root&&t.update(this.deltaTime)}hasSceneUpdates(){return!!this.root.updateType||this.renderRequested||this.txManager.hasUpdates()}drawFrame(){const{renderer:t,renderRequested:e}=this;R(t),this.root.updateType!==0&&this.root.update(this.deltaTime,this.root.clippingRect),this.txManager.processSome(this.options.textureProcessingTimeLimit),t.reset(),this.txMemManager.criticalCleanupRequested===!0&&(this.txMemManager.cleanup(!1),this.txMemManager.criticalCleanupRequested===!0&&this.txMemManager.cleanup(!0)),t.rttNodes.length>0&&t.renderRTTNodes(),this.addQuads(this.root),t==null||t.render(),this.calculateFps(),this.calculateQuads(),e&&(this.renderRequested=!1)}queueFrameEvent(t,e){this.frameEventQueue.push([t,e])}flushFrameEvents(){for(const[t,e]of this.frameEventQueue)this.eventBus.emit(t,e);this.frameEventQueue=[]}calculateFps(){var e,r;const{fpsUpdateInterval:t}=this.options;if(t&&(this.fpsNumFrames++,this.fpsElapsedTime+=this.deltaTime,this.fpsElapsedTime>=t)){const i=Math.round(this.fpsNumFrames*1e3/this.fpsElapsedTime);this.fpsNumFrames=0,this.fpsElapsedTime=0,this.queueFrameEvent("fpsUpdate",{fps:i,contextSpyData:((e=this.contextSpy)==null?void 0:e.getData())??null}),(r=this.contextSpy)==null||r.reset()}}calculateQuads(){const t=this.renderer.getQuadCount();t&&t!==this.numQuadsRendered&&(this.numQuadsRendered=t,this.queueFrameEvent("quadsUpdate",{quads:t}))}addQuads(t){R(this.renderer),t.isRenderable===!0&&t.renderQuads(this.renderer);for(let e=0;e<t.children.length;e++){const r=t.children[e];r!==void 0&&(r.worldAlpha===0||r.strictBounds===!0&&r.renderState===Z.OutOfBounds||this.addQuads(r))}}requestRender(){this.renderRequested=!0}resolveTextRenderer(t,e=null){const r=`${t.fontFamily}${t.fontStyle}${t.fontWeight}${t.fontStretch}${e||""}`;if(this.fontResolveMap[r]!==void 0)return this.fontResolveMap[r];let i=e,n=!1;if(i){const l=this.textRenderers[i];l?l.canRenderFont(t)||(console.warn(`Cannot use override text renderer '${i}' for font`,t),i=null,n=!0):(console.warn(`Text renderer override '${i}' not found.`),i=null,n=!0)}if(!i){for(const[l,a]of Object.entries(this.textRenderers))if(a.canRenderFont(t)){i=l;break}!i&&this.textRenderers.canvas!==void 0&&(i="canvas")}if(n&&console.warn(`Falling back to text renderer ${String(i)}`),!i)return null;const o=this.textRenderers[i];return R(o,"resolvedTextRenderer undefined"),this.fontResolveMap[r]=o,o}createShaderCtr(t,e){return this.shManager.loadShader(t,e)}createNode(t){const e=this.resolveNodeDefaults(t);return new fs(this,e)}createTextNode(t){const e=t.fontSize??16,r={...this.resolveNodeDefaults(t),text:t.text??"",textRendererOverride:t.textRendererOverride??null,fontSize:e,fontFamily:t.fontFamily??"sans-serif",fontStyle:t.fontStyle??"normal",fontWeight:t.fontWeight??"normal",fontStretch:t.fontStretch??"normal",textAlign:t.textAlign??"left",contain:t.contain??"none",scrollable:t.scrollable??!1,scrollY:t.scrollY??0,offsetY:t.offsetY??0,letterSpacing:t.letterSpacing??0,lineHeight:t.lineHeight,maxLines:t.maxLines??0,textBaseline:t.textBaseline??"alphabetic",verticalAlign:t.verticalAlign??"middle",overflowSuffix:t.overflowSuffix??"...",debug:t.debug??{},shaderProps:null},i=this.resolveTextRenderer(r,t.textRendererOverride);if(!i)throw new Error(`No compatible text renderer found for ${r.fontFamily}`);return new So(this,r,i)}setBoundsMargin(t){this.boundsMargin=Array.isArray(t)?t:[t,t,t,t],this.root.setUpdateType(b.RenderBounds)}resolveNodeDefaults(t){const e=t.color??4294967295,r=t.colorTl??t.colorTop??t.colorLeft??e,i=t.colorTr??t.colorTop??t.colorRight??e,n=t.colorBl??t.colorBottom??t.colorLeft??e,o=t.colorBr??t.colorBottom??t.colorRight??e;let l={};return this.options.inspector===!0&&(l=wo(t.data??{})),{x:t.x??0,y:t.y??0,width:t.width??0,height:t.height??0,alpha:t.alpha??1,autosize:t.autosize??!1,boundsMargin:t.boundsMargin??null,clipping:t.clipping??!1,color:e,colorTop:t.colorTop??e,colorBottom:t.colorBottom??e,colorLeft:t.colorLeft??e,colorRight:t.colorRight??e,colorBl:n,colorBr:o,colorTl:r,colorTr:i,zIndex:t.zIndex??0,zIndexLocked:t.zIndexLocked??0,parent:t.parent??null,texture:t.texture??null,textureOptions:t.textureOptions??{},shader:t.shader??this.defShaderCtr,src:t.src??null,srcHeight:t.srcHeight,srcWidth:t.srcWidth,srcX:t.srcX,srcY:t.srcY,scale:t.scale??null,scaleX:t.scaleX??t.scale??1,scaleY:t.scaleY??t.scale??1,mount:t.mount??0,mountX:t.mountX??t.mount??0,mountY:t.mountY??t.mount??0,pivot:t.pivot??.5,pivotX:t.pivotX??t.pivot??.5,pivotY:t.pivotY??t.pivot??.5,rotation:t.rotation??0,rtt:t.rtt??!1,data:l,preventCleanup:t.preventCleanup??!1,imageType:t.imageType,strictBounds:t.strictBounds??this.strictBounds}}cleanup(t){this.txMemManager.cleanup(t)}}class Ro extends xe{constructor(e,r){var x,T,y,S,v,C;super();f(this,"root");f(this,"canvas");f(this,"settings");f(this,"stage");f(this,"inspector",null);const i={criticalThreshold:((x=e.textureMemory)==null?void 0:x.criticalThreshold)||124e6,targetThresholdLevel:((T=e.textureMemory)==null?void 0:T.targetThresholdLevel)||.5,cleanupInterval:((y=e.textureMemory)==null?void 0:y.cleanupInterval)||5e3,debugLogging:((S=e.textureMemory)==null?void 0:S.debugLogging)||!1,baselineMemoryAllocation:((v=e.textureMemory)==null?void 0:v.baselineMemoryAllocation)||26e6,doNotExceedCriticalThreshold:((C=e.textureMemory)==null?void 0:C.doNotExceedCriticalThreshold)||!1},n={appWidth:e.appWidth||1920,appHeight:e.appHeight||1080,textureMemory:i,boundsMargin:e.boundsMargin||0,deviceLogicalPixelRatio:e.deviceLogicalPixelRatio||1,devicePhysicalPixelRatio:e.devicePhysicalPixelRatio||window.devicePixelRatio,clearColor:e.clearColor??0,fpsUpdateInterval:e.fpsUpdateInterval||0,numImageWorkers:e.numImageWorkers!==void 0?e.numImageWorkers:2,enableContextSpy:e.enableContextSpy??!1,forceWebGL2:e.forceWebGL2??!1,inspector:e.inspector??!1,renderEngine:e.renderEngine,quadBufferSize:e.quadBufferSize??4*1024*1024,fontEngines:e.fontEngines,strictBounds:e.strictBounds??!0,textureProcessingTimeLimit:e.textureProcessingTimeLimit||10,canvas:e.canvas||document.createElement("canvas"),createImageBitmapSupport:e.createImageBitmapSupport||"full"};this.settings=n;const{appWidth:o,appHeight:l,deviceLogicalPixelRatio:a,devicePhysicalPixelRatio:c,inspector:u,canvas:d}=n,h=o*a,p=l*a;this.canvas=d,d.width=h*c,d.height=p*c,d.style.width=`${h}px`,d.style.height=`${p}px`,this.stage=new Co({appWidth:this.settings.appWidth,appHeight:this.settings.appHeight,boundsMargin:this.settings.boundsMargin,clearColor:this.settings.clearColor,canvas:this.canvas,deviceLogicalPixelRatio:this.settings.deviceLogicalPixelRatio,devicePhysicalPixelRatio:this.settings.devicePhysicalPixelRatio,enableContextSpy:this.settings.enableContextSpy,forceWebGL2:this.settings.forceWebGL2,fpsUpdateInterval:this.settings.fpsUpdateInterval,numImageWorkers:this.settings.numImageWorkers,renderEngine:this.settings.renderEngine,textureMemory:i,eventBus:this,quadBufferSize:this.settings.quadBufferSize,fontEngines:this.settings.fontEngines,inspector:this.settings.inspector!==null,strictBounds:this.settings.strictBounds,textureProcessingTimeLimit:this.settings.textureProcessingTimeLimit,createImageBitmapSupport:this.settings.createImageBitmapSupport}),this.root=this.stage.root;let g;if(typeof r=="string"?g=document.getElementById(r):g=r,!g)throw new Error("Could not find target element");g.appendChild(d),u&&!Tt()&&(this.inspector=new u(d,n))}createNode(e){const r=this.stage.createNode(e);return this.inspector?this.inspector.createNode(r):r}createTextNode(e){const r=this.stage.createTextNode(e);return this.inspector?this.inspector.createTextNode(r):r}destroyNode(e){return this.inspector&&this.inspector.destroyNode(e.id),e.destroy()}createTexture(e,r){return this.stage.txManager.createTexture(e,r)}createShader(e,r){return this.stage.shManager.loadShader(e,r)}createDynamicShader(e){return this.stage.shManager.loadDynamicShader({effects:e})}createEffect(e,r,i){return{name:i,type:e,props:r}}getNodeById(e){var n;const r=(n=this.stage)==null?void 0:n.root;if(!r)return null;const i=o=>{if(o.id===e)return o;for(const l of o.children){const a=i(l);if(a)return a}return null};return i(r)}toggleFreeze(){throw new Error("Not implemented")}advanceFrame(){throw new Error("Not implemented")}getBufferInfo(){return this.stage.renderer.getBufferInfo()}rerender(){this.stage.requestRender()}cleanup(e=!1){this.stage.cleanup(e)}setClearColor(e){this.stage.setClearColor(e)}}class Ci extends xe{constructor(e){super();f(this,"fontFamily");f(this,"descriptors");f(this,"loaded",!1);f(this,"metrics",null);const{fontFamily:r,descriptors:i,metrics:n}=e;n&&(this.metrics={ascender:n.ascender/n.unitsPerEm,descender:n.descender/n.unitsPerEm,lineGap:n.lineGap/n.unitsPerEm}),this.fontFamily=r,this.descriptors={style:"normal",weight:"normal",stretch:"normal",...i}}static convertToCssFontFaceDescriptors(e){return{style:e.style,weight:typeof e.weight=="number"?`${e.weight}`:e.weight,stretch:e.stretch,unicodeRange:e.unicodeRange,featureSettings:e.featureSettings,display:e.display}}}class Rr extends Ci{constructor(e){super(e);f(this,"fontFace");f(this,"fontUrl");const{fontFamily:r,fontUrl:i}=e,n=i.replace(/\(|\)/g,""),o=this.descriptors;let l={style:o.style,weight:typeof o.weight=="number"?`${o.weight}`:o.weight,stretch:o.stretch,unicodeRange:o.unicodeRange,featureSettings:o.featureSettings,display:o.display};for(const c in l){const u=c;l[u]===void 0&&delete l[u]}const a=new FontFace(r,`url(${n})`,l);n.length>0?a.load().then(()=>{this.loaded=!0,this.emit("loaded")}).catch(console.error):(this.loaded=!0,this.emit("loaded")),this.fontFace=a,this.fontUrl=i}}class _o{}class Ri extends _o{constructor(e,r,i,n,o,l,a,c,u,d,h,p,g){super();f(this,"glw");f(this,"options");f(this,"buffers");f(this,"shader");f(this,"shaderProps");f(this,"alpha");f(this,"clippingRect");f(this,"dimensions");f(this,"bufferIdx");f(this,"zIndex");f(this,"renderToTexture");f(this,"parentHasRenderTexture");f(this,"framebufferDimensions");f(this,"length",0);f(this,"numQuads",0);f(this,"textures",[]);f(this,"maxTextures");this.glw=e,this.options=r,this.buffers=i,this.shader=n,this.shaderProps=o,this.alpha=l,this.clippingRect=a,this.dimensions=c,this.bufferIdx=u,this.zIndex=d,this.renderToTexture=h,this.parentHasRenderTexture=p,this.framebufferDimensions=g,this.maxTextures=n.supportsIndexedTextures?e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(e){const{textures:r,maxTextures:i}=this;let n=-1;const o=r.length;for(let l=0;l<o;l++)if(r[l]===e){n=l;break}return n!==-1?n:o>=i?4294967295:(this.textures.push(e),o)}draw(){const{glw:e,shader:r,shaderProps:i,options:n}=this,{shManager:o}=n;o.useShader(r),r.bindRenderOp(this,i);const l=this.bufferIdx/24*6*2;if(this.clippingRect.valid){const{x:a,y:c,width:u,height:d}=this.clippingRect,h=this.parentHasRenderTexture?1:n.pixelRatio,p=n.canvas.height,g=Math.round(a*h),x=Math.round(u*h),T=Math.round(d*h);let y=Math.round(p-T-c*h);this.parentHasRenderTexture&&(y=this.framebufferDimensions?this.framebufferDimensions.height-this.dimensions.height:0),e.setScissorTest(!0),e.scissor(g,y,x,T)}else e.setScissorTest(!1);e.drawElements(e.TRIANGLES,6*this.numQuads,e.UNSIGNED_SHORT,l)}}function Eo(s){const t={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(t).forEach(r=>{t[r]=s.getParameter(s[r])}),t}function Ao(s){const t={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(t).forEach(r=>{t[r]=s.getExtension(r)}),t}function Mo(s,t){const e=~~(t/80),r=new Uint16Array(e*6);for(let n=0,o=0;n<e;n+=6,o+=4)r[n]=o,r[n+1]=o+1,r[n+2]=o+2,r[n+3]=o+2,r[n+4]=o+1,r[n+5]=o+3;const i=s.createBuffer();s.elementArrayBufferData(i,r,s.STATIC_DRAW)}function Io(s){return s!==null&&(typeof s=="object"&&s.constructor&&s.constructor.name==="HTMLImageElement"||typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement)}const Jr=new Uint8Array([0,0,0,0]);class Fr extends wi{constructor(e,r,i){super(r,i);f(this,"glw");f(this,"_nativeCtxTexture",null);f(this,"_w",0);f(this,"_h",0);this.glw=e}get ctxTexture(){return this.state==="freed"?(this.load(),null):(R(this._nativeCtxTexture),this._nativeCtxTexture)}get w(){return this._w}get h(){return this._h}load(){if(!(this.state==="loading"||this.state==="loaded")){if(this.state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this._nativeCtxTexture===null){this.state="failed",this.textureSource.setState("failed",new Error("Could not create WebGL Texture")),console.error("Could not create WebGL Texture");return}this.onLoadRequest().then(({width:e,height:r})=>{this.state!=="freed"&&(this.state="loaded",this._w=e,this._h=r,this.textureSource.setState("loaded",{width:e,height:r}),this.textureSource.freeTextureData())}).catch(e=>{this.state!=="freed"&&(this.state="failed",this.textureSource.setState("failed",e),this.textureSource.freeTextureData(),console.error(e))})}}async onLoadRequest(){const{glw:e}=this,r=this.textureSource.textureData;if(r===null||this._nativeCtxTexture===null)throw new Error("Texture data or native texture is null "+this.textureSource.type);e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),this.setTextureMemUse(Jr.byteLength);let i=0,n=0;e.activeTexture(0);const o=r.data,l=e.RGBA,a=4,c=1.1;if(typeof ImageBitmap<"u"&&o instanceof ImageBitmap||o instanceof ImageData||Io(o))i=o.width,n=o.height,e.bindTexture(this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!r.premultiplyAlpha),e.texImage2D(0,l,l,e.UNSIGNED_BYTE,o),this.setTextureMemUse(n*i*a*c);else if(o===null)i=0,n=0,e.bindTexture(this._nativeCtxTexture),e.texImage2D(0,l,1,1,0,l,e.UNSIGNED_BYTE,Jr),this.setTextureMemUse(Jr.byteLength);else if("mipmaps"in o&&o.mipmaps){const{mipmaps:u,width:d=0,height:h=0,type:p,glInternalFormat:g}=o,x=p==="ktx"?new DataView(u[0]??new ArrayBuffer(0)):u[0];e.bindTexture(this._nativeCtxTexture),e.compressedTexImage2D(0,g,d,h,0,x),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),this.setTextureMemUse(x.byteLength)}else o&&o instanceof Uint8Array?(i=1,n=1,e.bindTexture(this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!r.premultiplyAlpha),e.texImage2D(0,l,i,n,0,l,e.UNSIGNED_BYTE,o),this.setTextureMemUse(i*n*a)):console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",r);return{width:i,height:n}}free(){this.state!=="freed"&&(this.state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,this._nativeCtxTexture!==null&&(this.glw.deleteTexture(this._nativeCtxTexture),this.setTextureMemUse(0),this._nativeCtxTexture=null),this.textureSource.freeTextureData())}createNativeCtxTexture(){const{glw:e}=this,r=e.createTexture();return r?(e.activeTexture(0),e.bindTexture(r),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r):null}}class Lo extends Fr{constructor(t,e,r){super(t,e,r)}async onLoadRequest(){var e,r;const t=this.textureSource.textureData;return R(t,"SubTexture must have texture data"),t.data instanceof Uint8Array?{width:1,height:1}:{width:((e=t.data)==null?void 0:e.width)||0,height:((r=t.data)==null?void 0:r.height)||0}}}class _i{constructor(t){f(this,"config");this.config=t}getBuffer(t){var e;return(e=this.config.find(r=>r.attributes[t]))==null?void 0:e.buffer}getAttributeInfo(t){var e;return(e=this.config.find(r=>r.attributes[t]))==null?void 0:e.attributes[t]}}function Po(s){return self.WebGL2RenderingContext&&s instanceof self.WebGL2RenderingContext}class Bo{constructor(t){f(this,"gl");f(this,"activeTextureUnit",0);f(this,"texture2dUnits");f(this,"texture2dParams",new WeakMap);f(this,"scissorEnabled");f(this,"scissorX");f(this,"scissorY");f(this,"scissorWidth");f(this,"scissorHeight");f(this,"blendEnabled");f(this,"blendSrcRgb");f(this,"blendDstRgb");f(this,"blendSrcAlpha");f(this,"blendDstAlpha");f(this,"boundArrayBuffer");f(this,"boundElementArrayBuffer");f(this,"curProgram");f(this,"canvas");f(this,"MAX_RENDERBUFFER_SIZE");f(this,"MAX_TEXTURE_SIZE");f(this,"MAX_VIEWPORT_DIMS");f(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS");f(this,"MAX_TEXTURE_IMAGE_UNITS");f(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS");f(this,"MAX_VERTEX_ATTRIBS");f(this,"MAX_VARYING_VECTORS");f(this,"MAX_VERTEX_UNIFORM_VECTORS");f(this,"MAX_FRAGMENT_UNIFORM_VECTORS");f(this,"TEXTURE_MAG_FILTER");f(this,"TEXTURE_MIN_FILTER");f(this,"TEXTURE_WRAP_S");f(this,"TEXTURE_WRAP_T");f(this,"LINEAR");f(this,"CLAMP_TO_EDGE");f(this,"RGB");f(this,"RGBA");f(this,"UNSIGNED_BYTE");f(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL");f(this,"UNPACK_FLIP_Y_WEBGL");f(this,"FLOAT");f(this,"TRIANGLES");f(this,"UNSIGNED_SHORT");f(this,"ONE");f(this,"ONE_MINUS_SRC_ALPHA");f(this,"VERTEX_SHADER");f(this,"FRAGMENT_SHADER");f(this,"STATIC_DRAW");f(this,"COMPILE_STATUS");f(this,"LINK_STATUS");f(this,"DYNAMIC_DRAW");f(this,"COLOR_ATTACHMENT0");f(this,"INVALID_ENUM");f(this,"INVALID_OPERATION");this.gl=t,this.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0;const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(e).fill(void 0).map((i,n)=>(this.activeTexture(n),t.getParameter(t.TEXTURE_BINDING_2D))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=t.isEnabled(t.SCISSOR_TEST);const r=t.getParameter(t.SCISSOR_BOX);this.scissorX=r[0],this.scissorY=r[1],this.scissorWidth=r[2],this.scissorHeight=r[3],this.blendEnabled=t.isEnabled(t.BLEND),this.blendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),this.blendDstRgb=t.getParameter(t.BLEND_DST_RGB),this.blendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),this.blendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),this.boundArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=t.getParameter(t.CURRENT_PROGRAM),this.canvas=t.canvas,this.MAX_RENDERBUFFER_SIZE=t.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=t.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=t.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=t.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=t.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=t.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=t.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=t.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=t.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=t.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=t.TEXTURE_WRAP_T,this.LINEAR=t.LINEAR,this.CLAMP_TO_EDGE=t.CLAMP_TO_EDGE,this.RGB=t.RGB,this.RGBA=t.RGBA,this.UNSIGNED_BYTE=t.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.UNPACK_FLIP_Y_WEBGL=t.UNPACK_FLIP_Y_WEBGL,this.FLOAT=t.FLOAT,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.ONE=t.ONE,this.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.VERTEX_SHADER=t.VERTEX_SHADER,this.FRAGMENT_SHADER=t.FRAGMENT_SHADER,this.STATIC_DRAW=t.STATIC_DRAW,this.COMPILE_STATUS=t.COMPILE_STATUS,this.LINK_STATUS=t.LINK_STATUS,this.DYNAMIC_DRAW=t.DYNAMIC_DRAW,this.COLOR_ATTACHMENT0=t.COLOR_ATTACHMENT0,this.INVALID_ENUM=t.INVALID_ENUM,this.INVALID_OPERATION=t.INVALID_OPERATION}isWebGl2(){return Po(this.gl)}activeTexture(t){const{gl:e}=this;this.activeTextureUnit!==t&&(e.activeTexture(t+e.TEXTURE0),this.activeTextureUnit=t)}bindTexture(t){const{gl:e,activeTextureUnit:r,texture2dUnits:i}=this;i[r]!==t&&(i[r]=t,e.bindTexture(this.gl.TEXTURE_2D,t))}_getActiveTexture(){const{activeTextureUnit:t,texture2dUnits:e}=this;return e[t]}texParameteri(t,e){const{gl:r,texture2dParams:i}=this,n=this._getActiveTexture();if(!n)throw new Error("No active texture");let o=i.get(n);o||(o={},i.set(n,o)),o[t]!==e&&(o[t]=e,r.texParameteri(r.TEXTURE_2D,t,e))}texImage2D(t,e,r,i,n,o,l,a){const{gl:c}=this;o?c.texImage2D(c.TEXTURE_2D,t,e,r,i,n,o,l,a):c.texImage2D(c.TEXTURE_2D,t,e,r,i,n)}compressedTexImage2D(t,e,r,i,n,o){const{gl:l}=this;l.compressedTexImage2D(l.TEXTURE_2D,t,e,r,i,n,o)}pixelStorei(t,e){const{gl:r}=this;r.pixelStorei(t,e)}generateMipmap(){const{gl:t}=this;t.generateMipmap(t.TEXTURE_2D)}createTexture(){const{gl:t}=this;return t.createTexture()}deleteTexture(t){const{gl:e}=this;t&&this.texture2dParams.delete(t),e.deleteTexture(t)}deleteFramebuffer(t){this.gl.deleteFramebuffer(t)}viewport(t,e,r,i){const{gl:n}=this;n.viewport(t,e,r,i)}clearColor(t,e,r,i){const{gl:n}=this;n.clearColor(t,e,r,i)}setScissorTest(t){const{gl:e,scissorEnabled:r}=this;t!==r&&(t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.scissorEnabled=t)}scissor(t,e,r,i){const{gl:n,scissorX:o,scissorY:l,scissorWidth:a,scissorHeight:c}=this;(t!==o||e!==l||r!==a||i!==c)&&(n.scissor(t,e,r,i),this.scissorX=t,this.scissorY=e,this.scissorWidth=r,this.scissorHeight=i)}setBlend(t){const{gl:e,blendEnabled:r}=this;t!==r&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this.blendEnabled=t)}blendFunc(t,e){const{gl:r,blendSrcRgb:i,blendDstRgb:n,blendSrcAlpha:o,blendDstAlpha:l}=this;(t!==i||e!==n||t!==o||e!==l)&&(r.blendFunc(t,e),this.blendSrcRgb=t,this.blendDstRgb=e,this.blendSrcAlpha=t,this.blendDstAlpha=e)}createBuffer(){const{gl:t}=this;return t.createBuffer()}createFramebuffer(){const{gl:t}=this;return t.createFramebuffer()}bindFramebuffer(t){const{gl:e}=this;e.bindFramebuffer(e.FRAMEBUFFER,t)}framebufferTexture2D(t,e,r){const{gl:i}=this;i.framebufferTexture2D(i.FRAMEBUFFER,t,i.TEXTURE_2D,e,r)}clear(){const{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)}arrayBufferData(t,e,r){const{gl:i,boundArrayBuffer:n}=this;n!==t&&(i.bindBuffer(i.ARRAY_BUFFER,t),this.boundArrayBuffer=t),i.bufferData(i.ARRAY_BUFFER,e,r)}elementArrayBufferData(t,e,r){const{gl:i,boundElementArrayBuffer:n}=this;n!==t&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.boundElementArrayBuffer=t),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,r)}vertexAttribPointer(t,e,r,i,n,o,l){const{gl:a,boundArrayBuffer:c}=this;c!==t&&(a.bindBuffer(a.ARRAY_BUFFER,t),this.boundArrayBuffer=t),a.vertexAttribPointer(e,r,i,n,o,l)}useProgram(t){const{gl:e,curProgram:r}=this;r!==t&&(e.useProgram(t),this.curProgram=t)}uniform1f(t,e){const{gl:r}=this;r.uniform1f(t,e)}uniform1fv(t,e){const{gl:r}=this;r.uniform1fv(t,e)}uniform1i(t,e){const{gl:r}=this;r.uniform1i(t,e)}uniform1iv(t,e){const{gl:r}=this;r.uniform1iv(t,e)}uniform2f(t,e,r){const{gl:i}=this;i.uniform2f(t,e,r)}uniform2fv(t,e){const{gl:r}=this;r.uniform2fv(t,e)}uniform2i(t,e,r){const{gl:i}=this;i.uniform2i(t,e,r)}uniform2iv(t,e){const{gl:r}=this;r.uniform2iv(t,e)}uniform3f(t,e,r,i){const{gl:n}=this;n.uniform3f(t,e,r,i)}uniform3fv(t,e){const{gl:r}=this;r.uniform3fv(t,e)}uniform3i(t,e,r,i){const{gl:n}=this;n.uniform3i(t,e,r,i)}uniform3iv(t,e){const{gl:r}=this;r.uniform3iv(t,e)}uniform4f(t,e,r,i,n){const{gl:o}=this;o.uniform4f(t,e,r,i,n)}uniform4fv(t,e){const{gl:r}=this;r.uniform4fv(t,e)}uniform4i(t,e,r,i,n){const{gl:o}=this;o.uniform4i(t,e,r,i,n)}uniform4iv(t,e){const{gl:r}=this;r.uniform4iv(t,e)}uniformMatrix2fv(t,e){const{gl:r}=this;r.uniformMatrix2fv(t,!1,e)}uniformMatrix3fv(t,e){const{gl:r}=this;r.uniformMatrix3fv(t,!1,e)}uniformMatrix4fv(t,e){const{gl:r}=this;r.uniformMatrix4fv(t,!1,e)}getParameter(t){const{gl:e}=this;return e.getParameter(t)}drawElements(t,e,r,i){const{gl:n}=this;n.drawElements(t,e,r,i)}getExtension(t){const{gl:e}=this;return e.getExtension(t)}getError(){const{gl:t}=this;return t.getError()}createVertexArray(){const{gl:t}=this;return R(t instanceof WebGL2RenderingContext),t.createVertexArray()}bindVertexArray(t){const{gl:e}=this;R(e instanceof WebGL2RenderingContext),e.bindVertexArray(t)}getAttribLocation(t,e){const{gl:r}=this;return r.getAttribLocation(t,e)}getUniformLocation(t,e){const{gl:r}=this;return r.getUniformLocation(t,e)}enableVertexAttribArray(t){const{gl:e}=this;e.enableVertexAttribArray(t)}disableVertexAttribArray(t){const{gl:e}=this;e.disableVertexAttribArray(t)}createShader(t){const{gl:e}=this;return e.createShader(t)}compileShader(t){const{gl:e}=this;e.compileShader(t)}attachShader(t,e){const{gl:r}=this;r.attachShader(t,e)}linkProgram(t){const{gl:e}=this;e.linkProgram(t)}deleteProgram(t){const{gl:e}=this;e.deleteProgram(t)}getShaderParameter(t,e){const{gl:r}=this;return r.getShaderParameter(t,e)}getShaderInfoLog(t){const{gl:e}=this;return e.getShaderInfoLog(t)}createProgram(){const{gl:t}=this;return t.createProgram()}getProgramParameter(t,e){const{gl:r}=this;return r.getProgramParameter(t,e)}getProgramInfoLog(t){const{gl:e}=this;return e.getProgramInfoLog(t)}shaderSource(t,e){const{gl:r}=this;r.shaderSource(t,e)}deleteShader(t){const{gl:e}=this;e.deleteShader(t)}}class Vs extends Fr{constructor(e,r,i){super(e,r,i);f(this,"framebuffer",null)}async onLoadRequest(){const{glw:e}=this,r=this._nativeCtxTexture=this.createNativeCtxTexture(),{width:i,height:n}=this.textureSource;return this.framebuffer=e.createFramebuffer(),e.texImage2D(0,e.RGBA,i,n,0,e.RGBA,e.UNSIGNED_BYTE,null),this.setTextureMemUse(i*n*4),e.bindFramebuffer(this.framebuffer),e.framebufferTexture2D(e.COLOR_ATTACHMENT0,r,0),e.bindFramebuffer(null),{width:i,height:n}}free(){super.free(),this.glw.deleteFramebuffer(this.framebuffer),this.framebuffer=null}}const ko=24;class Es extends vi{constructor(e){super(e);f(this,"glw");f(this,"system");f(this,"quadBuffer");f(this,"fQuadBuffer");f(this,"uiQuadBuffer");f(this,"renderOps",[]);f(this,"curBufferIdx",0);f(this,"curRenderOp",null);f(this,"rttNodes",[]);f(this,"activeRttNode",null);f(this,"defShaderCtrl");f(this,"defaultShader");f(this,"quadBufferCollection");f(this,"clearColor",{raw:0,normalized:[0,0,0,0]});f(this,"quadBufferUsage",0);f(this,"numQuadsRendered",0);f(this,"renderToTextureActive",!1);this.quadBuffer=new ArrayBuffer(this.stage.options.quadBufferSize),this.fQuadBuffer=new Float32Array(this.quadBuffer),this.uiQuadBuffer=new Uint32Array(this.quadBuffer),this.mode="webgl";const{canvas:r,clearColor:i,bufferMemory:n}=e,o=Ln(r,e.forceWebGL2,e.contextSpy),l=this.glw=new Bo(o);l.viewport(0,0,r.width,r.height),this.updateClearColor(i),l.setBlend(!0),l.blendFunc(l.ONE,l.ONE_MINUS_SRC_ALPHA),Mo(l,n),this.system={parameters:Eo(this.glw),extensions:Ao(this.glw)},this.shManager.renderer=this,this.defShaderCtrl=this.shManager.loadShader("DefaultShader"),this.defaultShader=this.defShaderCtrl.shader;const a=l.createBuffer();R(a);const c=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new _i([{buffer:a,attributes:{a_position:{name:"a_position",size:2,type:l.FLOAT,normalized:!1,stride:c,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:l.FLOAT,normalized:!1,stride:c,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:l.UNSIGNED_BYTE,normalized:!0,stride:c,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:l.FLOAT,normalized:!1,stride:c,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){const{glw:e}=this;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,e.setScissorTest(!1),e.clear()}getShaderManager(){return this.shManager}createCtxTexture(e){return e instanceof kt?new Lo(this.glw,this.txMemManager,e):e instanceof kr?new Vs(this.glw,this.txMemManager,e):new Fr(this.glw,this.txMemManager,e)}addQuad(e){const{fQuadBuffer:r,uiQuadBuffer:i}=this;let n=e.texture;if(R(n!==null,"Texture is required"),e.shaderProps!==null){if(Pr(e.shaderProps,"$dimensions")==!0){const y=e.shaderProps.$dimensions;y.width=e.width,y.height=e.height}Pr(e.shaderProps,"$alpha")===!0&&(e.shaderProps.$alpha=e.alpha)}let{curBufferIdx:o,curRenderOp:l}=this;const a={width:-1,height:-1};a.width=e.width,a.height=e.height;const c=e.shader||this.defaultShader;R(c.getUniformLocation!==void 0,"Invalid WebGL shader"),this.reuseRenderOp(e)===!1&&(this.newRenderOp(c,e.shaderProps,e.alpha,a,e.clippingRect,o,e.rtt,e.parentHasRenderTexture,e.framebufferDimensions),l=this.curRenderOp,R(l));let u=0,d=0,h=1,p=1;if(n.type===H.subTexture){const{x:y,y:S,width:v,height:C}=n.props,{width:$=0,height:A=0}=n.parentTexture.dimensions||{width:0,height:0};u=y/$,h=u+v/$,d=S/A,p=d+C/A,n=n.parentTexture}if(n.type===H.image&&e.textureOptions!==null&&e.textureOptions.resizeMode!==void 0&&n.dimensions!==null){const y=e.textureOptions.resizeMode,{width:S,height:v}=n.dimensions;if(y.type==="cover"){const C=e.width/S,$=e.height/v,A=Math.max(C,$),M=1/A;if(A&&C&&C<A){const L=M*e.width;u=(1-L/S)*(y.clipX??.5),h=u+L/S}if(A&&$&&$<A){const L=M*e.height;d=(1-L/v)*(y.clipY??.5),p=d+L/v}}}let g=0;e.textureOptions!==null&&(e.textureOptions.flipX===!0&&([u,h]=[h,u]),g=+(e.textureOptions.flipY||!1)),g^+(n.type===H.renderToTexture)&&([d,p]=[p,d]);const x=n.ctxTexture;R(x instanceof Fr);const T=this.addTexture(x,o);if(R(this.curRenderOp!==null),e.renderCoords)r[o++]=e.renderCoords.x1,r[o++]=e.renderCoords.y1,r[o++]=u,r[o++]=d,i[o++]=e.colorTl,r[o++]=T,r[o++]=e.renderCoords.x2,r[o++]=e.renderCoords.y2,r[o++]=h,r[o++]=d,i[o++]=e.colorTr,r[o++]=T,r[o++]=e.renderCoords.x4,r[o++]=e.renderCoords.y4,r[o++]=u,r[o++]=p,i[o++]=e.colorBl,r[o++]=T,r[o++]=e.renderCoords.x3,r[o++]=e.renderCoords.y3,r[o++]=h,r[o++]=p,i[o++]=e.colorBr,r[o++]=T;else if(e.tb!==0||e.tc!==0)r[o++]=e.tx,r[o++]=e.ty,r[o++]=u,r[o++]=d,i[o++]=e.colorTl,r[o++]=T,r[o++]=e.tx+e.width*e.ta,r[o++]=e.ty+e.width*e.tc,r[o++]=h,r[o++]=d,i[o++]=e.colorTr,r[o++]=T,r[o++]=e.tx+e.height*e.tb,r[o++]=e.ty+e.height*e.td,r[o++]=u,r[o++]=p,i[o++]=e.colorBl,r[o++]=T,r[o++]=e.tx+e.width*e.ta+e.height*e.tb,r[o++]=e.ty+e.width*e.tc+e.height*e.td,r[o++]=h,r[o++]=p,i[o++]=e.colorBr,r[o++]=T;else{const y=e.tx+e.width*e.ta,S=e.ty+e.height*e.td;r[o++]=e.tx,r[o++]=e.ty,r[o++]=u,r[o++]=d,i[o++]=e.colorTl,r[o++]=T,r[o++]=y,r[o++]=e.ty,r[o++]=h,r[o++]=d,i[o++]=e.colorTr,r[o++]=T,r[o++]=e.tx,r[o++]=S,r[o++]=u,r[o++]=p,i[o++]=e.colorBl,r[o++]=T,r[o++]=y,r[o++]=S,r[o++]=h,r[o++]=p,i[o++]=e.colorBr,r[o++]=T}this.curRenderOp.length+=ko,this.curRenderOp.numQuads++,this.curBufferIdx=o}newRenderOp(e,r,i,n,o,l,a,c,u){const d=new Ri(this.glw,this.options,this.quadBufferCollection,e,r,i,o,n,l,0,a,c,u);this.curRenderOp=d,this.renderOps.push(d)}addTexture(e,r,i){const{curRenderOp:n}=this;R(n);const o=n.addTexture(e);if(o===4294967295){if(i)throw new Error("Unable to add texture to render op");return this.newRenderOp(n.shader,n.shaderProps,n.alpha,n.dimensions,n.clippingRect,r),this.addTexture(e,r,!0)}return o}reuseRenderOp(e){var c;const{shader:r,shaderProps:i,parentHasRenderTexture:n,rtt:o,clippingRect:l}=e,a=r||this.defaultShader;return!(((c=this.curRenderOp)==null?void 0:c.shader)!==a||$n(this.curRenderOp.clippingRect,l)===!1||n!==void 0||o!==void 0||this.curRenderOp.shader!==this.defaultShader&&(i===null||this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps,i)===!1))}addRenderOp(e){this.renderOps.push(e),this.curRenderOp=null}render(e="screen"){const{glw:r,quadBuffer:i}=this,n=new Float32Array(i,0,this.curBufferIdx),o=this.quadBufferCollection.getBuffer("a_position")||null;r.arrayBufferData(o,n,r.STATIC_DRAW);for(let a=0,c=this.renderOps.length;a<c;a++)this.renderOps[a].draw();this.quadBufferUsage=this.curBufferIdx*n.BYTES_PER_ELEMENT;const l=4*(6*n.BYTES_PER_ELEMENT);this.numQuadsRendered=this.quadBufferUsage/l}getQuadCount(){return this.numQuadsRendered}renderToTexture(e){for(let r=0;r<this.rttNodes.length;r++)if(this.rttNodes[r]===e)return;this.insertRTTNodeInOrder(e)}insertRTTNodeInOrder(e){let r=this.rttNodes.length,i=e;for(;i&&i.parent;){const o=this.rttNodes.indexOf(i.parent);if(o!==-1){r=o;break}i=i.parent}const n=this.findMaxChildRTTIndex(e);n!==-1&&(r=Math.max(r,n+1)),this.rttNodes.splice(r,0,e)}findMaxChildRTTIndex(e){let r=-1;const i=n=>{const o=this.rttNodes.indexOf(n);o!==-1&&(r=Math.max(r,o));for(const l of n.children)i(l)};return i(e),r}renderRTTNodes(){const{glw:e}=this,{txManager:r}=this.stage;for(let n=0;n<this.rttNodes.length;n++){const o=this.rttNodes[n];if(o===void 0||o.hasRTTupdates===!1||o.worldAlpha===0||o.strictBounds===!0&&o.renderState===Z.OutOfBounds||o.texture===null||o.texture.state!=="loaded")continue;this.activeRttNode=o,R(o.texture,"RTT node missing texture");const l=o.texture.ctxTexture;R(l instanceof Vs),this.renderToTextureActive=!0,e.bindFramebuffer(l.framebuffer),e.viewport(0,0,l.w,l.h),e.clearColor(0,0,0,0),e.clear();for(let a=0;a<o.children.length;a++){const c=o.children[a];c!==void 0&&(this.stage.addQuads(c),c.hasRTTupdates=!1)}this.render(),this.renderOps.length=0,o.hasRTTupdates=!1}const i=this.clearColor.normalized;e.clearColor(i[0],i[1],i[2],i[3]),e.bindFramebuffer(null),e.viewport(0,0,this.glw.canvas.width,this.glw.canvas.height),this.renderToTextureActive=!1}removeRTTNode(e){const r=this.rttNodes.indexOf(e);r!==-1&&this.rttNodes.splice(r,1)}getBufferInfo(){return{totalAvailable:this.stage.options.quadBufferSize,totalUsed:this.quadBufferUsage}}getDefShaderCtr(){return this.defShaderCtrl}updateClearColor(e){if(this.clearColor.raw===e)return;const r=this.glw,i=Ut(e);r.clearColor(i[0],i[1],i[2],i[3]),this.clearColor={raw:e,normalized:i},r.clear()}}const Fo={LINE_FEED:10};class Oo{}class Uo extends Oo{constructor(e,r){super();f(this,"data");f(this,"glyphMap");f(this,"kernings");this.data=e,this.glyphMap=r;const i=this.kernings={};e.kernings.forEach(n=>{const o=n.second,l=i[o]=i[o]||{};l[n.first]=n.amount}),this.kernings=i}*shapeText(e,r){var o;let i,n;for(;(i=r.peek())&&!i.done;){const l=i.value,a=this.glyphMap.get(l);if(r.next(),a!==void 0){const c=n!==void 0?(((o=this.kernings[a.id])==null?void 0:o[n])||0)+e.letterSpacing:0;n=a.id,yield{mapped:!0,glyphId:a.id,codepoint:l,cluster:r.lastIndex,xAdvance:a.xadvance+c,yAdvance:0,xOffset:a.xoffset+c,yOffset:a.yoffset,xBearing:0,yBearing:0,width:a.width,height:a.height}}else l===Fo.LINE_FEED&&(n=void 0),yield{mapped:!1,codepoint:l,cluster:r.lastIndex}}}}class gs extends Ci{constructor(e,r){super(r);f(this,"type");f(this,"texture");f(this,"maxCharHeight",0);f(this,"shaper");f(this,"glyphMap",new Map);f(this,"data");const{atlasUrl:i,atlasDataUrl:n,stage:o}=r;this.type=e;const l=o.renderer;R(l instanceof Es,"SDF Font Faces can only be used with the WebGL Renderer"),this.texture=o.txManager.createTexture("ImageTexture",{src:i,premultiplyAlpha:!1}),o.txManager.loadTexture(this.texture,!0),this.texture.preventCleanup=!0,this.texture.on("loaded",()=>{this.checkLoaded(),o.requestRender()}),gi(n).then(a=>{var u;this.data=JSON.parse(a),R(this.data);let c=0;if(this.data.chars.forEach(d=>{this.glyphMap.set(d.id,d);const h=d.yoffset+d.height;h>c&&(c=h)}),this.maxCharHeight=c,this.shaper=new Uo(this.data,this.glyphMap),!this.metrics)if((u=this.data)!=null&&u.lightningMetrics){const{ascender:d,descender:h,lineGap:p,unitsPerEm:g}=this.data.lightningMetrics;this.metrics={ascender:d/g,descender:h/g,lineGap:p/g}}else throw new Error(`Font metrics not found in ${this.type} font ${this.fontFamily}. Make sure you are using the latest version of the Lightning 3 \`msdf-generator\` tool to generate your SDF fonts.`);this.checkLoaded()}).catch(console.error)}getAtlasEntry(e){const r=this.glyphMap.get(e);if(r===void 0)throw new Error(`Glyph ${e} not found in font ${this.fontFamily}`);return{x:r.x,y:r.y,width:r.width,height:r.height}}checkLoaded(){this.loaded||this.texture.state==="loaded"&&this.data&&(this.loaded=!0,this.emit("loaded"))}}const $o=24;function Do(s,t,e,r,i,n,o,l,a){const c=Math.min(Math.max(o.firstLineIdx,0),l.length),u=0,{metrics:d}=e;R(d,"Font metrics not loaded"),R(e.data,"Font data not loaded");const h=(d.ascender-d.descender)*s;let p=0;r==="middle"?p=(t-h)/2:r==="bottom"&&(p=t-h);const g=i/n,x=e.data.common.base,y=d.ascender*s-x,S=g+y+c*t+p;if(!(a&&S>=a/n))return{sdfX:u,sdfY:S,lineIndex:c}}class Rt{constructor(t,e=0){f(this,"iterator");f(this,"peekBuffer",[]);f(this,"_lastIndex");this.iterator=t,this.iterator=t,this._lastIndex=e-1,this.peekBuffer=[]}next(){const t=this.peekBuffer.length>0?this.peekBuffer.pop():this.iterator.next();return t.done?this._lastIndex=-1:this._lastIndex++,t}peek(){if(this.peekBuffer.length>0)return this.peekBuffer[0];const t=this.iterator.next();return this.peekBuffer.push(t),t}get lastIndex(){return this._lastIndex}}function*_t(s,t=0){let e=t;for(;e<s.length;){const r=s.codePointAt(e);if(r===void 0)throw new Error("Invalid Unicode code point");yield r,e+=r<=65535?1:2}}function No(s,t,e){const r=e.shapeText(t,new Rt(_t(s,0),0));let i=0;for(const n of r)n.mapped&&n.codepoint!==8203&&(i+=n.xAdvance);return i}function zo(s,t,e,r,i,n,o,l,a,c,u,d,h,p,g,x,T,y,S){R(g,"Font face must be loaded"),R(g.loaded,"Font face must be loaded"),R(g.data,"Font face must be loaded"),R(g.shaper,"Font face must be loaded");const v=l/g.data.info.size,C=a/v,$=n/v,A=c/v,M=h[s],L=(M==null?void 0:M.codepointIndex)||0,W=(M==null?void 0:M.maxX)||0,k=(M==null?void 0:M.maxY)||0;let B=W,I=k,P=t,O=e,_=0;const w={codepointIndex:-1,bufferOffset:-1,xStart:-1},E=g.shaper,N={letterSpacing:A};r.endsWith(" ")&&(r+=" ");let X=E.shapeText(N,new Rt(_t(r,L),L)),z,V=-1;const D=[],j=o/v,ee=No(y,N,E);let re=!0;for(;re;){const K=(S===0||s+1<S)&&(d!=="both"||T||O+C+g.maxCharHeight<=j),te=K?$:$-ee;let q=0;const he=O+g.maxCharHeight>=p.y1,se=O<=p.y2,fe=he&&se;for(;(z=X.next())&&!z.done;){const Y=z.value;if(s===h.length)h.push({codepointIndex:Y.cluster,maxY:I,maxX:B});else if(s>h.length)throw new Error("Unexpected lineCache length");if(Y.codepoint===32||Y.codepoint===10||Y.codepoint===8203?w.codepointIndex!==-1&&(w.codepointIndex=-1,q=P):w.codepointIndex===-1&&(w.codepointIndex=Y.cluster,w.bufferOffset=_,w.xStart=q),Y.mapped){const je=P+Y.xOffset+Y.width;if(d!=="none"&&je>=te&&w.codepointIndex!==-1&&w.xStart>0)if(K){X=E.shapeText(N,new Rt(_t(r,w.codepointIndex),w.codepointIndex)),_=w.bufferOffset;break}else X=E.shapeText(N,new Rt(_t(y,0),0)),P=w.xStart,_=w.bufferOffset,d="none";else{const ue=P+Y.xOffset,ie=O+Y.yOffset;if(fe){V===-1&&(V=_);const qe=g.getAtlasEntry(Y.glyphId),oe=qe.x/g.data.common.scaleW,de=qe.y/g.data.common.scaleH,De=qe.width/g.data.common.scaleW,ce=qe.height/g.data.common.scaleH;u[_++]=ue,u[_++]=ie,u[_++]=oe,u[_++]=de,u[_++]=ue+Y.width,u[_++]=ie,u[_++]=oe+De,u[_++]=de,u[_++]=ue,u[_++]=ie+Y.height,u[_++]=oe,u[_++]=de+ce,u[_++]=ue+Y.width,u[_++]=ie+Y.height,u[_++]=oe+De,u[_++]=de+ce}I=Math.max(I,ie+Y.height),B=Math.max(B,ue+Y.width),P+=Y.xAdvance}}else if(Y.codepoint===10){if(K)break;X=E.shapeText(N,new Rt(_t(y,0),0)),d="none"}}V!==-1&&(D.push({bufferStart:V,bufferEnd:_}),V=-1),P=0,O+=C,s++,w.codepointIndex=-1,q=0,!x&&d==="both"&&O>p.y2||z&&z.done?re=!1:K||(re=!1)}if(i==="center"){const K=d==="none"?B:$;for(let te=0;te<D.length;te++){const q=D[te],he=u[q.bufferEnd-4]-u[q.bufferStart],se=(K-he)/2;for(let fe=q.bufferStart;fe<q.bufferEnd;fe+=4)u[fe]+=se}}else if(i==="right"){const K=d==="none"?B:$;for(let te=0;te<D.length;te++){const q=D[te],he=q.bufferEnd===q.bufferStart?0:u[q.bufferEnd-4]-u[q.bufferStart],se=K-he;for(let fe=q.bufferStart;fe<q.bufferEnd;fe+=4)u[fe]+=se}}return R(z),{bufferNumFloats:_,bufferNumQuads:_/16,layoutNumCharacters:z.done?r.length-L:z.value.cluster-L+1,fullyProcessed:!!z.done,maxX:B,maxY:I,numLines:h.length}}function Wo(s,t){return Math.ceil(s/t)*t}function Xo(s,t){return Math.floor(s/t)*t}function Vo(s,t,e,r,i,n,o,l){const{screen:a,sdf:c}=s;if(!Nn(o))a.x1=0,a.y1=0,a.x2=0,a.y2=0,c.x1=0,c.y1=0,c.x2=0,c.y2=0,s.numLines=0,s.firstLineIdx=0;else{const u=o.x1-t,d=u+(o.x2-o.x1),h=o.y1-e+r,p=Xo(h-n,i||1),g=Wo(h+(o.y2-o.y1)+n,i||1);a.x1=u,a.y1=p,a.x2=d,a.y2=g,c.x1=u/l,c.y1=p/l,c.x2=d/l,c.y2=g/l,s.numLines=Math.ceil((g-p)/i),s.firstLineIdx=i?Math.floor(p/i):0}s.valid=!0}function Ei(s,t){return t*(s.ascender-s.descender+s.lineGap)}const Go={x:0,y:0,width:0,height:0};class Yo extends _s{constructor(e){super(e);f(this,"ssdfFontFamilies",{});f(this,"msdfFontFamilies",{});f(this,"fontFamilyArray",[this.ssdfFontFamilies,this.msdfFontFamilies]);f(this,"sdfShader");f(this,"rendererBounds");f(this,"type","sdf");this.sdfShader=this.stage.shManager.loadShader("SdfShader",{transform:new Float32Array,color:0,size:0,scrollY:0,distanceRange:0,debug:!1}).shader,this.rendererBounds={x1:0,y1:0,x2:this.stage.options.appWidth,y2:this.stage.options.appHeight}}getPropertySetters(){return{fontFamily:(e,r)=>{e.props.fontFamily=r,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontWeight:(e,r)=>{e.props.fontWeight=r,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontStyle:(e,r)=>{e.props.fontStyle=r,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontStretch:(e,r)=>{e.props.fontStretch=r,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontSize:(e,r)=>{e.props.fontSize=r,this.invalidateLayoutCache(e)},text:(e,r)=>{e.props.text=r,this.invalidateLayoutCache(e)},textAlign:(e,r)=>{e.props.textAlign=r,this.invalidateLayoutCache(e)},color:(e,r)=>{e.props.color=r},x:(e,r)=>{e.props.x=r,e.elementBounds.valid&&(this.setElementBoundsX(e),!e.renderWindow.valid&&jr(e.elementBounds,this.rendererBounds)&&this.scheduleUpdateState(e))},y:(e,r)=>{e.props.y=r,e.elementBounds.valid&&(this.setElementBoundsY(e),!e.renderWindow.valid&&jr(e.elementBounds,this.rendererBounds)&&this.scheduleUpdateState(e))},contain:(e,r)=>{e.props.contain=r,this.invalidateLayoutCache(e)},width:(e,r)=>{e.props.width=r,e.props.contain!=="none"&&this.invalidateLayoutCache(e)},height:(e,r)=>{e.props.height=r,e.props.contain==="both"&&this.invalidateLayoutCache(e)},offsetY:(e,r)=>{e.props.offsetY=r,this.invalidateLayoutCache(e)},scrollable:(e,r)=>{e.props.scrollable=r,this.invalidateLayoutCache(e)},scrollY:(e,r)=>{e.props.scrollY=r,this.scheduleUpdateState(e)},letterSpacing:(e,r)=>{e.props.letterSpacing=r,this.invalidateLayoutCache(e)},lineHeight:(e,r)=>{e.props.lineHeight=r,e.resLineHeight=void 0,this.invalidateLayoutCache(e)},maxLines:(e,r)=>{e.props.maxLines=r,this.invalidateLayoutCache(e)},textBaseline:(e,r)=>{e.props.textBaseline=r,this.invalidateLayoutCache(e)},verticalAlign:(e,r)=>{e.props.verticalAlign=r,this.invalidateLayoutCache(e)},overflowSuffix:(e,r)=>{e.props.overflowSuffix=r,this.invalidateLayoutCache(e)},debug:(e,r)=>{e.props.debug=r}}}canRenderFont(e){const{fontFamily:r}=e;return r in this.ssdfFontFamilies||r in this.msdfFontFamilies||r==="$$SDF_FAILURE_TEST$$"}isFontFaceSupported(e){return e instanceof gs}addFontFace(e){R(e instanceof gs);const r=e.fontFamily,i=e.type==="ssdf"?this.ssdfFontFamilies:e.type==="msdf"?this.msdfFontFamilies:void 0;if(!i){console.warn(`Invalid font face type: ${e.type}`);return}let n=i[r];n||(n=new Set,i[r]=n),n.add(e)}createState(e){return{props:e,status:"initialState",updateScheduled:!1,emitter:new xe,lineCache:[],forceFullLayoutCalc:!1,renderWindow:{screen:{x1:0,y1:0,x2:0,y2:0},sdf:{x1:0,y1:0,x2:0,y2:0},firstLineIdx:0,numLines:0,valid:!1},elementBounds:{x1:0,y1:0,x2:0,y2:0,valid:!1},clippingRect:{x:0,y:0,width:0,height:0,valid:!1},bufferNumFloats:0,bufferNumQuads:0,vertexBuffer:void 0,webGlBuffers:null,bufferUploaded:!1,textH:void 0,textW:void 0,distanceRange:0,trFontFace:void 0,isRenderable:!1,resLineHeight:void 0,debugData:{updateCount:0,layoutCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,drawCount:0,bufferSize:0}}}updateState(e){let{trFontFace:r}=e;const{textH:i,lineCache:n,debugData:o,forceFullLayoutCalc:l}=e;if(o.updateCount++,e.status==="initialState"&&this.setStatus(e,"loading"),r===void 0){if(r=this.resolveFontFace(e.props),e.trFontFace=r,r===void 0){const E=`SdfTextRenderer: Could not resolve font face for family: '${e.props.fontFamily}'`;console.error(E),this.setStatus(e,"failed",new Error(E));return}r.texture.setRenderableOwner(e,!0)}if(r.loaded===!1){r.once("loaded",()=>{this.scheduleUpdateState(e)});return}R(r.data,"Font face data should be loaded"),R(r.metrics,"Font face metrics should be loaded");const{text:a,fontSize:c,x:u,y:d,contain:h,width:p,height:g,verticalAlign:x,scrollable:T,overflowSuffix:y,maxLines:S}=e.props,v=h==="both"&&T?e.props.scrollY:0,{renderWindow:C}=e,$=r.data.info.size,A=c/$;let M=e.resLineHeight;if(M===void 0){const E=e.props.lineHeight;E===void 0?M=Ei(r.metrics,c):M=E,e.resLineHeight=M}const L=M/A;e.distanceRange=A*r.data.distanceField.distanceRange;const W=a.length*$o;let k=e.vertexBuffer;(!k||k.length<W)&&(k=new Float32Array(W*2));const B=e.elementBounds;if(B.valid||(this.setElementBoundsX(e),this.setElementBoundsY(e),B.valid=!0),!l&&C.valid){const E=C.screen;if(u+E.x1<=B.x1&&u+E.x2>=B.x2&&d-v+E.y1<=B.y1&&d-v+E.y2>=B.y2){this.setStatus(e,"loaded");return}C.valid=!1,this.setStatus(e,"loading")}const{offsetY:I,textAlign:P}=e.props;if(!C.valid){if(!jr(B,this.rendererBounds))return;Vo(C,u,d,v,M,h==="both"?B.y2-B.y1:0,B,A)}const O=Do($,L,r,x,I,A,C,n,i);if(!O){this.setStatus(e,"loaded");return}const{letterSpacing:_}=e.props,w=zo(O.lineIndex,O.sdfX,O.sdfY,a,P,p,g,c,M,_,k,h,n,C.sdf,r,l,T,y,S);e.bufferUploaded=!1,e.bufferNumFloats=w.bufferNumFloats,e.bufferNumQuads=w.bufferNumQuads,e.vertexBuffer=k,e.renderWindow=C,o.lastLayoutNumCharacters=w.layoutNumCharacters,o.bufferSize=k.byteLength,w.fullyProcessed&&(e.textW=w.maxX*A,e.textH=w.numLines*L*A),this.setStatus(e,"loaded")}renderQuads(e,r,i,n,o,l){var B,I;if(!e.vertexBuffer)return;const a=this.stage.renderer;R(a instanceof Es);const{fontSize:c,color:u,contain:d,scrollable:h,zIndex:p,debug:g}=e.props,x=d==="both"&&h?e.props.scrollY:0,{textW:T=0,textH:y=0,distanceRange:S,vertexBuffer:v,bufferUploaded:C,trFontFace:$,elementBounds:A}=e;let{webGlBuffers:M}=e;if(!M){const P=a.glw,O=4*Float32Array.BYTES_PER_ELEMENT,_=P.createBuffer();R(_),e.webGlBuffers=new _i([{buffer:_,attributes:{a_position:{name:"a_position",size:2,type:P.FLOAT,normalized:!1,stride:O,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:P.FLOAT,normalized:!1,stride:O,offset:2*Float32Array.BYTES_PER_ELEMENT}}}]),e.bufferUploaded=!1,R(e.webGlBuffers),M=e.webGlBuffers}if(!C){const P=a.glw,O=(M==null?void 0:M.getBuffer("a_textureCoordinate"))??null;P.arrayBufferData(O,v,P.STATIC_DRAW),e.bufferUploaded=!0}if(R($),h&&d==="both"){R(A.valid);const P=Un(A,Go);i.valid?(e.clippingRect.valid=!0,i=di(i,P,e.clippingRect)):(e.clippingRect.valid=!0,i=pi(P,e.clippingRect))}const L=new Ri(a.glw,a.options,M,this.sdfShader,{transform:r.getFloatArr(),color:Pn(u,n),size:c/(((B=$.data)==null?void 0:B.info.size)||0),scrollY:x,distanceRange:S,debug:g.sdfShaderDebug},n,i,{height:y,width:T},0,p,!1,o,l),W=(I=e.trFontFace)==null?void 0:I.texture;R(W);const k=W.ctxTexture;L.addTexture(k),L.length=e.bufferNumFloats,L.numQuads=e.bufferNumQuads,a.addRenderOp(L)}setIsRenderable(e,r){var i;super.setIsRenderable(e,r),(i=e.trFontFace)==null||i.texture.setRenderableOwner(e,r)}destroyState(e){var r;super.destroyState(e),(r=e.trFontFace)==null||r.texture.setRenderableOwner(e,!1)}resolveFontFace(e){return this.stage.fontManager.resolveFontFace(this.fontFamilyArray,e,"sdf")}releaseFontFace(e){e.resLineHeight=void 0,e.trFontFace&&(e.trFontFace.texture.setRenderableOwner(e,!1),e.trFontFace=void 0)}invalidateLayoutCache(e){e.renderWindow.valid=!1,e.elementBounds.valid=!1,e.textH=void 0,e.textW=void 0,e.lineCache=[],this.setStatus(e,"loading"),this.scheduleUpdateState(e)}setElementBoundsX(e){const{x:r,contain:i,width:n}=e.props,{elementBounds:o}=e;o.x1=r,o.x2=i!=="none"?r+n:1/0}setElementBoundsY(e){const{y:r,contain:i,height:n}=e.props,{elementBounds:o}=e;o.y1=r,o.y2=i==="both"?r+n:1/0}}function Gs(s){return s===""||s==="​"}function Ho(s,t,e){if(t.metrics)return t.metrics;const r=s.measureText("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz");console.warn(`Font metrics not provided for Canvas Web font ${t.fontFamily}. Using fallback values. It is HIGHLY recommended you use the latest version of the Lightning 3 \`msdf-generator\` tool to extract the default metrics for the font and provide them in the Canvas Web font definition.`);let i;return r.actualBoundingBoxDescent&&r.actualBoundingBoxAscent?i={ascender:r.actualBoundingBoxAscent/e,descender:-r.actualBoundingBoxDescent/e,lineGap:.2}:i={ascender:.8,descender:-.2,lineGap:.2},t.metrics=i,i}const Ys=2048;function Hs(s,t,e,r,i){const n=s!=="bottom"?.5*t:0;return e*(r-1)+n+Math.max(e,t)+(i||0)}class Ko{constructor(t,e){f(this,"_canvas");f(this,"_context");f(this,"_settings");this._canvas=t,this._context=e,this._settings=this.mergeDefaults({})}set settings(t){this._settings=this.mergeDefaults(t)}get settings(){return this._settings}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=this._getFontSetting(),this._context.textBaseline=this._settings.textBaseline}_getFontSetting(){const t=[this._settings.fontFamily],e=[];for(let r=0,i=t.length;r<i;r++)t[r]==="serif"||t[r]==="sans-serif"?e.push(t[r]):e.push(`"${t[r]}"`);return`${this._settings.fontStyle} ${this._settings.fontSize*this.getPrecision()}px ${e.join(",")}`}_load(){if(document.fonts){const t=this._getFontSetting();try{if(!document.fonts.check(t,this._settings.text))return document.fonts.load(t,this._settings.text).catch(e=>{console.warn("[Lightning] Font load error",e,t)}).then(()=>{document.fonts.check(t,this._settings.text)||console.warn("[Lightning] Font not found",t)})}catch{console.warn("[Lightning] Can't check font loading for "+t)}}}calculateRenderInfo(){const t={},e=this.getPrecision(),r=this._settings.paddingLeft*e,i=this._settings.paddingRight*e,n=this._settings.fontSize*e;let o=this._settings.offsetY===null?null:this._settings.offsetY*e;const l=this._settings.w*e,a=this._settings.h*e;let c=this._settings.wordWrapWidth*e;const u=this._settings.cutSx*e,d=this._settings.cutEx*e,h=this._settings.cutSy*e,p=this._settings.cutEy*e,g=(this._settings.letterSpacing||0)*e,x=this._settings.textIndent*e,T=this._settings.trFontFace;this.setFontProperties(),R(T);const y=Ho(this._context,T,n),S=Ei(y,n)*e,v=this._settings.lineHeight!==null?this._settings.lineHeight*e:S,C=this._settings.maxHeight,$=C!==null&&v>0?Math.floor(C/v):0,A=this._settings.maxLines,M=$>0&&A>0?Math.min($,A):Math.max($,A);let L=l||2048/this.getPrecision(),W=L-r;if(W<10&&(L+=10-W,W=10),c||(c=W),this._settings.textOverflow&&!this._settings.wordWrap){let _;switch(this._settings.textOverflow){case"clip":_="";break;case"ellipsis":_=this._settings.overflowSuffix;break;default:_=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,c-x,_)}let k;if(this._settings.wordWrap)k=this.wrapText(this._settings.text,c,g,x);else{k={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]};const _=k.l.length;for(let w=0;w<_-1;w++)k.n.push(w)}let B=k.l;if(M&&B.length>M){const _=B.slice(0,M);let w=null;if(this._settings.overflowSuffix){const V=this._settings.overflowSuffix?this.measureText(this._settings.overflowSuffix):0,D=this.wrapText(_[_.length-1],c-V,g,x);_[_.length-1]=`${D.l[0]}${this._settings.overflowSuffix}`,w=[D.l.length>1?D.l[1]:""]}else w=[""];let E;const N=B.length;let X=0;const z=k.n.length;for(E=M;E<N;E++)w[X]+=`${w[X]?" ":""}${B[E]}`,E+1<z&&k.n[E+1]&&X++;t.remainingText=w.join(`
`),t.moreTextLines=!0,B=_}else t.moreTextLines=!1,t.remainingText="";let I=0;const P=[];for(let _=0;_<B.length;_++){const w=this.measureText(B[_],g)+(_===0?x:0);P.push(w),I=Math.max(I,w)}t.lineWidths=P,l||(L=I+r+i,W=I),this._settings.wordWrap&&l>I&&this._settings.textAlign==="left"&&B.length===1&&(L=I+r+i);let O;return a?O=a:O=Hs(this._settings.textBaseline,n,v,B.length,o),o===null&&(o=n),t.w=L,t.h=O,t.lines=B,t.precision=e,L||(L=1),O||(O=1),(u||d)&&(L=Math.min(L,d-u)),(h||p)&&(O=Math.min(O,p-h)),t.width=L,t.innerWidth=W,t.height=O,t.fontSize=n,t.cutSx=u,t.cutSy=h,t.cutEx=d,t.cutEy=p,t.lineHeight=v,t.defLineHeight=S,t.lineWidths=P,t.offsetY=o,t.paddingLeft=r,t.paddingRight=i,t.letterSpacing=g,t.textIndent=x,t.metrics=y,t}draw(t,e){const r=this.getPrecision(),i=(e==null?void 0:e.lines)||t.lines,n=(e==null?void 0:e.lineWidths)||t.lineWidths,o=e?Hs(this._settings.textBaseline,t.fontSize,t.lineHeight,e.lines.length,this._settings.offsetY===null?null:this._settings.offsetY*r):t.height;this._canvas.width=Math.min(Math.ceil(t.width+this._settings.textRenderIssueMargin),Ys),this._canvas.height=Math.min(Math.ceil(o),Ys),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy);let l,a;const c=[],{metrics:u}=t,d=u?u.ascender*t.fontSize:t.fontSize,h=(u.ascender-u.descender)*t.fontSize;for(let g=0,x=i.length;g<x;g++)l=g===0?t.textIndent:0,a=g*t.lineHeight+d,this._settings.verticalAlign=="middle"?a+=(t.lineHeight-h)/2:this._settings.verticalAlign=="bottom"&&(a+=t.lineHeight-h),this._settings.textAlign==="right"?l+=t.innerWidth-n[g]:this._settings.textAlign==="center"&&(l+=(t.innerWidth-n[g])/2),l+=t.paddingLeft,c.push({text:i[g],x:l,y:a,w:n[g]});if(this._settings.highlight){const g=this._settings.highlightColor,x=this._settings.highlightHeight*r||t.fontSize*1.5,T=this._settings.highlightOffset*r,y=this._settings.highlightPaddingLeft!==null?this._settings.highlightPaddingLeft*r:t.paddingLeft,S=this._settings.highlightPaddingRight!==null?this._settings.highlightPaddingRight*r:t.paddingRight;this._context.fillStyle=Kr(g);for(let v=0;v<c.length;v++){const C=c[v];this._context.fillRect(C.x-y,C.y-t.offsetY+T,C.w+S+y,x)}}let p=null;this._settings.shadow&&(p=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=Kr(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*r,this._context.shadowOffsetY=this._settings.shadowOffsetY*r,this._context.shadowBlur=this._settings.shadowBlur*r),this._context.fillStyle=Kr(this._settings.textColor);for(let g=0,x=c.length;g<x;g++){const T=c[g];if(t.letterSpacing===0)this._context.fillText(T.text,T.x,T.y);else{const y=T.text.split("");let S=T.x;for(let v=0,C=y.length;v<C;v++)this._context.fillText(y[v],S,T.y),S+=this.measureText(y[v],t.letterSpacing)}}p&&(this._context.shadowColor=p[0],this._context.shadowOffsetX=p[1],this._context.shadowOffsetY=p[2],this._context.shadowBlur=p[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy)}wrapWord(t,e,r){const i=this._context.measureText(r).width,n=t.length,o=this._context.measureText(t).width;if(o<=e)return t;let l=Math.floor(e*n/o),a=this._context.measureText(t.substring(0,l)).width+i;if(a>e)for(;l>0&&(a=this._context.measureText(t.substring(0,l)).width+i,a>e);)l-=1;else for(;l<n;)if(a=this._context.measureText(t.substring(0,l)).width+i,a<e)l+=1;else{l-=1;break}return t.substring(0,l)+(e>=i?r:"")}wrapText(t,e,r,i=0){const n=/ |\u200B/g,o=t.split(/\r?\n/g);let l=[];const a=[];for(let c=0;c<o.length;c++){const u=[];let d="",h=e-i;const p=o[c].split(n),g=o[c].match(n)||[];for(let x=0;x<p.length;x++){const T=g[x-1]||"",y=p[x],S=this.measureText(y,r),v=Gs(T)?S:S+this.measureText(T,r);x===0||v>h?(x>0&&(u.push(d),d=""),d+=y,h=e-S-(x===0?i:0)):(h-=v,d+=T+y)}u.push(d),d="",l=l.concat(u),c<o.length-1&&a.push(l.length)}return{l,n:a}}measureText(t,e=0){return e?t.split("").reduce((r,i)=>Gs(i)?r:r+this._context.measureText(i).width+e,0):this._context.measureText(t).width}mergeDefaults(t){return{text:"",w:0,h:0,fontStyle:"normal",fontSize:40,fontFamily:null,trFontFace:null,wordWrap:!0,wordWrapWidth:0,wordBreak:!1,textOverflow:"",lineHeight:null,textBaseline:"alphabetic",textAlign:"left",verticalAlign:"top",offsetY:null,maxLines:0,maxHeight:null,overflowSuffix:"...",textColor:[1,1,1,1],paddingLeft:0,paddingRight:0,shadow:!1,shadowColor:[0,0,0,1],shadowOffsetX:0,shadowOffsetY:0,shadowBlur:5,highlight:!1,highlightHeight:0,highlightColor:[0,0,0,1],highlightOffset:0,highlightPaddingLeft:0,highlightPaddingRight:0,letterSpacing:0,textIndent:0,cutSx:0,cutEx:0,cutSy:0,cutEy:0,advancedRenderer:!1,fontBaselineRatio:0,precision:1,textRenderIssueMargin:0,...t}}}const Ks=typeof self>"u"?globalThis:self;var oi;const js=((oi=Ks.document)==null?void 0:oi.fonts)||Ks.fonts;function jo(s){const{fontFamily:t,fontStyle:e,fontWeight:r,fontStretch:i,fontSize:n}=s;return[e,r,i,`${n}px`,t].join(" ")}class qs extends _s{constructor(e){super(e);f(this,"canvas");f(this,"context");f(this,"fontFamilies",{});f(this,"fontFamilyArray",[this.fontFamilies]);f(this,"type","canvas");f(this,"loadFont",e=>{const r=jo(e.props),i=this.stage.fontManager.resolveFontFace(this.fontFamilyArray,e.props,"canvas");if(R(i,`Could not resolve font face for ${r}`),e.fontInfo={fontFace:i,cssString:r,loaded:!1},!e.fontInfo.loaded){js.load(r).then(this.onFontLoaded.bind(this,e,r)).catch(this.onFontLoadError.bind(this,e,r));return}});typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(0,0):this.canvas=document.createElement("canvas");let r=this.canvas.getContext("2d",{willReadFrequently:!0});r||(this.canvas=document.createElement("canvas"),r=this.canvas.getContext("2d",{willReadFrequently:!0})),R(r),this.context=r,this.addFontFace(new Rr({fontFamily:"sans-serif",descriptors:{},fontUrl:""}))}getPropertySetters(){return{fontFamily:(e,r)=>{e.props.fontFamily=r,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontWeight:(e,r)=>{e.props.fontWeight=r,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontStyle:(e,r)=>{e.props.fontStyle=r,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontStretch:(e,r)=>{e.props.fontStretch=r,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontSize:(e,r)=>{e.props.fontSize=r,e.fontInfo=void 0,this.invalidateLayoutCache(e)},text:(e,r)=>{e.props.text=r,this.invalidateLayoutCache(e)},textAlign:(e,r)=>{e.props.textAlign=r,this.invalidateLayoutCache(e)},color:(e,r)=>{e.props.color=r,this.invalidateLayoutCache(e)},x:(e,r)=>{e.props.x=r},y:(e,r)=>{e.props.y=r},contain:(e,r)=>{e.props.contain=r,this.invalidateLayoutCache(e)},width:(e,r)=>{e.props.width=r,e.props.contain!=="none"&&this.invalidateLayoutCache(e)},height:(e,r)=>{e.props.height=r,e.props.contain==="both"&&this.invalidateLayoutCache(e)},offsetY:(e,r)=>{e.props.offsetY=r,this.invalidateLayoutCache(e)},scrollY:(e,r)=>{e.props.scrollY=r},letterSpacing:(e,r)=>{e.props.letterSpacing=r,this.invalidateLayoutCache(e)},lineHeight:(e,r)=>{e.props.lineHeight=r,this.invalidateLayoutCache(e)},maxLines:(e,r)=>{e.props.maxLines=r,this.invalidateLayoutCache(e)},textBaseline:(e,r)=>{e.props.textBaseline=r,this.invalidateLayoutCache(e)},verticalAlign:(e,r)=>{e.props.verticalAlign=r,this.invalidateLayoutCache(e)},overflowSuffix:(e,r)=>{e.props.overflowSuffix=r,this.invalidateLayoutCache(e)}}}canRenderFont(e){return!0}isFontFaceSupported(e){return e instanceof Rr}addFontFace(e){R(e instanceof Rr);const r=e.fontFamily;r!=="sans-serif"&&js.add(e.fontFace);let i=this.fontFamilies[r];i||(i=new Set,this.fontFamilies[r]=i),i.add(e)}createState(e,r){return{node:r,props:e,status:"initialState",updateScheduled:!1,emitter:new xe,textureNode:void 0,lightning2TextRenderer:new Ko(this.canvas,this.context),renderInfo:void 0,forceFullLayoutCalc:!1,textW:0,textH:0,fontInfo:void 0,isRenderable:!1,debugData:{updateCount:0,layoutCount:0,drawCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,bufferSize:0}}}updateState(e){if(e.status==="initialState"&&this.setStatus(e,"loading"),e.status!=="loaded"){if(!e.fontInfo)return this.loadFont(e);e.fontInfo.loaded&&(e.renderInfo||(e.renderInfo=this.calculateRenderInfo(e),e.textH=e.renderInfo.lineHeight*e.renderInfo.lines.length,e.textW=e.renderInfo.width,this.renderSingleCanvasPage(e)))}}renderSingleCanvasPage(e){R(e.renderInfo);const r=e.node,i=this.stage.txManager.createTexture("ImageTexture",{premultiplyAlpha:!0,src:(function(n,o){return R(o),n.draw(o,{lines:o.lines,lineWidths:o.lineWidths}),this.canvas.width===0||this.canvas.height===0?null:this.context.getImageData(0,0,this.canvas.width,this.canvas.height)}).bind(this,e.lightning2TextRenderer,e.renderInfo)});if(e.textureNode)e.textureNode.texture=i,e.textureNode.alpha=$s(e.props.color);else{const n=this.stage.createNode({parent:r,texture:i,autosize:!0,alpha:$s(e.props.color)});e.textureNode=n}this.setStatus(e,"loaded")}calculateRenderInfo(e){var r;return e.lightning2TextRenderer.settings={text:e.props.text,textAlign:e.props.textAlign,fontFamily:e.props.fontFamily,trFontFace:(r=e.fontInfo)==null?void 0:r.fontFace,fontSize:e.props.fontSize,fontStyle:[e.props.fontStretch,e.props.fontStyle,e.props.fontWeight].join(" "),textColor:Ut(e.props.color),offsetY:e.props.offsetY,wordWrap:e.props.contain!=="none",wordWrapWidth:e.props.contain==="none"?void 0:e.props.width,letterSpacing:e.props.letterSpacing,lineHeight:e.props.lineHeight??null,maxLines:e.props.maxLines,maxHeight:e.props.contain==="both"?e.props.height-e.props.offsetY:null,textBaseline:e.props.textBaseline,verticalAlign:e.props.verticalAlign,overflowSuffix:e.props.overflowSuffix,w:e.props.contain!=="none"?e.props.width:void 0},e.renderInfo=e.lightning2TextRenderer.calculateRenderInfo(),e.renderInfo}renderQuads(){}destroyState(e){e.status!=="destroyed"&&(super.destroyState(e),e.textureNode&&(e.textureNode.destroy(),delete e.textureNode),delete e.renderInfo)}invalidateLayoutCache(e){e.renderInfo=void 0,this.setStatus(e,"loading"),this.scheduleUpdateState(e)}onFontLoaded(e,r){var i;r!==((i=e.fontInfo)==null?void 0:i.cssString)||!e.fontInfo||(e.fontInfo.loaded=!0,this.scheduleUpdateState(e))}onFontLoadError(e,r,i){var n;r!==((n=e.fontInfo)==null?void 0:n.cssString)||!e.fontInfo||(e.fontInfo.loaded=!0,console.error(`CanvasTextRenderer: Error loading font '${e.fontInfo.cssString}'`,i),this.scheduleUpdateState(e))}}const Ai={isWhite:!0,a:1,r:255,g:255,b:255};function es(s){if(s===4294967295)return Ai;const t=(s>>>24&255)/255,e=s>>>16&255&255,r=s>>>8&255&255,i=s&255&255;return{isWhite:!1,a:t,r:i,g:r,b:e}}function Mi(s){if(s===4294967295)return Ai;const t=s>>>24&255,e=s>>>16&255&255,r=s>>>8&255&255,i=(s&255&255)/255;return{isWhite:!1,r:t,g:e,b:r,a:i}}function ut({a:s,r:t,g:e,b:r}){return`rgba(${t},${e},${r},${s})`}class qo extends wi{constructor(){super(...arguments);f(this,"image");f(this,"tintCache")}load(){this.textureSource.setState("loading"),this.onLoadRequest().then(e=>{this.textureSource.setState("loaded",e),this.textureSource.freeTextureData(),this.updateMemSize()}).catch(e=>{this.textureSource.setState("failed",e),this.textureSource.freeTextureData()})}free(){this.image=void 0,this.tintCache=void 0,this.textureSource.setState("freed"),this.setTextureMemUse(0),this.textureSource.freeTextureData()}updateMemSize(){const e=this.tintCache?8:4;if(this.textureSource.dimensions){const{width:r,height:i}=this.textureSource.dimensions;this.setTextureMemUse(r*i*e)}}hasImage(){return this.image!==void 0}getImage(e){var o;const r=this.image;if(R(r,"Attempt to get unloaded image texture"),e.isWhite)return this.tintCache&&(this.tintCache=void 0,this.updateMemSize()),r;const i=ut(e);if(((o=this.tintCache)==null?void 0:o.key)===i)return this.tintCache.image;const n=this.tintTexture(r,i);return this.tintCache={key:i,image:n},this.updateMemSize(),n}tintTexture(e,r){const{width:i,height:n}=e,o=document.createElement("canvas");o.width=i,o.height=n;const l=o.getContext("2d");return l&&(l.fillStyle=r,l.globalCompositeOperation="copy",l.fillRect(0,0,i,n),l.globalCompositeOperation="multiply",l.drawImage(e,0,0,i,n,0,0,i,n),l.globalCompositeOperation="destination-in",l.drawImage(e,0,0,i,n,0,0,i,n)),o}async onLoadRequest(){var r,i;R((i=(r=this.textureSource)==null?void 0:r.textureData)==null?void 0:i.data,"Texture data is null");const{data:e}=this.textureSource.textureData;if(e instanceof ImageData){const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const o=n.getContext("2d");return o&&o.putImageData(e,0,0),this.image=n,{width:e.width,height:e.height}}else if(typeof ImageBitmap<"u"&&e instanceof ImageBitmap||e instanceof HTMLImageElement)return this.image=e,{width:e.width,height:e.height};return{width:0,height:0}}}function Qo(s){var t,e;if(s.shader instanceof zr){const r=s.shader.shType;if(r===po)return((t=s.shaderProps)==null?void 0:t.radius)??0;if(r==="DynamicShader"){const i=(e=s.shaderProps)==null?void 0:e.effects;if(i){const n=i.find(o=>{var l;return o.type==="radius"&&((l=o==null?void 0:o.props)==null?void 0:l.radius)});return n&&n.type==="radius"&&n.props.radius||0}}}return 0}function wt(s,t=""){var e;if(s.shader instanceof zr&&s.shader.shType==="DynamicShader"){const i=(e=s.shaderProps)==null?void 0:e.effects;if(i&&i.length){const n=i.find(o=>o.type===`border${t}`&&o.props&&o.props.width);return n&&n.props}}}function Qs(s,t,e,r,i){if(Object.getPrototypeOf(this).roundRect)this.roundRect(s,t,e,r,i);else{const o=a=>{const c=Math.min(e/2,r/2),u=a.topLeft+a.topRight+a.bottomRight+a.bottomLeft;if(u>e||u>r){const d=c/Math.max(a.topLeft,a.topRight,a.bottomRight,a.bottomLeft);a.topLeft*=d,a.topRight*=d,a.bottomRight*=d,a.bottomLeft*=d}},l=typeof i=="number"?{topLeft:i,topRight:i,bottomRight:i,bottomLeft:i}:{topLeft:0,topRight:0,bottomRight:0,bottomLeft:0,...i};o(l),this.moveTo(s+l.topLeft,t),this.lineTo(s+e-l.topRight,t),this.ellipse(s+e-l.topRight,t+l.topRight,l.topRight,l.topRight,0,1.5*Math.PI,2*Math.PI),this.lineTo(s+e,t+r-l.bottomRight),this.ellipse(s+e-l.bottomRight,t+r-l.bottomRight,l.bottomRight,l.bottomRight,0,0,.5*Math.PI),this.lineTo(s+l.bottomLeft,t+r),this.ellipse(s+l.bottomLeft,t+r-l.bottomLeft,l.bottomLeft,l.bottomLeft,0,.5*Math.PI,Math.PI),this.lineTo(s,t+l.topLeft),this.ellipse(s+l.topLeft,t+l.topLeft,l.topLeft,l.topLeft,0,Math.PI,1.5*Math.PI)}}function gr(s,t,e,r,i,n=0,o,l){if(!n)return;let a,c=0,u,d=0;switch(l){case"Top":a=t,c=e,u=r+t,d=e;break;case"Right":a=t+r,c=e,u=t+r,d=e+i;break;case"Bottom":a=t,c=e+i,u=t+r,d=e+i;break;case"Left":a=t,c=e,u=t,d=e+i;break}s.beginPath(),s.lineWidth=n,s.strokeStyle=ut(Mi(o??0)),s.moveTo(a,c),s.lineTo(u,d),s.stroke()}class Zo extends vi{constructor(e){super(e);f(this,"context");f(this,"canvas");f(this,"pixelRatio");f(this,"clearColor");f(this,"renderToTextureActive",!1);f(this,"activeRttNode",null);f(this,"defShaderCtr");this.mode="canvas",this.shManager.renderer=this;const{canvas:r,pixelRatio:i,clearColor:n}=e;this.canvas=r,this.context=r.getContext("2d"),this.pixelRatio=i,this.clearColor=n?Us(n):void 0,this.defShaderCtr={type:"DefaultShader",props:{},shader:new zr("DefaultShader"),getResolvedProps:()=>()=>({})}}reset(){this.canvas.width=this.canvas.width;const e=this.context;if(this.clearColor){const[r,i,n,o]=this.clearColor;e.fillStyle=`rgba(${r}, ${i}, ${n}, ${o/255})`,e.fillRect(0,0,this.canvas.width,this.canvas.height)}e.scale(this.pixelRatio,this.pixelRatio)}render(){}addQuad(e){const r=this.context,{tx:i,ty:n,width:o,height:l,alpha:a,colorTl:c,colorTr:u,colorBr:d,ta:h,tb:p,tc:g,td:x,clippingRect:T}=e;let y=e.texture,S,v;const C=y==null?void 0:y.type;if(R(C,"Texture type is not defined"),C!==H.image&&C!==H.color&&C!==H.subTexture&&C!==H.noise||y&&(y instanceof kt&&(v=y.props,y=y.parentTexture),S=y.ctxTexture,y.state==="freed"||y.state!=="loaded"))return;const $=es(c),A=h!==1,M=T.width!==0&&T.height!==0,L=c!==u||c!==d,W=!!e.shader,k=W?Qo(e):0,B=W?wt(e):void 0;if((A||M||k)&&r.save(),M){const I=new Path2D,{x:P,y:O,width:_,height:w}=T;I.rect(P,O,_,w),r.clip(I)}if(A){const I=this.pixelRatio;r.setTransform(h,g,p,x,i*I,n*I),r.scale(I,I),r.translate(-i,-n)}if(k){const I=new Path2D;Qs.call(I,i,n,o,l,k),r.clip(I)}if((C===H.image||C===H.subTexture||C===H.noise)&&S){const I=S.getImage($);if(r.globalAlpha=$.a??a,v)r.drawImage(I,v.x,v.y,v.width,v.height,i,n,o,l);else try{r.drawImage(I,i,n,o,l)}catch{}r.globalAlpha=1}else if(C===H.color&&L){let I=i,P=n,O;c===u?(I=i,P=n+l,O=es(d)):(I=i+o,P=n,O=es(u));const _=r.createLinearGradient(i,n,I,P);_.addColorStop(0,ut($)),_.addColorStop(1,ut(O)),r.fillStyle=_,r.fillRect(i,n,o,l)}else C===H.color&&(r.fillStyle=ut($),r.fillRect(i,n,o,l));if(B&&B.width){const I=B.width,P=B.width/2,O=ut(Mi(B.color??0));r.beginPath(),r.lineWidth=I,r.strokeStyle=O,r.globalAlpha=a,k?(Qs.call(r,i+P,n+P,o-I,l-I,k),r.stroke()):r.strokeRect(i+P,n+P,o-I,l-I),r.globalAlpha=1}else if(W){const I=wt(e,"Top"),P=wt(e,"Right"),O=wt(e,"Bottom"),_=wt(e,"Left");I&&gr(r,i,n,o,l,I.width,I.color,"Top"),P&&gr(r,i,n,o,l,P.width,P.color,"Right"),O&&gr(r,i,n,o,l,O.width,O.color,"Bottom"),_&&gr(r,i,n,o,l,_.width,_.color,"Left")}(A||M||k)&&r.restore()}createCtxTexture(e){return new qo(this.txMemManager,e)}getShaderManager(){return this.shManager}getDefShaderCtr(){return this.defShaderCtr}renderRTTNodes(){}removeRTTNode(e){}renderToTexture(e){}getBufferInfo(){return null}getQuadCount(){return null}updateClearColor(e){this.clearColor=e?Us(e):void 0}}const Et={alpha:s=>s===1?null:{prop:"opacity",value:`${s}`},x:s=>({prop:"left",value:`${s}px`}),y:s=>({prop:"top",value:`${s}px`}),width:s=>s===0?null:{prop:"width",value:`${s}px`},height:s=>s===0?null:{prop:"height",value:`${s}px`},fontSize:s=>s===0?null:{prop:"font-size",value:`${s}px`},lineHeight:s=>s===0?null:{prop:"line-height",value:`${s}px`},zIndex:()=>"z-index",fontFamily:()=>"font-family",fontStyle:()=>"font-style",fontWeight:()=>"font-weight",fontStretch:()=>"font-stretch",letterSpacing:()=>"letter-spacing",textAlign:()=>"text-align",overflowSuffix:()=>"overflow-suffix",maxLines:()=>"max-lines",contain:()=>"contain",verticalAlign:()=>"vertical-align",clipping:s=>s===!1?null:{prop:"overflow",value:s?"hidden":"visible"},rotation:s=>s===0?null:{prop:"transform",value:`rotate(${s}rad)`},scale:s=>s===1?null:{prop:"transform",value:`scale(${s})`},scaleX:s=>s===1?null:{prop:"transform",value:`scaleX(${s})`},scaleY:s=>s===1?null:{prop:"transform",value:`scaleY(${s})`},color:s=>s===0?null:{prop:"color",value:Ii(s)}},Ii=s=>{const t=(s&255)/255,e=s>>8&255,r=s>>16&255;return`rgba(${s>>24&255},${r},${e},${t})`},xs={id:"test-id"},Jo=new Set([...Object.keys(Et),...Object.keys(xs),"src","parent","data"]);class ea{constructor(t,e){f(this,"root",null);f(this,"canvas",null);f(this,"height",1080);f(this,"width",1920);f(this,"scaleX",1);f(this,"scaleY",1);if(Tt())return;if(!e)throw new Error("settings is required");this.height=Math.ceil(e.appHeight??1080/(e.deviceLogicalPixelRatio??1)),this.width=Math.ceil(e.appWidth??1920/(e.deviceLogicalPixelRatio??1)),this.scaleX=e.deviceLogicalPixelRatio??1,this.scaleY=e.deviceLogicalPixelRatio??1,this.canvas=t,this.root=document.createElement("div"),this.setRootPosition(),document.body.appendChild(this.root),new MutationObserver(this.setRootPosition.bind(this)).observe(t,{attributes:!0,childList:!1,subtree:!1}),new ResizeObserver(this.setRootPosition.bind(this)).observe(t),window.addEventListener("resize",this.setRootPosition.bind(this)),console.warn("Inspector is enabled, this will impact performance")}setRootPosition(){if(this.root===null||this.canvas===null)return;const t=this.canvas.getBoundingClientRect(),e=document.documentElement.scrollTop+t.top,r=document.documentElement.scrollLeft+t.left;this.root.id="root",this.root.style.left=`${r}px`,this.root.style.top=`${e}px`,this.root.style.width=`${this.width}px`,this.root.style.height=`${this.height}px`,this.root.style.position="absolute",this.root.style.transformOrigin="0 0 0",this.root.style.transform=`scale(${this.scaleX}, ${this.scaleY})`,this.root.style.overflow="hidden",this.root.style.zIndex="65534"}createDiv(t,e){const r=document.createElement("div");r.style.position="absolute",r.id=t.toString();for(const i in e)this.updateNodeProperty(r,i,e[i],e);return r}createNode(t){const e=this.createDiv(t.id,t.props);return e.node=t,t.div=e,t.on("inViewport",()=>e.setAttribute("state","inViewport")),t.on("inBounds",()=>e.setAttribute("state","inBounds")),t.on("outOfBounds",()=>e.setAttribute("state","outOfBounds")),this.createProxy(t,e)}createTextNode(t){const e=this.createDiv(t.id,t.props);return e.node=t,t.div=e,this.createProxy(t,e)}createProxy(t,e){Jo.forEach(n=>{let o=Object.getOwnPropertyDescriptor(t,n);if(o===void 0){const l=Object.getPrototypeOf(t);o=Object.getOwnPropertyDescriptor(l,n)}o!==void 0&&Object.defineProperty(t,n,{get(){var l;return(l=o==null?void 0:o.get)==null?void 0:l.call(t)},set:l=>{var a;(a=o==null?void 0:o.set)==null||a.call(t,l),this.updateNodeProperty(e,n,l,t.props)},configurable:!0,enumerable:!0})});const r=t.destroy;Object.defineProperty(t,"destroy",{value:()=>{this.destroyNode(t.id),r.call(t)}});const i=t.animate;return Object.defineProperty(t,"animate",{value:(n,o)=>{const l=i.call(t,n,o),a=l.start.bind(l);return l.start=()=>(this.animateNode(e,n,o),a()),l}}),t}destroyNode(t){const e=document.getElementById(t.toString());e==null||e.remove()}updateNodeProperty(t,e,r,i){var n;if(!(this.root===null||r===void 0||r===null)){if(e==="parent"){const o=r.id;if(o===1){this.root.appendChild(t);return}const l=document.getElementById(o.toString());l==null||l.appendChild(t);return}if(e==="text"){t.innerHTML=String(r),t.style.visibility="hidden";return}if(e==="src"&&r){t.setAttribute("data-src",String(r));return}if(e==="rtt"&&r){t.setAttribute("data-rtt",String(r));return}if(Et[e]){const o=(n=Et[e])==null?void 0:n.call(Et,r);if(o===null)return;if(typeof o=="string"){t.style.setProperty(o,String(r));return}if(typeof o=="object"){let l=o.value;if(e==="x"){const a=i.mountX,c=i.width;a&&(l=`${parseInt(l)-c*a}px`)}else if(e==="y"){const a=i.mountY,c=i.height;a&&(l=`${parseInt(l)-c*a}px`)}t.style.setProperty(o.prop,l)}return}if(xs[e]){const o=xs[e];if(!o)return;t.setAttribute(String(o),String(r));return}if(e==="data"){for(const o in r){const l=r[o];l===void 0?t.removeAttribute(`data-${o}`):t.setAttribute(`data-${o}`,String(l))}return}}}animateNode(t,e,r){const{duration:i=1e3,delay:n=0}=r,{x:o,y:l,width:a,height:c,alpha:u=1,rotation:d=0,scale:h=1,color:p,mountX:g,mountY:x}=e;function T(){setTimeout(()=>{t.style.top=`${l-c*x}px`,t.style.left=`${o-a*g}px`,t.style.width=`${a}px`,t.style.height=`${c}px`,t.style.opacity=`${u}`,t.style.rotate=`${d}rad`,t.style.scale=`${h}`,t.style.color=Ii(p)},i)}setTimeout(T,n)}}const Li=50,Zs={hd:.66666667,"720p":.66666667,720:.66666667,fhd:1,fullhd:1,"1080p":1,1080:1,"4k":2,"2160p":2,2160:2},ta={low:.66666667,medium:.85,high:1,retina:2},ra=()=>{const s=le.stage;ae.get("fonts",[]).forEach(t=>{t.type==="sdf"||t.type==="msdf"?(!t.png&&t.file&&(t.png=t.file.replace(/\.[^.]+$/,`.${t.type}.png`)),!t.json&&t.file&&(t.json=t.file.replace(/\.[^.]+$/,`.${t.type}.json`)),s.fontManager.addFontFace(new gs(t.type,{fontFamily:t.family,descriptors:{},atlasUrl:t.png,atlasDataUrl:t.json,stage:s,metrics:t.metrics}))):t.type==="web"&&s.fontManager.addFontFace(new Rr({fontFamily:t.family,fontUrl:t.file,descriptors:{},metrics:t.metrics}))})},sa=()=>{const s=le.stage;ae.get("shaders",[]).forEach(t=>{s.shManager.registerShaderType(t.name,t.type)}),ae.get("effects",[]).forEach(t=>{s.shManager.registerShaderType(t.name,t.type)})};let le=null;const ia=s=>{const t="renderMode"in s?s.renderMode:"webgl";if(t==="webgl")return Es;if(t==="canvas")return Zo},na=s=>{const t="renderMode"in s?s.renderMode:"webgl";if(t==="webgl")return[Yo,qs];if(t==="canvas")return[qs]},oa=s=>{const t={max:200,target:.8,cleanupInterval:5e3,baseline:25,strict:!1,..."gpuMemory"in s?s.gpuMemory:{}};return{criticalThreshold:t.max*1024*1024,targetThresholdLevel:t.target,cleanupInterval:t.cleanupInterval,baselineMemoryAllocation:t.baseline*1024*1024,doNotExceedCriticalThreshold:t.strict}},aa=(s,t,e={})=>{le=new Ro({appWidth:e.w||1920,appHeight:e.h||1080,fpsUpdateInterval:e.fpsInterval||1e3,devicePhysicalPixelRatio:ta[e.renderQuality]||e.renderQuality||1,deviceLogicalPixelRatio:e.pixelRatio||Zs[e.screenResolution]||Zs[window.innerHeight]||1,numImageWorkers:"webWorkersLimit"in e?e.webWorkersLimit:window.navigator.hardwareConcurrency||2,clearColor:e.canvasColor&&pt.normalize(e.canvasColor)||0,inspector:e.inspector===!0?ea:void 0,boundsMargin:e.viewportMargin||0,renderEngine:ia(e),fontEngines:na(e),canvas:e.canvas,textureProcessingTimeLimit:e.textureProcessingTimeLimit,textureMemory:oa(e),createImageBitmapSupport:"auto",...e.advanced||{}},t);const r=()=>{let i=s();i.quit=()=>{G.info("Closing App"),i.destroy(),i=null,le=null}};return sa(),ra(),r(),le};let la=0;const fa=(s,t)=>{if(s===void 0)return{start:0,end:0,oppositeStart:0,oppositeEnd:0};if(typeof s=="number")return{start:s,end:s,oppositeStart:s,oppositeEnd:s};if(Be(s)===!0&&(s=ke(s)),typeof s=="object"){const{top:e=void 0,right:r=void 0,bottom:i=void 0,left:n=void 0,x:o=0,y:l=0}=s;return t==="vertical"?{start:e!==void 0?e:l,end:i!==void 0?i:l,oppositeStart:n!==void 0?n:o,oppositeEnd:r!==void 0?r:o}:{start:n!==void 0?n:o,end:r!==void 0?r:o,oppositeStart:e!==void 0?e:l,oppositeEnd:i!==void 0?i:l}}return{start:0,end:0,oppositeStart:0,oppositeEnd:0}},ca=function(s){const t=s.direction==="vertical"?"y":"x",e=s.direction==="vertical"?"x":"y",r=s.direction==="vertical"?"mountX":"mountY",i=s.direction==="vertical"?"height":"width",n=s.direction==="vertical"?"width":"height",o=fa(s.padding,s.direction);let l=o.start;const a=this.node.children,c=a.length;let u=0;const d=s.gap||0;for(let p=0;p<c;p++){if(this.children[p]!==void 0&&this.children[p].props.raw.show===!1)continue;const g=a[p];g[t]=l,g[e]=o.oppositeStart,i==="width"?l+=g.width+(g.width!==("text"in g?1:0)?d:0):l+="text"in g?g.width>1?g.height+d:0:g.height!==0?g.height+d:0,u=Math.max(u,g[n]+o.oppositeStart+o.oppositeEnd)}this.node[i]=l-d+o.end,this.node[n]=u;const h={start:0,end:1,center:.5}[s["align-items"]||"start"];if(h!==0)for(let p=0;p<c;p++){const g=a[p];g[e]=u*h,g[r]=h}s["@updated"]!==void 0&&s["@updated"]({w:this.node.width,h:this.node.height},this),this.config.parent&&this.config.parent.props.__layout===!0&&this.config.parent.triggerLayout(this.config.parent.props)},Js=s=>s!==null&&typeof s=="object"&&"transition"in s,Be=s=>typeof s=="string"&&s.startsWith("{")&&s.endsWith("}"),ke=s=>JSON.parse(s.replace(/'/g,'"').replace(/([\w-_]+)\s*:/g,'"$1":')),Qe=function(s,t){return typeof s!="string"?s:s.indexOf("%")===s.length-1?this.element.config.parent&&(this.element.config.parent.node[t]||0)*(parseFloat(s)/100)||0:s},ys=s=>{if(typeof s!="object"||s===null)return s;if(s.constructor===Object){if("value"in s)return s.value;if("transition"in s)return ys(s.transition)}return s},ha={top:"colorTop",bottom:"colorBottom",left:"colorLeft",right:"colorRight"};let Ts=null;const ua={set parent(s){this.props.parent=s==="root"?le.root:s.node},set rotation(s){this.props.rotation=s*(Math.PI/180)},set w(s){this.props.width=Qe.call(this,s,"width")},set width(s){this.props.width=Qe.call(this,s,"width")},set h(s){this.props.height=Qe.call(this,s,"height")},set height(s){this.props.height=Qe.call(this,s,"height")},set x(s){this.props.x=Qe.call(this,s,"width")},set y(s){this.props.y=Qe.call(this,s,"height")},set z(s){this.props.zIndex=s},set zIndex(s){this.props.zIndex=s},set color(s){typeof s=="string"&&s.startsWith("{")===!1?this.props.color=pt.normalize(s):(typeof s=="object"||Be(s)===!0&&(s=ke(s)))&&(this.props.color=0,Object.entries(s).forEach(t=>{this.props[ha[t[0]]]=pt.normalize(t[1])}))},set src(s){this.props.src=s,this.raw.color===void 0&&(this.props.color=this.props.src?4294967295:0),!("w"in this.raw)&&!("w"in this.raw)&&!("h"in this.raw)&&!("height"in this.raw)&&(this.props.autosize=!0)},set texture(s){this.props.texture=s,this.raw.color===void 0&&s==null?this.props.color=0:this.raw.color===void 0&&(this.props.color=4294967295)},set fit(s){const t={};if(s==="cover"||s==="contain"){this.props.textureOptions={resizeMode:{type:s}};return}(typeof s=="object"||Be(s)===!0&&(s=ke(s)))&&(t.type=s.type||"cover",typeof s.position=="number"&&(t.clipY=t.clipX=s.position),typeof s.position=="object"&&(t.clipX="x"in s.position?s.position.x:null,t.clipY="y"in s.position?s.position.y:null),this.props.textureOptions={resizeMode:t})},set rtt(s){this.props.rtt=s,this.raw.color===void 0&&(this.props.color=s===!0?4294967295:0)},set mount(s){typeof s=="object"||Be(s)===!0&&(s=ke(s))?("x"in s&&(this.props.mountX=s.x),"y"in s&&(this.props.mountY=s.y)):(this.props.mountX=s,this.props.mountY=s)},set pivot(s){typeof s=="object"||Be(s)===!0&&(s=ke(s))?("x"in s&&(this.props.pivotX=s.x),"y"in s&&(this.props.pivotY=s.y)):(this.props.pivotX=s,this.props.pivotY=s)},set scale(s){typeof s=="object"||Be(s)===!0&&(s=ke(s))?("x"in s&&(this.props.scaleX=s.x),"y"in s&&(this.props.scaleY=s.y)):this.props.scale=s},set show(s){s?this.props.alpha=this.raw.alpha!==void 0?this.raw.alpha:1:this.props.alpha=0},set alpha(s){(this.raw.show===void 0||this.raw.show==!0)&&(this.props.alpha=s)},set shader(s){s!==null?this.props.shader=le.createShader(s.type,s.props):this.props.shader=le.createShader("DefaultShader")},set effects(s){for(let e=0;e<s.length;e++)s[e].props&&s[e].props.color&&(s[e].props.color=pt.normalize(s[e].props.color));const t={};if(this.element.node===void 0)this.element.effectNames=[],this.props.shader=le.createShader("DynamicShader",{effects:s.map(e=>{let r=e.type;return t[r]!==void 0?r+=++t[r]:t[r]=1,r+=this.element.counter,this.element.effectNames.push(r),le.createEffect(e.type,e.props,r)})});else for(let e=0;e<s.length;e++){const r=this.element.effectNames[e],i=this.element.node.shader.props[r],n=Object.keys(s[e].props);if(i!=null)for(let o=0;o<n.length;o++)i[n[o]]=s[e].props[n[o]]}},set clipping(s){this.props.clipping=s},set overflow(s){this.props.clipping=!s},set font(s){this.props.fontFamily=s},set size(s){this.props.fontSize=s},set wordwrap(s){G.warn("The wordwrap attribute is deprecated, use maxwidth instead"),this.props.width=s,this.props.contain="width"},set maxwidth(s){this.props.width=s,this.props.contain="width"},set maxheight(s){this.props.height=s,this.props.contain="both"},set contain(s){this.props.contain=s},set maxlines(s){this.props.maxLines=s},set textoverflow(s){this.props.overflowSuffix=s===!1?" ":s===!0?void 0:s},set letterspacing(s){this.props.letterSpacing=s||1},set lineheight(s){this.props.lineHeight=s},set align(s){this.props.textAlign=s},set content(s){this.props.text=""+s},set placement(s){let t,e;typeof s=="object"||Be(s)===!0&&(s=ke(s))?("x"in s&&(t=s.x),"y"in s&&(e=s.y)):s==="center"||s==="right"?t=s:e=s,t==="center"?(this.x="50%",this.props.mountX=.5):t==="right"&&(this.x="100%",this.props.mountX=1),e==="middle"?(this.y="50%",this.props.mountY=.5):e==="bottom"&&(this.y="100%",this.props.mountY=1)},set"inspector-data"(s){(typeof s=="object"||Be(s)===!0&&(s=ke(s)))&&(this.props.data=s)}},da={populate(s){const t=s;t.node=this.config.node,t[m.isSlot]===!0&&(this[m.isSlot]=!0),this.props.element=this,this.props.parent=t.parent||this.config.parent,delete t.parent,this.props.raw=s;const e=Object.keys(t),r=e.length;for(let i=0;i<r;i++){const n=e[i],o=t[n];o!==void 0&&(this.props[n]=ys(o))}this.props.props.color===void 0&&!("__textnode"in t)&&(this.props.props.color=0),this.node=t.__textnode?le.createTextNode({...Ts,...this.props.props}):le.createNode(this.props.props),t["@loaded"]!==void 0&&typeof t["@loaded"]=="function"&&this.node.on("loaded",(i,{type:n,dimensions:o})=>{t["@loaded"]({w:o.width,h:o.height,type:n},this)}),t["@error"]!==void 0&&typeof t["@error"]=="function"&&this.node.on("failed",(i,n)=>{t["@error"](n,this)}),t.__layout===!0&&(this.triggerLayout=ca.bind(this)),this.config.parent.props!==void 0&&this.config.parent.props.__layout===!0&&(this.config.parent.triggerLayout(this.config.parent.props),this.node.on("loaded",()=>{this.config.parent.triggerLayout(this.config.parent.props)}))},set(s,t){if(t===void 0||this.props.raw[s]===t)return;this.props.raw[s]=t,this.props.props={},this.props[s]=ys(t);const e=Object.keys(this.props.props);if(e.length===1){if(Js(t)===!0)return this.animate(e[0],this.props.props[e[0]],t.transition);this.node[e[0]]=this.props.props[e[0]]}else for(let r=0;r<e.length;r++){if(Js(t)===!0)return this.animate(e[r],this.props.props[e[r]],t.transition);this.node[e[r]]=this.props.props[e[r]]}this.config.parent.props&&this.config.parent.props.__layout===!0&&this.config.parent.triggerLayout(this.config.parent.props)},animate(s,t,e){if(this.scheduledTransitions[s]!==void 0&&this.scheduledTransitions[s].f.state==="scheduled"&&this.scheduledTransitions[s].f.stop(),this.node[s]===t)return;const r={};r[s]=t;const i=this.node.animate(r,{duration:typeof e=="object"&&"duration"in e?e.duration:300,easing:typeof e=="object"&&"easing"in e?e.easing:"ease",delay:typeof e=="object"&&"delay"in e?e.delay:0}),n=this.node[s];if(this.scheduledTransitions[s]={v:r[s],f:i},e.start!==void 0&&typeof e.start=="function"&&i.once("animating",()=>{e.start.call(this.component,this,s,n)}),this.config.parent.props&&this.config.parent.props.__layout===!0&&i.on("tick",()=>{this.config.parent.triggerLayout(this.config.parent.props)}),e.progress!==void 0&&typeof e.progress=="function"){let o=0;i.on("tick",(l,{progress:a})=>{e.progress.call(this.component,this,s,a,o),o=a})}i.once("stopped",()=>{this.scheduledTransitions[s]!==void 0&&this.scheduledTransitions[s].canceled===!0||(e.end&&typeof e.end=="function"&&e.end.call(this.component,this,s,this.node[s]),delete this.scheduledTransitions[s])}),i.start()},destroy(){if(this.node===null)return;G.debug("Deleting  Node",this.nodeId),this.node.destroy();const s=Object.keys(this.scheduledTransitions);for(let t=0;t<s.length;t++){const e=this.scheduledTransitions[s[t]];e!==void 0&&(e.canceled=!0,e.f!==void 0&&e.f.stop())}this.node=null},get nodeId(){return this.node&&this.node.id},get ref(){return this.props.ref||null},get parent(){return this.node&&this.node.parent},get children(){return this.component[m.getChildren]().filter(s=>s.parent===(this[m.isSlot]?this.node.children[0]:this.node))}},pa=(s,t)=>(Ts===null&&(Ts={fontSize:32,fontFamily:ae.get("defaultFont","sans-serif")}),Object.assign(Object.create(da),{props:Object.assign(Object.create(ua),{props:{}}),scheduledTransitions:{},config:s,component:t,effectNames:[],counter:la++})),ei={Element:pa,Launch:aa},ma="1.29.3",ga={"@lightningjs/renderer":"^2.13.2"},Pi={version:ma,dependencies:ga};let Or={};const As={};async function xa(){let s;try{if(s=await Mn(()=>import("./package-BcI48DmZ.js"),[]),s!==void 0)return s.version}catch{return Pi.dependencies["@lightningjs/renderer"]}}const ya=(s,t,e)=>{ae.set(e),on(),xa().then(r=>{G.info("Blits Version ",Pi.version),G.info("Renderer Version ",r)}),As.element=ei.Element,Or=ei.Launch(s,t,e)},Ta={before:{prop:"alpha",value:0},in:{prop:"alpha",value:1,duration:200},out:{prop:"alpha",value:0,duration:100}},He=window.speechSynthesis,ba=/android/i.test((window.navigator||{}).userAgent||"");let Bi=!1,Ur=null;const ki=()=>Ur&&clearTimeout(Ur),bs=s=>{if(!s||Ur)return ki();He.pause(),He.resume(),Ur=setTimeout(()=>{bs(s)},5e3)},ot={lang:"en-US",pitch:1,rate:1,voice:null,volume:1},Sa=()=>{ot.voice=He.getVoices()[0],Bi=!0},wa=s=>{const t=new SpeechSynthesisUtterance(s.message);return t.lang=s.lang||ot.lang,t.pitch=s.pitch||ot.pitch,t.rate=s.rate||ot.rate,t.voice=s.voice||ot.voice,t.volume=s.volume||ot.volume,ba===!1&&(t.onstart=()=>{bs(t)},t.onresume=()=>{bs(t)}),new Promise((e,r)=>{t.onend=()=>{e()},t.onerror=i=>{r(i)},He.speak(t)})},Ms={speak(s){return He!==void 0?(Bi===!1&&Sa(),wa(s)):(G.error("speechSynthesis web API not available"),Promise.reject({error:"unavailable"}))},cancel(){He!==void 0&&(He.cancel(),ki())}};let Dt=!1,va=0;const Oe=[];let at=!1,At=null,xr=null;const Fi={then(){},done(){},cancel(){},stop(){}},Ca=()=>{Dt=!0},Ra=()=>{Dt=!1},_a=s=>{Dt=!!s},Is=(s,t="off")=>Dt===!1?Fi:Oi(s,t),Ea=s=>Dt===!1?Fi:Oi(void 0,void 0,s),Oi=(s,t,e=!1)=>{const r=va++;let i;const n=new Promise(o=>{i=o});return n.cancel=()=>{const o=Oe.findIndex(l=>l.id===r);o!==-1&&Oe.splice(o,1),i("canceled")},n.stop=()=>{r===At&&(Ms.cancel(),at=!1,i("interupted"))},e===!1?t==="assertive"?Oe.unshift({message:s,resolveFn:i,id:r}):Oe.push({message:s,resolveFn:i,id:r}):Oe.push({delay:e,resolveFn:i,id:r}),setTimeout(()=>{_r()},100),n},_r=async()=>{if(at===!0||Oe.length===0)return;at=!0;const{message:s,resolveFn:t,delay:e,id:r}=Oe.shift();At=r,e?setTimeout(()=>{at=!1,At=null,t("finished"),_r()},e):(xr!==null&&clearTimeout(xr),xr=setTimeout(()=>{Ms.speak({message:s}).then(()=>{at=!1,At=null,t("finished"),_r()}).catch(i=>{at=!1,At=null,t(i.error),_r()}),xr=null},200))},Aa=s=>Is(s,"polite"),Ma=s=>Is(s,"assertive"),Ia=()=>{Ms.cancel()},La=()=>{Oe.length=0},Er={speak:Is,polite:Aa,assertive:Ma,stop:Ia,enable:Ca,disable:Ra,toggle:_a,clear:La,pause:Ea};let Ue;const ge=as({path:"",navigating:!1,data:null,params:null,hash:""},ae.get("reactivityMode"),!0),Ss=new Map,Ui=[];let $i={},Di={},xt=!1,Ni;const Pa=()=>{const s=(document.location.hash||"/").replace(/^#/,"").split("?");return{path:s[0],queryParams:new URLSearchParams(s[1]),hash:document.location.hash}},ti=s=>s.replace(/^\/+|\/+$/g,"").toLowerCase(),ri=s=>typeof s=="object"&&s!==null,si=s=>typeof s=="string",zi=(s,t=[])=>{const e=s.replace(/^\/+|\/+$/g,"");s=ti(s);let r=!1,i=0;for(;!r&&i<t.length;){const n=t[i];if(n.path=ti(n.path),n.path===s)n.params={},r=n;else if(n.path.indexOf(":")>-1){const o=[...n.path.matchAll(/:([^\s/]+)/gi)];let l=n.path;o.reverse().forEach(c=>{l=l.substring(0,c.index)+"([^\\s/]+)"+l.substring(c.index+c[0].length)}),l="^"+l;const a=e.match(new RegExp(`${l}`,"i"));a&&(n.params=o.reverse().reduce((c,u,d)=>(c[u[1]]=a[d+1],c),{}),r=n)}else if(n.path.endsWith("*")){const o=new RegExp(n.path.replace(/\/?\*/,"/?([^\\s]*)"),"i"),l=s.match(o);l&&(l[1]&&(n.params={path:l[1]}),r=n)}i++}return r&&(r.options={...r.options,...$i},r.data||(r.data={})),r},Ba=async function(){if(Er.stop(),Er.clear(),ge.navigating=!0,this.parent[m.routes]){let s=Ue;const{hash:t,path:e,queryParams:r}=Pa();let i=zi(e,this.parent[m.routes]);if(t!==null&&(i.hash=t),Ue=i,i){let n;if(this.parent[m.routerHooks]){const h=this.parent[m.routerHooks];if(h.beforeEach&&(n=await h.beforeEach(i,s),si(n))){Ft(n);return}}i=ri(n)?n:i;let o;if(i.hooks&&i.hooks.before&&(o=await i.hooks.before.call(this.parent,i,s),si(o))){Ue=s,Ft(o);return}i=ri(o)?o:i,xt===!1&&s&&s.options.inHistory===!0&&Ui.push(s),"transition"in i||(i.transition=Ta),typeof i.transition=="function"&&(i.transition=i.transition(s,i));let l,a,{view:c,focus:u}=Ss.get(i.hash)||{};if(i.announce&&(typeof i.announce=="string"&&(i.announce={message:i.announce}),Er.speak(i.announce.message,i.announce.politeness)),c){l=c[m.holder];let h=!1;if(i.transition.before)if(Array.isArray(i.transition.before)){for(let p=0;p<i.transition.before.length;p++)if(i.transition.before[p].prop==="alpha"){h=!0;break}}else i.transition.before.prop==="alpha"&&(h=!0);h===!1&&l.set("alpha",1)}else{l=As.element({parent:this[m.children][0]}),l.populate({}),l.set("w","100%"),l.set("h","100%");const h={},p=[...r.entries()];for(let x=0;x<p.length;x++)h[p[x][0]]=p[x][1];a={...Di,...i.data,...h};const g={...this[m.props],...i.params,...a};c=await i.component({props:g},l,this),c[Symbol.toStringTag]==="Module"&&(c.default&&typeof c.default=="function"?c=c.default({props:g},l,this):G.error("Dynamic import doesn't have a default export or default is not a function")),typeof c=="function"&&(c=c({props:g},l,this))}if(this[m.children].push(c),Ni=dt.get(),u?u.$focus():c.$focus(),i.transition.before)if(Array.isArray(i.transition.before))for(let h=0;h<i.transition.before.length;h++)l.set(i.transition.before[h].prop,i.transition.before[h].value);else l.set(i.transition.before.prop,i.transition.before.value);let d=!1;if(s){d=!0;const h=this[m.children].splice(1,1).pop();h&&ka(s,h,i.transition.out)}if(ge.path=i.path,ge.params=i.params,ge.hash=t,ge.data=a,i.transition.in)if(Array.isArray(i.transition.in))for(let h=0;h<i.transition.in.length;h++)h===i.transition.length-1?await yt(l,i.transition.in[h],d):yt(l,i.transition.in[h],d);else await yt(l,i.transition.in,d);this.activeView=this[m.children][this[m.children].length-1]}else G.error(`Route ${t} not found`)}xt=!1,ge.navigating=!1},ka=async(s,t,e)=>{if(e)if(Array.isArray(e))for(let r=0;r<e.length;r++)r===e.length-1?await yt(t[m.holder],e[r]):yt(t[m.holder],e[r]);else await yt(t[m.holder],e);xt===!1&&s.options&&s.options.keepAlive===!0?Ss.set(s.hash,{view:t,focus:Ni}):xt===!0&&Ss.delete(s.hash),s.options&&(s.options.keepAlive!==!0||xt===!0)&&(t.destroy(),t=null)},yt=(s,t,e=!0)=>new Promise(r=>{if(e===!0){let i=t.end;t.end=(...n)=>{i&&i(n),i=null,r()},s.set(t.prop,{transition:t})}else s.set(t.prop,t.value),r()}),Ft=(s,t={},e={})=>{Di=t,$i=e,window.location.hash=s},Wi=function(){const s=Ui.pop();if(s&&Ue!==s)return xt=!0,Ft(s.hash,s.data,s.options),!0;const t=Ue&&Ue.options.backtrack||!1;if(t===!1)return!1;const e=/(\/:?[\w%\s-]+)$/;let r=Ue.path,i=r.split("/").length;if(i<=1)return!1;for(;i--;){if(!e.test(r))return!1;r=r.replace(e,"");const n=zi(r,this.parent[m.routes]);if(n&&t)return Ft(n.path),!0}return!1},ts={navigate:Ba,back:Wi};let pe=null,yr=[],ii;const ws=new Map,dt={_hold:!1,set hold(s){this._hold=s},get hold(){return this._hold},get(){return pe},set(s,t){s!==pe&&(clearTimeout(ii),pe&&pe!==s.parent&&pe.unfocus(),yr.reverse().forEach(e=>e.unfocus()),s!==pe&&(ii=setTimeout(()=>{pe=s,pe.lifecycle.state="focus",t instanceof KeyboardEvent?document.dispatchEvent(new KeyboardEvent("keydown",t)):yr=[]},this.hold?ae.get("holdTimeout",Li):0)))},input(s,t){if(ge.navigating===!0)return;yr=Xi([pe],s);const e=yr.shift();if(e){let r;e[m.inputEvents][s]?r=e[m.inputEvents][s].call(e,t):e[m.inputEvents].any&&(r=e[m.inputEvents].any.call(e,t)),r!==void 0&&ws.set(t.code,r)}}},Xi=(s,t)=>s[0][m.inputEvents]&&(typeof s[0][m.inputEvents][t]=="function"||typeof s[0][m.inputEvents].any=="function")?s:s[0].parent?(s.unshift(s[0].parent),Xi(s,t)):[],We=new Map,Ze=new Map,Ar={registerListener(s,t,e,r=0){let i=We.get(t);i===void 0&&(i=new Map,We.set(t,i));let n=i.get(s);n===void 0&&(n=new Set,i.set(s,n)),n.add({cb:e,priority:r}),Ze.delete(t)},deregisterListener(s,t){let e=We.get(t);e!==void 0&&e.has(s)&&(e.delete(s),We.set(t,e),Ze.delete(t))},executeListeners(s,t){const e=We.get(s);if(e===void 0||e.size===0)return!0;if(Ze.has(s)===!1){const i=[];for(const[n,o]of e)for(const l of o)i.push({...l,component:n});i.sort((n,o)=>o.priority-n.priority),Ze.set(s,i)}const r=Ze.get(s);for(let i=0;i<r.length;i++){const{cb:n,component:o}=r[i];if(n.call(o,t)===!1)return!1}return!0},removeListeners(s){for(const[t,e]of We)e.has(s)&&(e.delete(s),Ze.delete(t),e.size===0&&We.delete(t))}},Fa={focus:{value:function(s){return G.warn("this.focus is deprecated, use this.$focus instead"),this.$focus(s)},writable:!1,enumerable:!0,configurable:!1},$focus:{value:function(s){this[m.state].hasFocus=!0,dt.set(this,s)},writable:!1,enumerable:!0,configurable:!1},unfocus:{value:function(){this[m.state].hasFocus=!1,this.lifecycle.state="unfocus"},writable:!1,enumerable:!0,configurable:!1},destroy:{value:function(){this.eol=!0,this.lifecycle.state="destroy",this.$clearTimeouts(),this.$clearIntervals(),Ar.removeListeners(this),Vi(this[m.children]),this[m.children].length=0,Bs(this[m.effects]),this[m.state]={},this[m.props]={},this[m.computed]=null,this.lifecycle={},this[m.effects].length=0,this.parent=null,this.rootParent=null,this[m.wrapper]=null,this[m.originalState]=null,this[m.slots].length=0,delete this[m.computed],delete this[m.effects],delete this.parent,delete this.rootParent,delete this[m.wrapper],delete this[m.originalState],delete this[m.children],delete this[m.slots],delete this.componentId,delete this[m.id],delete this.ref,this[m.holder].destroy(),this[m.holder]=null,delete this[m.holder],G.debug(`Destroyed component ${this.componentId}`)},writable:!1,enumerable:!0,configurable:!1},[m.removeGlobalEffects]:{value:function(s=[]){Bs(s)},writable:!1,enumerable:!1,configurable:!1},select:{value:function(s){return G.warn("this.select is deprecated, use this.$select instead"),this.$select(s)},writable:!1,enumerable:!0,configurable:!1},$select:{value:function(s){let t=null;return this[m.children].forEach(e=>{Array.isArray(e)?e.forEach(r=>{r.ref===s&&(t=r)}):Object.getPrototypeOf(e)===Object.prototype?Object.keys(e).forEach(r=>{e[r].ref===s&&(t=e[r])}):e.ref===s&&(t=e)}),t},writable:!1,enumerable:!0,configurable:!1},trigger:{value:function(s){return G.warn("this.trigger is deprecated, use this.$trigger instead"),this.$trigger(s)},writable:!1,enumerable:!0,configurable:!1},$trigger:{value:function(s){let t=this[m.originalState];if(s.indexOf(".")>-1){const e=s.split(".");s=e.pop(e);for(let r=0;r<e.length;r++)t=t[e[r]]}gt(t,s,!0)},writable:!1,enumerable:!0,configurable:!1},shader:{value:function(s,t){return{type:s,props:t}},writable:!1,enumerable:!0,configurable:!1}},Vi=function(s){for(let t=0;t<s.length;t++){if(!s[t])return;s[t].destroy&&typeof s[t].destroy=="function"?s[t].destroy():Object.getPrototypeOf(s[t])===Object.prototype&&Vi(Object.values(s[t])),s[t]=null}s.length=0},Oa={$setTimeout:{value:function(s,t,...e){if(this.eol===!0)return;const r=setTimeout(()=>{this[m.timeouts]=this[m.timeouts].filter(i=>i!==r),s.apply(null,e)},t,e);return this[m.timeouts].push(r),r},writable:!1,enumerable:!0,configurable:!1},$clearTimeout:{value:function(s){this[m.timeouts].indexOf(s)>-1&&(this[m.timeouts]=this[m.timeouts].filter(t=>t!==s),clearTimeout(s))},writable:!1,enumerable:!0,configurable:!1},$clearTimeouts:{value:function(){for(let s=0;s<this[m.timeouts].length;s++)clearTimeout(this[m.timeouts][s]);this[m.timeouts]=[]},writable:!1,enumerable:!0,configurable:!1},$setInterval:{value:function(s,t,...e){if(this.eol===!0)return;const r=setInterval(()=>s.apply(null,e),t,e);return this[m.intervals].push(r),r},writable:!1,enumerable:!0,configurable:!1},$clearInterval:{value:function(s){this[m.intervals].indexOf(s)>-1&&(this[m.intervals]=this[m.intervals].filter(t=>t!==s),clearInterval(s))},writable:!1,enumerable:!0,configurable:!1},$clearIntervals:{value:function(){for(let s=0;s<this[m.intervals].length;s++)clearInterval(this[m.intervals][s]);this[m.intervals]=[]},writable:!1,enumerable:!0,configurable:!1}},Ua={$emit:{value:function(s,t){return Ar.executeListeners(s,t)},writable:!1,enumerable:!0,configurable:!1},$listen:{value:function(s,t,e=0){this.eol!==!0&&Ar.registerListener(this,s,t,e)},writable:!1,enumerable:!0,configurable:!1},$unlisten:{value:function(s){Ar.deregisterListener(this,s)},writable:!1,enumerable:!0,configurable:!1}},$a={$router:{value:{to:Ft,back:Wi,get currentRoute(){return Ue},get routes(){return this[m.routes]},get navigating(){return ge.navigating},state:ge},writable:!1,enumerable:!0,configurable:!1}},Da={$announcer:{value:Er,writable:!1,enumerable:!0,configurable:!1}},Na={$size:{value:function(s={w:0,h:0}){this[m.holder].set("w",s.w||0),this[m.holder].set("h",s.h||0)},writable:!1,enumerable:!0,configurable:!1},[m.renderer]:{value:()=>Or,writable:!1,enumerable:!0,configurable:!1},[m.getChildren]:{value(){const s=this.rootParent||this.parent;return(this[m.children]||[]).concat(s&&s[m.getChildren]().map(t=>Object.getPrototypeOf(t)===Object.prototype?Object.values(t).map(e=>(e.forComponent=e[Symbol.for("config")]&&e[Symbol.for("config")].parent.component,e)):t).flat().filter(t=>{if(t&&t.component)return t.component&&t.component.componentId===this.componentId||t.forComponent&&t.forComponent.componentId===this.componentId})||[])},writable:!1,enumerable:!0,configurable:!1}},Gi={...Ua,...$a,...Da},Xe=Object.defineProperties({[m.launched]:!1},{...Fa,...Oa,...Gi,...Na}),za={cast:s=>s,required:!1},Wa=(s,t=[])=>{t.indexOf("ref")===-1&&t.push("ref"),s[m.propKeys]=[];const e=t.length;for(let r=0;r<e;r++){const i={...za,...typeof t[r]=="object"?t[r]:{key:t[r]}};s[m.propKeys].push(i.key),Object.defineProperty(s,i.key,{get(){const n=i.cast(this[m.props]!==void 0&&i.key in this[m.props]?this[m.props][i.key]:"default"in i?i.default:void 0);return i.required===!0&&n===void 0&&G.warn(`${i.key} is required`),n},set(n){G.warn(`Warning! Avoid mutating props directly (prop "${i.key}" in component "${this.componentId}")`),this[m.props][i.key]=n}})}},Xa=(s,t)=>{s[m.methodKeys]=[];for(let e in t)s[m.propKeys]&&s[m.propKeys].indexOf(e)>-1?G.error(`${e} already exists as a prop`):(typeof t[e]!="function"&&G.warn(`${e} is not a function`),s[m.methodKeys].push(e),s[e]=t[e])},Va=(s,t=()=>{})=>{Object.defineProperty(s,m.stateKeys,{value:[],enumerable:!1,configurable:!1,writable:!1});const e=Object.keys(t.apply(s)||{});e.push(["hasFocus"]);const r=e.length;for(let i=0;i<r;i++){const n=e[i];s[m.propKeys]!==void 0&&s[m.propKeys].indexOf(n)>-1&&G.error(`State ${n} already exists as a prop`),s[m.methodKeys]!==void 0&&s[m.methodKeys].indexOf(n)>-1&&G.error(`State ${n} already exists as a method`),s[m.stateKeys].push(n),Object.defineProperty(s,n,{get(){return this[m.state][n]},set(o){this[m.state][n]=o}})}},Ga=(s,t)=>{s[m.computedKeys]=[];for(let e in t)s[m.stateKeys]&&s[m.stateKeys].indexOf(e)>-1?G.error(`${e} already exists as a state variable`):s[m.propKeys]&&s[m.propKeys].indexOf(e)>-1?G.error(`${e} already exists as a prop`):s[m.methodKeys]&&s[m.methodKeys].indexOf(e)>-1?G.error(`${e} already exists as a method`):(typeof t[e]!="function"&&G.warn(`${e} is not a function`),s[m.computedKeys].push(e),Object.defineProperty(s,e,{get(){return t[e].apply(this)}}))},Ya=(s,t)=>{s[m.inputEvents]=[],Object.keys(t).forEach(e=>{typeof t[e]!="function"&&G.warn(`${t[e]} is not a function`),s[m.inputEvents][e]=t[e]})},Ha=(s,t)=>{let e=t;Array.isArray(t)===!1&&(s[m.routerHooks]=t.hooks,e=t.routes),s[m.routes]=[],Object.keys(e).forEach(r=>{s[m.routes][r]={...e[r],options:{inHistory:!0,...e[r].options}}})},Ka=(s,t)=>{s[m.watchKeys]=[],s[m.watchers]={};for(let e in t)typeof t[e]!="function"&&console.warn(`${e} is not a function`),s[m.watchKeys].push(e),s[m.watchers][e]=function(r,i){t[e].call(this,r,i)}};let ja=0;function qa(s,t){s[m.identifier]=++ja,Sn(t.hooks,s[m.identifier]),Wa(s,t.props),t.methods&&Xa(s,t.methods),Va(s,t.state),t.computed&&Ga(s,t.computed),t.watch&&Ka(s,t.watch);const e=t.router!==void 0?t.router:t.routes;return e!==void 0&&Ha(s,e),t.input&&Ya(s,t.input),s}const Qa=()=>St("Circle",{code:{render:function(t,e,r,i,n,o,l){const a=[],c={};return a[0]=this.element({parent:t||"root"},e),c.color=e.color,c.w=e.size,c.h=e.size,c.effects=[e.shader("radius",{radius:e.radius})],a[0].populate(c),a},effects:[function(t,e,r,i,n,o){e[0].set("color",t.color)},function(t,e,r,i,n,o){e[0].set("w",t.size)},function(t,e,r,i,n,o){e[0].set("h",t.size)},function(t,e,r,i,n,o){e[0].set("effects",[t.shader("radius",{radius:t.radius})])}],context:{}},props:[{key:"size",default:40},"color"],computed:{radius(){return this.size/2}}});let rs=null;const Za=()=>St("RouterView",{code:{render:function(t,e,r,i,n,o,l){const a=[],c={};return a[0]=this.element({parent:t||"root"},e),c.w=t.node.width*(100/100),c.height=t.node.height*(100/100),a[0].populate(c),a},effects:[],context:{}},state(){return{activeView:null}},hooks:{ready(){rs=()=>ts.navigate.apply(this),ts.navigate.apply(this),window.addEventListener("hashchange",rs)},destroy(){window.removeEventListener("hashchange",rs,!1)},focus(){this.activeView&&this.activeView.$focus()}},input:{back(s){ts.back.call(this)===!1&&this.parent.$focus(s)}}}),Ja=()=>St("Sprite",{code:{render:function(t,e,r,i,n,o,l){const a=[],c={};return a[0]=this.element({parent:t||"root"},e),c.w=t.node.width*(100/100),c.h=t.node.height*(100/100),c.texture=e.texture,c.color=e.color,a[0].populate(c),a},effects:[function(t,e,r,i,n,o){e[0].set("texture",t.texture)},function(t,e,r,i,n,o){e[0].set("color",t.color)}],context:{}},props:["image","map","frame","color"],state(){return{spriteTexture:null}},computed:{texture(){const s="frames"in this.map?Object.assign({},this.map.defaults||{},this.map.frames[this.frame]):this.map[this.frame];if(this.spriteTexture!==null&&s)return this[m.renderer]().createTexture("SubTexture",{texture:this.spriteTexture,x:s.x,y:s.y,width:s.w,height:s.h})}},hooks:{ready(){this.spriteTexture=this[m.renderer]().createTexture("ImageTexture",{src:this.image})}}}),el="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaMAAAAbCAYAAADRe+BYAAAAAXNSR0IArs4c6QAAGn9JREFUeF7tXQ1UVdWePxcWFg7ZA0sym5n0Tmk1z4+0YeVU4yo1h1jvPVBo1ETU8QvTdJlhsmKpi0he5jyXX0CKIWkpl3OlME3RGcdJixVEas+nJtq0sMwXN/kIgbxn1m+791n/ezifF0hr7lmrVV3O2Wfv/977//v//h/7uKTQFZJASAIhCYQkEJLADZaAy+j9iqIMkCRpliRJGeSeWkmSClwuV25X9VtRlOGSJI3m7wq6bd5Osqa/6OZSSZJKXC4X+h7UpSgKZABZQCbiKuHt4t+dvri8z5GG3E77rChKtCRJ9TY647ht0aaiKJAx5LCK/4Y5m23jneotiqJgvg84eCaYd6Cf4h/xqgo+ZwUO3h1wK5cx1oIYP/5eJUlSrsvl6tRakGUZbYr9tjQpKanL9lmw4w09F5LAzyUBXTDiih3KAspN76pwuVxjgu2koijYzGibbmg0tzQYoOPt5Zv0xydJ0hiXywWlYfviAAE5UBDSPu9YUep1QFEUvAdKWlyOAYPP26c2BhhM25ivXZo+4lWOxx8EGEHRw6iwdXHjQbu26LMwTlJsNUZusrEeHMuC9kGWZRgSYs/VJiUluZ32MXR/SAK/VAkYgREsdKaAKysr58fFxd0Di23Xrl1ScjKMTUl69913906cODHe6cDNFAVvcyAUHCxNO21rGIVv7969ufHx8djQGatWrZIyMq4bmj6frz4mJuYRSZJsMyQNQJS43e4/19bWThk+fPiA/Px8afhwkDpJKikpKUhJSXHEDujY9MDU7XZLtbWsq1BItvrMWQsAQxozZoxUUQEiYHrZapuzAYCcAOWSnJycv2RmZjZThiRJklMZGDIkyHfWLNgskkRkgXVh+g4N0NUuWLCgYN26dcMHDBiQjPUr5qyoqOjttLS0KVYC0syTui/q6+tX9O7duyU6OnoV2h09+rodEexakGUZG4vNnbiWL18uHT9+HCBsay84Gcv/13s9Hs/osLAwlZW7XK6KxMRES8Pa6/Ue4GuLic7v94+ZMGGC5Qb7OeXcXWMrLS3Nd7lcs+zKKtgxdwAjupnPnDlTNHDgwN9RhlRfXy9FR0dDuUsxMTGYDMuJ1GxooAO0eNWgQYNaX3jhhcfnzp2bhHuWLl0q5eayfWd7AyqKoro2uIJ5jr7vwIEDqqKIi4trqKysfJK7VUxlRl1ebW1tX99yyy3tlCFB+aBtroCklJQUS0Wp90L+Hii5ABYaJBhBtowRjBgxQqqqsiSCdsEISpJZIZcuXVp01113PaPHkKyAQmf8umCE9XXu3Dm2zgCoAFZ+YXGYMiS6HjZt2iSnp6eztYVLZ87gVrPFkCjQX758+d0+ffr8k1gP6Oenn34qDRgwgBkQbrfb8VqQZVnIGCyerYX9+/dLeXl5MERuSoYky7JiU/GoLE+r1A2eh4cEIKG7gD0ez4CwsDCsxwD2qygKmGlFUlKSobtUq7A5sLgnTJhgaPDx91EX+i8CjLpqbHSeXS7XCKN5sbkWDG/TAyNVuSckJHyzZ8+evvxpbNoSRVHgDmMmK1d4toFD0wumOGH9wgruBBip7q2YmBgGkiBCXDGiv6qCnj17tlRQUGBrc5PYgJSZmTk1JyfnAd5/LPTZBESowoTV7igeoSiKUEK1ly5dCo+Njf17vKezYERkAU0etAVHjZPm5uaiqKioxylD4uMNun0DgFbnbNq0aXveeustgB8TixVLpOuTsEPMeYqiKFgXTKkQkLM1ZxTkNPuCrf8rV678qVevXi+QfWGrXdxfXl4e3dbWxmJ933zzzbHz588/OnLkSKmpqUlKT0/Hv9U51CjGDq482hZk1aNHjxEJCQlsU3D2JYxB/MRiXTQG6Pf7TRUzna9uBCPxmg5xM1mW1bVhovxKkpKSdI0MPTAqLi6WvF6voWGt907OWtGFTu2vzipw+nx3jU0wo6+++qpu0aJF/bg+cURC7IxTD4xUK5goRNUipco9JSUFbgks9Bg7L9MBo+EbN24M7wwzIm3S4K+qCKgSIcpphB12xNumSQEqkFElDTYHVgewtmtp42ZqbX/99dfTzp07VzBq1KiIToCRaii4XOrUOhlrh2mk8nv66acr9u/fL+JatpWtk7VBmaLf778QHh5+O2cKtli4jvGB17O+0jkrKCiQYJzYnTMKcnpuQ+pqdWL0cJBQFeybb7557Nq1a4/OmTOHiS0vLw8MKYBpERYlaS1VjbsvNykpiS1MCyWOdc1csMGCUVKSSkDNprvW6/XWCncXUejqM2PHjpXE2PFjdXX10uzsbOYu0Shb39mzZ7MyMjL+BkYt5mTKlCnS4MGDWVunTp0qy8zM/IO2M3oKGyx8yZIlbNvpGTuyLMNFfd0nz69fChh18dgoE+6UXtFbJHpgpDINsulU9DfY7EF3jG7iYNx0ZFA0AQDg6KOK7erVqy2RkZGR/H4nihRgdD14cZ1xCaUGxT/A7/dfue+++27n8R1bCpMDEdoVcRgE1OH2SxaxhyCZEZMBxrpt27ZIEXPhfQdQMjeGQ3BgG7G9vb0pPj4+Cm2KuCFvJ6ikE6M+0PWgcbPZskDpnGNOYDBVVVWNURQFCheGFlMqRL625syAcdF9gTXCKD5Zx7b2hVB2iqL8MHXq1N+gjW3btjERcWWCdQdFyRiO1+udxfsjcateBSuakQcFi+fvvffeD9asWSPiu779+/e/lZeX9wRkAcUPABDX3Llz4Yo1VMx03igz6iowQvsUkI4fPy4tX76csU8Kwh6PZ/uOHTsm0/5ERUVJGzdulPBvXDNmzCjz+XwBgETBCOOMjY1l93JZdfDyeL3e4YqisKSgpqam+qioKGZ43+xg1E1jE8aurT3jRM/gXrtgpFoMBmDEXHhOX86Vst4mDtb1F9AFatVv3br18PTp0/+F32BLsdHGqDIiv1ekpqZuKy4uvq45rrs8bGV9kb75EhMTs3bv3r2OxreCBCM1wG4yFylOUpAVRWHWUEtLy9XIyMhbDdqtgoUezPxrn1EUhY0BivmOO+6Q6uvroZxtuVZFW8gqrKurK+vXrx9cCtqrdv369fnz588XSQG24jt03RNWRfeFyswJGFkaPVTZnT9//sTixYt/iw5v2LDhWN++fR8lilJti7riuLJWvRMiI6+xsVEFtldffbXsgQce+D3a2rdvn1xQUBBAY15//XUGzri6AIwMy0XQPo0ZGSl0Oj64KlNTU/FoCgdaxuBIP1WXPH7Pz88vvfPOO9n4Vq9eLR09ejRgT1Iw8nq9UmJiIhs3/ru4uBhuy4B1TMF93759344bN+4u3K/Xd85KA8oJYPwhlkXjWBp21sHVKsuyuo9RNpGYmGjL9d9dY6P9SUpKYvNL3cUYn6IoyHjNQKID2XCOyhO6CowsN52RoupCZhTwCtruTz/9VBMREYFYDNhIUG5FPTACW5gxY0ZzcXExzCu0i4VsmflG3UU8KwtZXQOqq6svDRs2jJlqQYIR3D0Zp0+fDp88eXKvqqoq9KkkIyNjFjILcTU3N7c9+eSTz1ZWVu62Ag9t7RMSItLT05EEMn7o0KGLNm/eHC+y04LNrqR9oG7L3bt3y4mJiUJpOlpfkK/f738zLCzsXu0YwWRnzpz5fWFhocgMtIxDoQ1togkHHGbUUKMH9zph+FTZbdiwofbgwYPol2/Lli0ro6Oj/8NIUVKWAGXd1NQ0AgpVWPFQnAUFBVCcPlmWsSYZI+T34j9VJU4B4mYAI3ROh3VV8PExNzF3XzKQ0jGEsc9pUhDzlHAlqmbTgVUOGTKEufbAJDB2vofVxAkB7j/88EPF+++/PxquQD0wEnEVkz0VoJg196t/o6wX4zKKfem9h4JRV47NCox4yAPrtkMpEIBq/PjxtrJsf5VgpEnv9Y0cOXLXsWPHhEA6y7ryR48ezZS7UMRz5sw5kZ+fD3eAJRBxxSYsHzAKUF6AiK+xsfHPUVFR/xwsGJEF2oEh0VRpriwt2SwFI7i8kLDiu54hwhYdssfgBsLFs8g6WJZWgKcBI9XVOnDgwK/PnDnzt1yJqC4qq/ZorVVTU9Op+Ph46ciRIw+gr5CBcIOmpqZeKi4uRualbbclBUudfqhxFx4zYrhklZYtlJ3f729IS0vrBSYAJVReXj5bJDUQdqC6/ajS4gxgqSzLeJZZHcJFB9esLMvMWqVsScTRONipacs3AxhRpUpiHj6v17tUuCcJIBkZE2r8lAKWVmE3NzerMSrOdlQmRe997733Prxy5crTemDk9XrB5JmLFvt50aJF2y9cuBDvdruTX3zxRdUVuGrVqvmVlZXrcR/YX0tLy/+Gh4dHYX7nzZt34Z133nm4ra1NgKjv+eefb7p48SL2AC5Lg6w7xob9oQEj1hmPx+MOCwtTMwyPHj0qFRYWFtXX168cMWLE6wsWLEgS7tL09PQV33777XKrvfurAyNt4eeMGTNyCgsLl3FBdEpZ8jbYIqeK+LPPPrv28MMPT7TjqqTunldeeSU9Ozt7I28XGw1WH7P8gmFGZLIZQ+LgiEVcpRO8D4hD6C0UCkaaFGvIkbXb0tJy4tZbb/1HPM8z+CwVsMG71DTv48ePVwwZMkQkSjhqj9aGpaamphYXF2MTMBZEU8YvXLjg79+//7/ZmTPa39OnT//hiy++2JmYmNgDv6N+LTo6+mVaxE3S6k37TpMNvvzyy7+89NJLg/i7mKFA2Y/W5URdWTwFvMrr9SJOOhqxjdTUVJFUBPcWq186ffp0w8svv9yLv0NlC13BjEwUTYAbyspNx2WCPcYMHsKAmK7XnFIhtbe3/xgREbHS7/eXmKVni/5pXVlgW1u2bGmJiIiI1KbSE/biS01NdT333HO/EfE16qaTZRl9ZWtsyZIlQ8+dO4d1xS64AQWA8bGoa4IaFHh3ZGTk3scff/xf8dwnn3wi5+bmCs+ArcSo7hibHTAirBJ6gTEkjFm4QPnatXSH282m040Z8Ww6W6httFi70k2nPTli/fr1GSQ2YNuNZoXg4u/Nzc0Xe/bsyVLfefaaKdtwcFyP2oUDBw6kjh07tthun0zkjEXCLJmSkhIW2Ley3Gl/CRiBAcBCZ24PnSwzR/Ed0V/aTkpKSnVJScnD/G+23GikHRbjunr1al1kZKSIGang2djY+D8a9mnJEHVk2qFAVRSEX7lyBSAXxksMTK1ZCjZW8wvLc/Xq1QEuZvG8SAEXSQ8ffPDBic2bNyP2xO4XLi+iNALm6EaBkdWYz58/v3Px4sXP8vtUQ3LatGn5Dz744CwR5yLtwNNQYBZjoQqbg4/0xhtvnOjfv/9vCQNl7lfBWuvq6vbMnz//GZrsYRDvUuPfnHGneL3eZE2yCbqrrumdO3f+V0REhIhls6EoinJh/PjxIovUtt7qrrFZMSMetxTTwEpfOBtnLJ0YFKoBpDf3pnVGBGwoGKmp38QCtKSQ3Q1G3IpH1guzqD766KOcxx57TDAi/GQrs4koNXFmHn4S7rSAYYhgOwEjU+alc/6c1X5Ehp0tMOLMR6Sf4rimgIJBg7RmS2uFxyCG8yJn9Dcgk4YyEVLbZLrotIOmcvnuu++qY2NjBRBZ9k+nLQZGFy9ebOnXr5/InqTrV5stGhR4kvMUkylLPnLkSOUTTzyBgljTNaepB7JcB7iBx3tU8KTMCjECYYFnZGQ0nD17FgyIyY+mJvM2AuawK8DIRjYdk7PNotdcj8fTtmPHjudJHEKrY5DOnYF4Dyxw4RLie7EiIiIiRdRXUeHqKewJEyaUTZo0iSV4CCtelmXIiDHKDRs27Dl48OAz8+bNa33qqaduwW96YJSVlfV2bGxsXN++ff9Bb0J55iP+pI6FJrCIZwoLCzeXl5f/O/9/256B7hqbAzBS9xItJbCI76miMj2BwSBriJ2fxY/XUV0BTt0dROl3OptOe2bY559/vm7o0KGIB4iAWjDZc1Ds4py3DmfxUQV64sSJ1sGDB7NFqpehqLMwdQ80NcimE4+bjkETz+hwRhplHiTAbkn/deq0VEWmiSn91e1238E765TNqP7911577ciyZctQWIsrmHlTa0K4q5PWhqmB7aampvbbbruN1XTZKaY1QwsKyMOGDfugpqYGadSmblC6WQmT6fAa6u7gykydMw5oLMYAqx4KuaGhoTYtLU0kZwgLX83044ohAIApWHVBzMhIVB3ASK/OyOBhoyxVcTDycIASAFHUGV2+fPnU7NmzH9S2p6eweVwNbUULBsrBCL/5ONBG5+Tk1A4aNIjJloJReXl5VVtbG4ycgFok7bsJGAUADJU/Ya943JGh1B1js+OmI8xI1Q0GYGRKWozOplM3NGdH4vQFlRWtXbv2xMKFC1kaqlPWQSeps2467blptbW1f3S73TNNLCozvRLwN8p8uMWbybOnsOigQNniW7hw4V/Xrl0rFLFpait/geoyoy/sDBihHdpfnt32Co8XqUWVyACMjY2N4m4kS+ZBs8jwzMSJE5s+/PDD2zgQqXU7mZmZp8gpFbaZEW2fH7skArZB1TLQmByy/yZNmoREiL/j71EPevV4PHXJycnCjecIPMWcaU9z52vvJf53U9lSBUSSDTqsTQAqUq9xkWC+Kl+tq+/QoUOH169fD7eP6tKjabgALQDS0aNHWRvaLDAKRvw5duaV3llsBnVGwaR2G+1JgBDWgVWSifBiZGzatCla1A5lZWVVnjx5cpxwKeMlVGETJYokD8iLHWQJGWzatIn1iRfPMta0devW6ttvv52xdgpGpaWlySKlGQkMa9asOYWkGbBnWjOlB0Z6ZxISJuHIGOuOsd0MYIQiR/gyr1ePdbzAFLAAYGk6Qm9tU10ARnaOB1Ff6yJHE1ihEmJQ165dOxQeHi6Cvh0eqaury7/nnntEpl6nEiSohR1MAgP629TUtCcqKup6JV/Hy5eQkPCfe/bsEYFRWy4Aq1O2OyMDCh55eXmVc+fOFS6uzrh+aSZVBym0trYevvvuu4fwGiZHqf4mspjtcrlgSYvEC0OAo66Z77//vm7mzJkCFHXnQwe41Pu0yoy46ALYhCZl2HDpUzAqLS1V60b0UnS7EIwsla5mnIYpz+vWrSvv168fOz6KK/UAo8ZIYXu9XtTKME8IQEowrJUrV1bU1NRgTpHNJxKBAsBIlmVWAI9n09LSahoaGoYKAdsAI5H56vvxxx979ezZM1xk1zU2Nva30lH0790xthsORhggLN+cnJz/XrZsGS0cFN8zAhBdP77bRvqqmUBvZjDicohesWLFl1OmTIlBbIBcBTt27KiZPHnyDELPg1ag/F16p184strBANDfBQsWxCB7jFxLR40aFXP48GFhuVtm09GHy8rKhp09e/bo4sWLaeFrRWVlZVlcXFxaMDKgrKgzRa566ys7O/vtuLi4ySKVm99TVV9fX967d2+kzwvQsGSHtH0NGDGr3e12R+I0d3JmnynIUzZSWlpat337drHHdOOa1OUhMudEcSZ11RHmhC53UPBZWVlTwsLCtglFC5der169cIIGTnRg8jBiRgZFnurxMCRmFAwzsgQjTYzN16NHD7deTIjGpHj8B8NS5WqgsBlg0dgIHmpvbz/57LPPskxRpOhzI4LJSZNNB8Yd3dra2jpx4kThrkebSLfH/SyQr2VGdF5ramq2f/zxx5PFUUh8nh3pk+4Y200BRnwCADqm3zVyemq3CTDRTBRbFrumLUcMyWZsR7zCSg5ssdo9fcEMnPnf6NFGjsCIzBs2iNF3mNj3nRyczye6bPVRvM7IgM5fMPOvJ1ZThiQynqgbx8bcWMnCiQKhcUk7rJqekaYFLno2oxnbo/uMjYWewECKYum6o3KkRw/9bGCEflLlDeA9dOjQsb17947E3wBWra2tq4S7rKGhgdVt8clS58RCYQfokLKysi+LiopEMgKKilfpnKsHEINMmXFOAAdZjAEfYaRg5PF4SkidTu3UqVPDGhsb783Ly/P36dMnDG1xlovCbXHQrehfLXebBtQ1dsfYuhqMPB5PBf+EB3RTQCGw3fiG9rh2xpCsCvocbGzcejODEfonzqjTfvEVckBQ2cqv7UQcnQUj2l8sYEqR2Jdv7Rbo6nRa7wvAGLuQg5NxintpxbwjxmbjZVi7mDP64UIofsigM98JosAs4hqQAVMcNi+q5O0AMFWWWkZH+9PBKOBuLgT5MW7ci7ZGI74i4iN1dXUN8+fPFwqcghFtW2UxP6ebTshz+/btf4qMjGSno5tcvqysrLMnT54ULl81A9FMYWs/FUGAmRkKRjVSvL7LyGhXi6H5kUPo9lKv1ztaABs9oikhIWHz9OnTWSYdZ7oU/E2PCeqOsXU1GPFTNMSHUANq0OyAkc19FbotJIGQBG5GCXAlK8oe6NEzOARUTcQpKir6qqysjH3ChJ/EbwqsNwKM0LGHHnoo9/77739Jm9INpt/Y2Fg+depU1P6JM9ICYtpmChttC8DR1M4wQ8GsYBcyrqqqOvDII48wb0R7ezsKaVf06NGjQJykITLlZs2aJY8bN47FbTWuQFbD5/V6dwmg4myKsWDBDFHUvGTJkphLly7hfhgHjCF119gcpHZbZtNRZrRz5876nTt3IpGGyTcERjej9gj1KSSBLpQAXFjt7e2qgtNruqGh4d20tDRxcoAdlyFthn5awK5OoezfMmak02fqljSSlpk7Wsts6fd5tNmu2uxQo76bufNVhqRx6dO2qIuX9k87H/S4Lz23cHeMjZE14voX80xlpZcBS9k87Sv1hDGDwe7C6cKtEWoqJIGQBG6EBHJzc5+vr69/Iy4ujh1lxK+S6urqquzsbLgzRZ2Mk7gXmrkRYIT3QhGKWiPqirbjhjVT2GhbgISegjUDUvQJCph+dgZuU7jb2AcUSQYyVch6BgB9D3XjqrEjyozInHbX2LoSjCAnjI/FjkLM6EZohNA7QxK4cRKAwlZrrQy64Si78MYNJfTmX5sEQszo1zajofGEJGAtAfHNHVGegSeQ2CD+sW4hdEdIAl0sgRAYdbFAQ82FJBCSQEgCIQk4l0AIjJzLLPRESAIhCYQkEJJAF0vg/wBMng85iZWBHAAAAABJRU5ErkJggg==",tl=()=>St("FPScounter",{code:{render:function(t,e,r,i,n,o,l){const a=[];let c,u,d,h=!1,p=0;const g={};a[0]=this.element({parent:t||"root"},h===!0?d:e),a[0].populate(g),h===!0&&(p-=1),t=a[0];const x={};a[1]=this.element({parent:t||"root"},h===!0?d:e),x.y=15,x.x=20,a[1].populate(x),h===!0&&(p-=1),t=a[1];const T={};a[2]=this.element({parent:t||"root"},h===!0?d:e),a[2].populate(T),h===!0&&(p-=1);const y=r.components&&r.components.Sprite||i.Sprite;t=a[2];const S={};a[3]=this.element({parent:t||"root"},h===!0?d:e),S.image=e.image,S.w=43,S.h=25,S.map=e.sprite,S.frame="fps";const v=[];if(typeof y<"u")for(let F in y[Symbol.for("config")].props)delete S[y[Symbol.for("config")].props[F]],v.push(y[Symbol.for("config")].props[F]);a[3].populate(S),h===!0&&(p-=1),t=a[3];const C={};C.image=e.image,C.w=43,C.h=25,C.map=e.sprite,C.frame="fps",c=C.is||"Sprite";let $;if(typeof c=="string"){if($=r.components&&r.components[c]||i[c],!$)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&($=c);a[4]=$.call(null,{props:C},a[3],e),a[4][Symbol.for("slots")][0]?(t=a[4][Symbol.for("slots")][0],d=a[4],h=!0):t=a[4][Symbol.for("children")][0],h===!0&&p===0&&(h=!1),t=a[2];const A={};a[5]=this.element({parent:t||"root"},h===!0?d:e),A.x=58,A.y=2,a[5].populate(A),h===!0&&(p-=1);const M=r.components&&r.components.Sprite||i.Sprite;t=a[5];const L={};a[6]=this.element({parent:t||"root"},h===!0?d:e),L.image=e.image,L.x=0,L.h=20,L.w=20,L.map=e.sprite,L.frame=e.fps[0];const W=[];if(typeof M<"u")for(let F in M[Symbol.for("config")].props)delete L[M[Symbol.for("config")].props[F]],W.push(M[Symbol.for("config")].props[F]);a[6].populate(L),h===!0&&(p-=1),t=a[6];const k={};k.image=e.image,k.x=0,k.h=20,k.w=20,k.map=e.sprite,u=e.fps[0],Array.isArray(u)===!0&&(u=o(u).slice(0)),k.frame=u,c=k.is||"Sprite";let B;if(typeof c=="string"){if(B=r.components&&r.components[c]||i[c],!B)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(B=c);a[7]=B.call(null,{props:k},a[6],e),a[7][Symbol.for("slots")][0]?(t=a[7][Symbol.for("slots")][0],d=a[7],h=!0):t=a[7][Symbol.for("children")][0],h===!0&&p===0&&(h=!1);const I=r.components&&r.components.Sprite||i.Sprite;t=a[5];const P={};a[8]=this.element({parent:t||"root"},h===!0?d:e),P.image=e.image,P.x=18,P.h=20,P.w=20,P.map=e.sprite,P.frame=e.fps[1];const O=[];if(typeof I<"u")for(let F in I[Symbol.for("config")].props)delete P[I[Symbol.for("config")].props[F]],O.push(I[Symbol.for("config")].props[F]);a[8].populate(P),h===!0&&(p-=1),t=a[8];const _={};_.image=e.image,_.x=18,_.h=20,_.w=20,_.map=e.sprite,u=e.fps[1],Array.isArray(u)===!0&&(u=o(u).slice(0)),_.frame=u,c=_.is||"Sprite";let w;if(typeof c=="string"){if(w=r.components&&r.components[c]||i[c],!w)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(w=c);a[9]=w.call(null,{props:_},a[8],e),a[9][Symbol.for("slots")][0]?(t=a[9][Symbol.for("slots")][0],d=a[9],h=!0):t=a[9][Symbol.for("children")][0],h===!0&&p===0&&(h=!1);const E=r.components&&r.components.Sprite||i.Sprite;t=a[5];const N={};a[10]=this.element({parent:t||"root"},h===!0?d:e),N.image=e.image,N.x=36,N.h=20,N.w=20,N.map=e.sprite,N.frame=e.fps[2];const X=[];if(typeof E<"u")for(let F in E[Symbol.for("config")].props)delete N[E[Symbol.for("config")].props[F]],X.push(E[Symbol.for("config")].props[F]);a[10].populate(N),h===!0&&(p-=1),t=a[10];const z={};z.image=e.image,z.x=36,z.h=20,z.w=20,z.map=e.sprite,u=e.fps[2],Array.isArray(u)===!0&&(u=o(u).slice(0)),z.frame=u,c=z.is||"Sprite";let V;if(typeof c=="string"){if(V=r.components&&r.components[c]||i[c],!V)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(V=c);a[11]=V.call(null,{props:z},a[10],e),a[11][Symbol.for("slots")][0]?(t=a[11][Symbol.for("slots")][0],d=a[11],h=!0):t=a[11][Symbol.for("children")][0],h===!0&&p===0&&(h=!1),t=a[1];const D={};a[12]=this.element({parent:t||"root"},h===!0?d:e),D.x=150,a[12].populate(D),h===!0&&(p-=1);const j=r.components&&r.components.Sprite||i.Sprite;t=a[12];const ee={};a[13]=this.element({parent:t||"root"},h===!0?d:e),ee.image=e.image,ee.y=2,ee.w=48,ee.h=25,ee.map=e.sprite,ee.frame="avg";const re=[];if(typeof j<"u")for(let F in j[Symbol.for("config")].props)delete ee[j[Symbol.for("config")].props[F]],re.push(j[Symbol.for("config")].props[F]);a[13].populate(ee),h===!0&&(p-=1),t=a[13];const K={};K.image=e.image,K.y=2,K.w=48,K.h=25,K.map=e.sprite,K.frame="avg",c=K.is||"Sprite";let te;if(typeof c=="string"){if(te=r.components&&r.components[c]||i[c],!te)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(te=c);a[14]=te.call(null,{props:K},a[13],e),a[14][Symbol.for("slots")][0]?(t=a[14][Symbol.for("slots")][0],d=a[14],h=!0):t=a[14][Symbol.for("children")][0],h===!0&&p===0&&(h=!1),t=a[12];const q={};a[15]=this.element({parent:t||"root"},h===!0?d:e),q.x=63,q.y=2,a[15].populate(q),h===!0&&(p-=1);const he=r.components&&r.components.Sprite||i.Sprite;t=a[15];const se={};a[16]=this.element({parent:t||"root"},h===!0?d:e),se.image=e.image,se.x=0,se.h=20,se.w=20,se.map=e.sprite,se.frame=e.avgFps[0];const fe=[];if(typeof he<"u")for(let F in he[Symbol.for("config")].props)delete se[he[Symbol.for("config")].props[F]],fe.push(he[Symbol.for("config")].props[F]);a[16].populate(se),h===!0&&(p-=1),t=a[16];const Y={};Y.image=e.image,Y.x=0,Y.h=20,Y.w=20,Y.map=e.sprite,u=e.avgFps[0],Array.isArray(u)===!0&&(u=o(u).slice(0)),Y.frame=u,c=Y.is||"Sprite";let je;if(typeof c=="string"){if(je=r.components&&r.components[c]||i[c],!je)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(je=c);a[17]=je.call(null,{props:Y},a[16],e),a[17][Symbol.for("slots")][0]?(t=a[17][Symbol.for("slots")][0],d=a[17],h=!0):t=a[17][Symbol.for("children")][0],h===!0&&p===0&&(h=!1);const ue=r.components&&r.components.Sprite||i.Sprite;t=a[15];const ie={};a[18]=this.element({parent:t||"root"},h===!0?d:e),ie.image=e.image,ie.x=18,ie.h=20,ie.w=20,ie.map=e.sprite,ie.frame=e.avgFps[1];const qe=[];if(typeof ue<"u")for(let F in ue[Symbol.for("config")].props)delete ie[ue[Symbol.for("config")].props[F]],qe.push(ue[Symbol.for("config")].props[F]);a[18].populate(ie),h===!0&&(p-=1),t=a[18];const oe={};oe.image=e.image,oe.x=18,oe.h=20,oe.w=20,oe.map=e.sprite,u=e.avgFps[1],Array.isArray(u)===!0&&(u=o(u).slice(0)),oe.frame=u,c=oe.is||"Sprite";let de;if(typeof c=="string"){if(de=r.components&&r.components[c]||i[c],!de)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(de=c);a[19]=de.call(null,{props:oe},a[18],e),a[19][Symbol.for("slots")][0]?(t=a[19][Symbol.for("slots")][0],d=a[19],h=!0):t=a[19][Symbol.for("children")][0],h===!0&&p===0&&(h=!1);const De=r.components&&r.components.Sprite||i.Sprite;t=a[15];const ce={};a[20]=this.element({parent:t||"root"},h===!0?d:e),ce.image=e.image,ce.x=36,ce.h=20,ce.w=20,ce.map=e.sprite,ce.frame=e.avgFps[2];const Ki=[];if(typeof De<"u")for(let F in De[Symbol.for("config")].props)delete ce[De[Symbol.for("config")].props[F]],Ki.push(De[Symbol.for("config")].props[F]);a[20].populate(ce),h===!0&&(p-=1),t=a[20];const ye={};ye.image=e.image,ye.x=36,ye.h=20,ye.w=20,ye.map=e.sprite,u=e.avgFps[2],Array.isArray(u)===!0&&(u=o(u).slice(0)),ye.frame=u,c=ye.is||"Sprite";let Nt;if(typeof c=="string"){if(Nt=r.components&&r.components[c]||i[c],!Nt)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(Nt=c);a[21]=Nt.call(null,{props:ye},a[20],e),a[21][Symbol.for("slots")][0]?(t=a[21][Symbol.for("slots")][0],d=a[21],h=!0):t=a[21][Symbol.for("children")][0],h===!0&&p===0&&(h=!1),t=a[1];const Wr={};a[22]=this.element({parent:t||"root"},h===!0?d:e),Wr.x=0,Wr.y=40,a[22].populate(Wr),h===!0&&(p-=1);const zt=r.components&&r.components.Sprite||i.Sprite;t=a[22];const Te={};a[23]=this.element({parent:t||"root"},h===!0?d:e),Te.image=e.image,Te.x="-2",Te.w=47,Te.h=25,Te.map=e.sprite,Te.frame="min";const ji=[];if(typeof zt<"u")for(let F in zt[Symbol.for("config")].props)delete Te[zt[Symbol.for("config")].props[F]],ji.push(zt[Symbol.for("config")].props[F]);a[23].populate(Te),h===!0&&(p-=1),t=a[23];const be={};be.image=e.image,be.x="-2",be.w=47,be.h=25,be.map=e.sprite,be.frame="min",c=be.is||"Sprite";let Wt;if(typeof c=="string"){if(Wt=r.components&&r.components[c]||i[c],!Wt)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(Wt=c);a[24]=Wt.call(null,{props:be},a[23],e),a[24][Symbol.for("slots")][0]?(t=a[24][Symbol.for("slots")][0],d=a[24],h=!0):t=a[24][Symbol.for("children")][0],h===!0&&p===0&&(h=!1),t=a[22];const Xr={};a[25]=this.element({parent:t||"root"},h===!0?d:e),Xr.x=58,Xr.y=2,a[25].populate(Xr),h===!0&&(p-=1);const Xt=r.components&&r.components.Sprite||i.Sprite;t=a[25];const Se={};a[26]=this.element({parent:t||"root"},h===!0?d:e),Se.image=e.image,Se.x=0,Se.h=20,Se.w=20,Se.map=e.sprite,Se.frame=e.minFps[0];const qi=[];if(typeof Xt<"u")for(let F in Xt[Symbol.for("config")].props)delete Se[Xt[Symbol.for("config")].props[F]],qi.push(Xt[Symbol.for("config")].props[F]);a[26].populate(Se),h===!0&&(p-=1),t=a[26];const we={};we.image=e.image,we.x=0,we.h=20,we.w=20,we.map=e.sprite,u=e.minFps[0],Array.isArray(u)===!0&&(u=o(u).slice(0)),we.frame=u,c=we.is||"Sprite";let Vt;if(typeof c=="string"){if(Vt=r.components&&r.components[c]||i[c],!Vt)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(Vt=c);a[27]=Vt.call(null,{props:we},a[26],e),a[27][Symbol.for("slots")][0]?(t=a[27][Symbol.for("slots")][0],d=a[27],h=!0):t=a[27][Symbol.for("children")][0],h===!0&&p===0&&(h=!1);const Gt=r.components&&r.components.Sprite||i.Sprite;t=a[25];const ve={};a[28]=this.element({parent:t||"root"},h===!0?d:e),ve.image=e.image,ve.x=18,ve.h=20,ve.w=20,ve.map=e.sprite,ve.frame=e.minFps[1];const Qi=[];if(typeof Gt<"u")for(let F in Gt[Symbol.for("config")].props)delete ve[Gt[Symbol.for("config")].props[F]],Qi.push(Gt[Symbol.for("config")].props[F]);a[28].populate(ve),h===!0&&(p-=1),t=a[28];const Ce={};Ce.image=e.image,Ce.x=18,Ce.h=20,Ce.w=20,Ce.map=e.sprite,u=e.minFps[1],Array.isArray(u)===!0&&(u=o(u).slice(0)),Ce.frame=u,c=Ce.is||"Sprite";let Yt;if(typeof c=="string"){if(Yt=r.components&&r.components[c]||i[c],!Yt)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(Yt=c);a[29]=Yt.call(null,{props:Ce},a[28],e),a[29][Symbol.for("slots")][0]?(t=a[29][Symbol.for("slots")][0],d=a[29],h=!0):t=a[29][Symbol.for("children")][0],h===!0&&p===0&&(h=!1);const Ht=r.components&&r.components.Sprite||i.Sprite;t=a[25];const Re={};a[30]=this.element({parent:t||"root"},h===!0?d:e),Re.image=e.image,Re.x=36,Re.h=20,Re.w=20,Re.map=e.sprite,Re.frame=e.minFps[2];const Zi=[];if(typeof Ht<"u")for(let F in Ht[Symbol.for("config")].props)delete Re[Ht[Symbol.for("config")].props[F]],Zi.push(Ht[Symbol.for("config")].props[F]);a[30].populate(Re),h===!0&&(p-=1),t=a[30];const _e={};_e.image=e.image,_e.x=36,_e.h=20,_e.w=20,_e.map=e.sprite,u=e.minFps[2],Array.isArray(u)===!0&&(u=o(u).slice(0)),_e.frame=u,c=_e.is||"Sprite";let Kt;if(typeof c=="string"){if(Kt=r.components&&r.components[c]||i[c],!Kt)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(Kt=c);a[31]=Kt.call(null,{props:_e},a[30],e),a[31][Symbol.for("slots")][0]?(t=a[31][Symbol.for("slots")][0],d=a[31],h=!0):t=a[31][Symbol.for("children")][0],h===!0&&p===0&&(h=!1),t=a[1];const Vr={};a[32]=this.element({parent:t||"root"},h===!0?d:e),Vr.x=150,Vr.y=40,a[32].populate(Vr),h===!0&&(p-=1);const jt=r.components&&r.components.Sprite||i.Sprite;t=a[32];const Ne={};a[33]=this.element({parent:t||"root"},h===!0?d:e),Ne.image=e.image,Ne.w=53,Ne.h=25,Ne.map=e.sprite,Ne.frame="max";const Ji=[];if(typeof jt<"u")for(let F in jt[Symbol.for("config")].props)delete Ne[jt[Symbol.for("config")].props[F]],Ji.push(jt[Symbol.for("config")].props[F]);a[33].populate(Ne),h===!0&&(p-=1),t=a[33];const ze={};ze.image=e.image,ze.w=53,ze.h=25,ze.map=e.sprite,ze.frame="max",c=ze.is||"Sprite";let qt;if(typeof c=="string"){if(qt=r.components&&r.components[c]||i[c],!qt)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(qt=c);a[34]=qt.call(null,{props:ze},a[33],e),a[34][Symbol.for("slots")][0]?(t=a[34][Symbol.for("slots")][0],d=a[34],h=!0):t=a[34][Symbol.for("children")][0],h===!0&&p===0&&(h=!1),t=a[32];const Gr={};a[35]=this.element({parent:t||"root"},h===!0?d:e),Gr.x=63,Gr.y=2,a[35].populate(Gr),h===!0&&(p-=1);const Qt=r.components&&r.components.Sprite||i.Sprite;t=a[35];const Ee={};a[36]=this.element({parent:t||"root"},h===!0?d:e),Ee.image=e.image,Ee.x=0,Ee.h=20,Ee.w=20,Ee.map=e.sprite,Ee.frame=e.maxFps[0];const en=[];if(typeof Qt<"u")for(let F in Qt[Symbol.for("config")].props)delete Ee[Qt[Symbol.for("config")].props[F]],en.push(Qt[Symbol.for("config")].props[F]);a[36].populate(Ee),h===!0&&(p-=1),t=a[36];const Ae={};Ae.image=e.image,Ae.x=0,Ae.h=20,Ae.w=20,Ae.map=e.sprite,u=e.maxFps[0],Array.isArray(u)===!0&&(u=o(u).slice(0)),Ae.frame=u,c=Ae.is||"Sprite";let Zt;if(typeof c=="string"){if(Zt=r.components&&r.components[c]||i[c],!Zt)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(Zt=c);a[37]=Zt.call(null,{props:Ae},a[36],e),a[37][Symbol.for("slots")][0]?(t=a[37][Symbol.for("slots")][0],d=a[37],h=!0):t=a[37][Symbol.for("children")][0],h===!0&&p===0&&(h=!1);const Jt=r.components&&r.components.Sprite||i.Sprite;t=a[35];const Me={};a[38]=this.element({parent:t||"root"},h===!0?d:e),Me.image=e.image,Me.x=18,Me.h=20,Me.w=20,Me.map=e.sprite,Me.frame=e.maxFps[1];const tn=[];if(typeof Jt<"u")for(let F in Jt[Symbol.for("config")].props)delete Me[Jt[Symbol.for("config")].props[F]],tn.push(Jt[Symbol.for("config")].props[F]);a[38].populate(Me),h===!0&&(p-=1),t=a[38];const Ie={};Ie.image=e.image,Ie.x=18,Ie.h=20,Ie.w=20,Ie.map=e.sprite,u=e.maxFps[1],Array.isArray(u)===!0&&(u=o(u).slice(0)),Ie.frame=u,c=Ie.is||"Sprite";let er;if(typeof c=="string"){if(er=r.components&&r.components[c]||i[c],!er)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(er=c);a[39]=er.call(null,{props:Ie},a[38],e),a[39][Symbol.for("slots")][0]?(t=a[39][Symbol.for("slots")][0],d=a[39],h=!0):t=a[39][Symbol.for("children")][0],h===!0&&p===0&&(h=!1);const tr=r.components&&r.components.Sprite||i.Sprite;t=a[35];const Le={};a[40]=this.element({parent:t||"root"},h===!0?d:e),Le.image=e.image,Le.x=36,Le.h=20,Le.w=20,Le.map=e.sprite,Le.frame=e.maxFps[2];const rn=[];if(typeof tr<"u")for(let F in tr[Symbol.for("config")].props)delete Le[tr[Symbol.for("config")].props[F]],rn.push(tr[Symbol.for("config")].props[F]);a[40].populate(Le),h===!0&&(p-=1),t=a[40];const Pe={};Pe.image=e.image,Pe.x=36,Pe.h=20,Pe.w=20,Pe.map=e.sprite,u=e.maxFps[2],Array.isArray(u)===!0&&(u=o(u).slice(0)),Pe.frame=u,c=Pe.is||"Sprite";let rr;if(typeof c=="string"){if(rr=r.components&&r.components[c]||i[c],!rr)throw new Error('Component "Sprite" not found')}else typeof c=="function"&&c[Symbol.for("isComponent")]===!0&&(rr=c);return a[41]=rr.call(null,{props:Pe},a[40],e),a[41][Symbol.for("slots")][0]?(t=a[41][Symbol.for("slots")][0],d=a[41],h=!0):t=a[41][Symbol.for("children")][0],h===!0&&p===0&&(h=!1),a},effects:[function(t,e,r,i,n,o){(typeof skip6>"u"||skip6.indexOf("frame")===-1)&&e[6].set("frame",t.fps[0])},function(t,e,r,i,n,o){e[7][Symbol.for("props")].frame=t.fps[0]},function(t,e,r,i,n,o){(typeof skip8>"u"||skip8.indexOf("frame")===-1)&&e[8].set("frame",t.fps[1])},function(t,e,r,i,n,o){e[9][Symbol.for("props")].frame=t.fps[1]},function(t,e,r,i,n,o){(typeof skip10>"u"||skip10.indexOf("frame")===-1)&&e[10].set("frame",t.fps[2])},function(t,e,r,i,n,o){e[11][Symbol.for("props")].frame=t.fps[2]},function(t,e,r,i,n,o){(typeof skip16>"u"||skip16.indexOf("frame")===-1)&&e[16].set("frame",t.avgFps[0])},function(t,e,r,i,n,o){e[17][Symbol.for("props")].frame=t.avgFps[0]},function(t,e,r,i,n,o){(typeof skip18>"u"||skip18.indexOf("frame")===-1)&&e[18].set("frame",t.avgFps[1])},function(t,e,r,i,n,o){e[19][Symbol.for("props")].frame=t.avgFps[1]},function(t,e,r,i,n,o){(typeof skip20>"u"||skip20.indexOf("frame")===-1)&&e[20].set("frame",t.avgFps[2])},function(t,e,r,i,n,o){e[21][Symbol.for("props")].frame=t.avgFps[2]},function(t,e,r,i,n,o){(typeof skip26>"u"||skip26.indexOf("frame")===-1)&&e[26].set("frame",t.minFps[0])},function(t,e,r,i,n,o){e[27][Symbol.for("props")].frame=t.minFps[0]},function(t,e,r,i,n,o){(typeof skip28>"u"||skip28.indexOf("frame")===-1)&&e[28].set("frame",t.minFps[1])},function(t,e,r,i,n,o){e[29][Symbol.for("props")].frame=t.minFps[1]},function(t,e,r,i,n,o){(typeof skip30>"u"||skip30.indexOf("frame")===-1)&&e[30].set("frame",t.minFps[2])},function(t,e,r,i,n,o){e[31][Symbol.for("props")].frame=t.minFps[2]},function(t,e,r,i,n,o){(typeof skip36>"u"||skip36.indexOf("frame")===-1)&&e[36].set("frame",t.maxFps[0])},function(t,e,r,i,n,o){e[37][Symbol.for("props")].frame=t.maxFps[0]},function(t,e,r,i,n,o){(typeof skip38>"u"||skip38.indexOf("frame")===-1)&&e[38].set("frame",t.maxFps[1])},function(t,e,r,i,n,o){e[39][Symbol.for("props")].frame=t.maxFps[1]},function(t,e,r,i,n,o){(typeof skip40>"u"||skip40.indexOf("frame")===-1)&&e[40].set("frame",t.maxFps[2])},function(t,e,r,i,n,o){e[41][Symbol.for("props")].frame=t.maxFps[2]}],context:{}},state(){return{image:el,sprite:{defaults:{y:1,w:20,h:20},frames:{"-":{x:-1e3},0:{x:1},1:{x:23},2:{x:45},3:{x:67},4:{x:89},5:{x:111},6:{x:133},7:{x:155},8:{x:177},9:{x:199},avg:{x:221,w:48,h:25},fps:{x:271,w:43,h:25},max:{x:316,w:53,h:25},min:{x:371,w:47,h:25}}},fps:"---",avgFps:"---",minFps:"---",maxFps:"---"}},hooks:{ready(){}}}),rl=()=>({Circle:Qa(),RouterView:Za(),Sprite:Ja(),FPScounter:tl()}),sl={name:"log",plugin(){return ai("App")}},vs={log:sl},Yi=(s,t="",e={})=>{let r;if(typeof t=="object"?e=t:r=t,typeof s=="function"){if(r===void 0)throw Error("Error registering plugin: name is required for plugin");vs[r]={plugin:s,options:e}}else s.plugin&&Yi(s.plugin,r||s.name,e)};let ss;const ni=s=>{throw new Error(`Parameter ${s} is required`)},St=(s=ni("name"),t=ni("config"))=>{let e;const r=function(n,o,l,a){this.componentId=yn(s),this.lifecycle=Object.assign(Object.create(_n),{component:this,previous:null,current:null}),this.parent=l,this.rootParent=a,this[m.holder]=o,this[m.id]=Tn(),this[m.props]=as(n.props||{},ae.get("reactivityMode")),this[m.timeouts]=[],this[m.intervals]=[],this[m.originalState]=t.state&&typeof t.state=="function"&&t.state.apply(this)||{},this[m.originalState].hasFocus=!1,this[m.state]=as(this[m.originalState],ae.get("reactivityMode")),this.lifecycle.state="init",this[m.children]=t.code.render.apply(As,[o,this,t,ss,or,Ve,G])||[],this[m.wrapper]=this[m.children][0],this[m.slots]=this[m.children].filter(u=>u[m.isSlot]),t.hooks&&(t.hooks.frameTick&&Or.on("frameTick",(u,d)=>is("frameTick",this[m.identifier],this,[d])),t.hooks.idle&&Or.on("idle",()=>{is("idle",this[m.identifier],this)}),t.hooks.attach&&this[m.wrapper].node.on("inBounds",()=>{this.lifecycle.state="attach"}),t.hooks.detach&&this[m.wrapper].node.on("outOfBounds",(u,{previous:d})=>{d>0&&(this.lifecycle.state="detach")}),t.hooks.enter&&this[m.wrapper].node.on("inViewport",()=>{this.lifecycle.state="enter"}),t.hooks.exit&&this[m.wrapper].node.on("outOfViewport",()=>{this.lifecycle.state="exit"}));const c=t.code.effects;this[m.effects]=[];for(let u=0;u<c.length;u++){const d=()=>{c[u](this,this[m.children],t,ss,a,or)};this[m.effects].push(d),or(d)}if(this[m.watchers]){const u=Object.keys(this[m.watchers]),d=u.length;for(let h=0;h<d;h++){let p=this,g=u[h];const x=g;if(g.indexOf(".")>-1){const S=g.split(".");g=S.pop();for(let v=0;v<S.length;v++)p=p[S[v]]}let T=this[g];const y=(S=!1)=>{const v=p[g];(T!==v||S===!0)&&(this[m.watchers][x].apply(this,[v,T]),T=v)};this[m.effects].push(y),or(y)}}return setTimeout(()=>this.lifecycle.state="ready"),this},i=(n={},o,l,a)=>{if(Xe[m.launched]===!1){const c=Object.keys(vs),u=c.length,d={};for(let h=0;h<u;h++){const p=c[h],g=`$${p}`;g in Xe&&G.warn(`"${p}" (this.${g}) already exists as a property or plugin on the Base Component. You may be overwriting built-in functionality. Proceed with care!`);const x=vs[p];d[g]={value:Object.defineProperties(x.plugin(x.options),Gi),writable:!1,enumerable:!0,configurable:!0}}Object.defineProperties(Xe,d);for(const h in d)Object.defineProperties(Xe[h],d),delete Xe[h][h];ss=rl(),Xe[m.launched]=!0}return e===void 0&&(G.debug(`Setting up ${s} component`),e=qa(Object.create(Xe),t)),t.code===void 0&&(G.debug(`Generating code for ${s} component`),t.code=hn.call(t,cn(t.template))),r.call(Object.create(e),n,o,l,a)};return i[Symbol.for("config")]=t,i[m.isComponent]=!0,i},il=s=>{const t={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down",Enter:"enter"," ":"space",Backspace:"back",Escape:"escape",37:"left",39:"right",38:"up",40:"down",13:"enter",32:"space",8:"back",27:"escape"};s.hooks=s.hooks||{};let e,r,i;return s.hooks[m.destroy]=function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",r)},s.hooks[m.init]=function(){this.$announcer.toggle(ae.get("announcer",!1));const n={...t,...ae.get("keymap",{})};e=async o=>{const l=n[o.key]||n[o.keyCode]||o.key||o.keyCode;this[m.inputEvents]!==void 0&&this[m.inputEvents].intercept!==void 0&&(o=await this[m.inputEvents].intercept.call(this,o),!(o instanceof KeyboardEvent))||(dt.input(l,o),clearTimeout(i),i=setTimeout(()=>{dt.hold=!0},ae.get("holdTimeout",Li)))},r=o=>{const l=ws.get(o.code);l!==void 0&&typeof l=="function"&&(ws.delete(o.code),l()),clearTimeout(i),dt.hold=!1},document.addEventListener("keydown",e),document.addEventListener("keyup",r),setTimeout(()=>dt.set(this))},St("App",s)},Hi={Component:St,Application:il,Launch:ya,Plugin:Yi},nl=Hi.Application({});function ol(){Hi.Launch(nl,"app",{w:window.innerWidth,h:window.innerHeight,canvasColor:"#000000"})}ol();
